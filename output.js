
function a0_0x4b8f() {
  const _0x291c8a = ["保险柜取出", "[updateUnionNotice]", "lastLoginTime", "CAN_NOT_REPEAT_APPLICATION", "findIndex", "forbidInvite", "unionInviteID", "parse", "[removePartner] operate success", "videoRecordID", "getStatisticsInfo", "[modifyScore] sessionUid = ", "safeScore", "[modifyUserToRule] add limit operate fail", "moment", "564540WJtsGb", "getGameReplay", "uniqueIDModel", "USER_DATA_LOCKED", "app", "toFixed", "[modifyUserToRule] remove limit operate success", "[addUserBlockRule] msg = ", "[userPayDetailModel]", "yesterdayTotalProvideRebate", "47574DVgsqI", "[deleteUserForUnion] ownerUid = ", "updateUserDataNotify", "ownerAvatar", "[modifyScore] step = 2  msg = ", "includes", "UNION_NOT_EXIST", "[removeCaptainPartner]", "保险柜存入", "modifyScore", "updateUserData", "userDirectSeriesSuperior", "find", "[safeBoxOperationRecord]", "赠送给", "2809904eaBxzB", "1235070iBFYaA", "totalGainCount", "getUnionAllUser", "disApplyCount", "$unionInfo", "askJoinUnionList", "getGiveScoreRecord", "__route__", "[safeBoxOperation]", "$userList.nickname", "getTimeTodayStart", "[createUnion]", "showFixScore", "safeBoxRecordModel", "[modifyUserToRule]", "getUserData", "count", "yesterdayBigWinDraw", "startIndex", "$count", "floatScore", "push", "dismissType", "sortData", "findOneAndUpdateEx", "盟主自己", "nickname", "ALREADY_CREATED_UNION", "targetScore", "findOneData", "rebateRate", "yesterdayProvideRebate", "userDelModel", "[joinUnionApprove]", "getTeamFixScore", "$userList.uid", "$userList", "inviteJoinUnion", "replayCode", "[saveBoxOperation]", "addUserBlockRule", "getLogger", "unionMainList msg = ", "getUserLowAll", "total", "236ASUEYb", "modifyUserToRule", "joinRequestList", "userGameRecordModel", "$userList.score", "saveBoxOperation", "inviteMsg", "agree", "list", "[getUserUnionList]", "yesterdayTotalRebate", "type", "SQL_ERROR", "[addManager] ownerUid = ", "[createUnion] operate success", "[joinUnionApprove] msg = ", "[userBlockList]", "userLimitAdd", "提取返利", "[removePartner] ownerUid = ", "joinVerify", "[giveScore] msg = ", "$unionInfo.yesterdayProvideRebate", "createTime", "[getUserScore]", "[updateUnionRebate]", "[modifyUserToRule] ownerUid = ", "isAgent", "NOT_ENOUGH_SCORE", "memberYesterdayBigWinDraw", "[getMemberStatisticsInfo]", "[inviteJoinUnion] operate success", "uid", "prototype", "[modifyScore]", "unlockUserData", "ALREADY_IN_UNION", " isPartner = ", "[removeCaptainPartner] operate success", "[deleteUserForUnion] operate success", "onlineMember", " sessionUid = ", "updateUserDataAndUnlock", "getTodayUserScore", "yesterdayDraw", "scoreGiveRecordModel", "[modifyUserToRule] msg = ", "manager", "SAFE_BOX", "deleteData", "[getTeamDetail]", "todayTotalRebate", "getRankSingleDraw", "[userBlockList] operate success", "[createUnion] msg = ", "17293276PLLCQK", "operationUid", "[getScoreModifyRecord]", "showSingleRank", "$unionInfo.yesterdayDraw", "[deleteUserForUnion] totalCount = ", "MODIFY_UP", "partnerUid", "getAllOnLineList", "todayWinTotal", "totalGiveCount", "unionType", "[getGameReplay]", "approveType", "limitScore", "pomelo-logger", "userRebateRecordModel", "REQUEST_DATA_ERROR", "abs", "[operationInviteJoinUnion]", "scoreChangeType", "[updateRobotScore]", "[askJoinUnionList]", "giveScore", "INVITE_ID_ERROR", "[deleteUserBlockRule] operate success", "weekDraw", "roomID", "score", "[modifyUserToRule] add limit operate success", "[removePartner] msg = ", "[modifyScore] operate success owner", "updateDataEx", "propsLimit", "[unionMainList]", "[updateRobotScore] operate success", " spreaderID = ", "stack", "userList", "INVALID_UERS", "getUserDataTotal", "setWinningLimitScore", "yesterdayRebate", "[askJoinUnion] operate success pengding", "[deleteUserBlockRule] ownerUid = ", "updateUnionTicketRebate", "teamDataModel", "todayRebate", "findDataAndCount", "SAVE_SCORE", "[addPartner]", "unionID", "createUnion", "[askJoinUnion] operate success ", "[addPartner] msg = ", "isRobot", "memberYesterdayDraw", "isMyMember", "findData", "[updateUserFixScore]", "now", "[getMemberList] msg = ", "todayDraw", "[addPartner] operate success update", "[joinUnion]", "[addManager] operate success", "$userList.avatar", "avatar", "ticketRate", "spreaderID", "recordArr", "userModel", "getUserDataByUid", "userScoreDetailModel", "unionSkinId", "userBlockModel", "getMemberStatisticsInfo msg = ", "[getGameRecord]", "canNegativeScore", "[inviteJoinUnion]", " isManager = ", "updateForbidGameStatus", "tableColor", "gameLimitModel", "[addPartner] operate success join", "[getMyRebate]", "isShow", "askJoinUnion", "updateData", "[safeBoxOperationRecord] msg = ", "getTeamDetail", "getNickName", "totalScore", "ownerNickname", "[getVideoRecord]", "length", "scoreModifyRecordModel", "frontendId", "[getRank]", "15618cMzumG", "[hall-unionHandler] unionMainList end", "FORBID_GIVE_SCORE", "updateUnionRebate", "[addUserBlockRule]", "ownerPhone", "2MQbulQ", "stringify", "forbidGive", "info", "partner", "FORBID_INVITE_SCORE", "reCountUserScore", "pop", "[joinUnionApprove] operate success approved", "getDataCount", "createData", "USER_IN_ROOM_DATA_LOCKED", "tableSort", "[deleteUserForUnion]", "getScoreModifyRecord", "operate", "addManager", "notice", "inviteLimit", "removePartner", "recordCount", "add", "[updateShowFixScore]", "emptyTable", "[modifyScore] step = 1  msg = ", "inviteID", "GIVE", "getUnionRebateRecord", "diff", "给下级", "[userBlockList] msg = ", "[getMemberScoreList]", "matchData", "unionModel", "fixScoreRate", "format", "ownerUid", "giveUid", "../../../constant/enumeration", "  sessionUid = ", "CAN_NOT_JOIN_UNION", "TANSFER_LEVEL_CAPTAIN", "userScoreChangeRecordModel", "[safeBoxOperation] operate success", "unshift", "showRank", "totalDraw", "YYYYMMDD", "forbid", "[exitUnion] operate success ", "[addManager] msg = ", "updateRobotScore", "yesterdayWin", "exitUnion", "[updateForbidGameStatus]", "[getAllOnLineList]", "_id", "updateShowFixScore", "21XZejYu", "tableHideCount", "tableStyle", "deleteUserForUnion", "[getRankSingleDraw]", "TANSFER_LEVEL_LINIT", "updateUserFixScore", "getMemberStatisticsInfo", "number", "totalCount", "isInvite", "[userLimitRecord]", "todayWin", "getUnlockUserDataAndLock", "updateLimitScore", "error", "isDel", "[exitUnion]", "prohibitGame", "unionBg", "createDataArr", "unReadyKick", "NOT_IN_UNION", "saveScore", "userBlockList", "998730FfIJxW", "joinUnionApprove", "[addUserBlockRule] ownerUid = ", "catch", "ruleID", "PERMISSION_NOT_ENOUGH", "[inviteJoinUnion] ownerUid = ", "[updateLimitScore]", "memberUid", "dayTime", "MODIFY_LOW", "todayProvideRebate", "userDelRecord", "updateUserDataByUid", "groupLimit", "getMemberScoreList", "[setWinningLimitScore]", "unionInfo", "isPartner", "175luPSgW"];
  a0_0x4b8f = function () {
    return _0x291c8a;
  };
  return a0_0x4b8f();
}
const a0_0x5d04f4 = a0_0x4f79;
(function (_0x3a7b1b, _0x466b9a) {
  const _0x36d9e2 = a0_0x4f79;
  const _0x5bb246 = _0x3a7b1b();
  while (true) {
    try {
      const _0x23ef20 = -parseInt(_0x36d9e2(640)) / 1 * (parseInt(_0x36d9e2(522)) / 2) + -parseInt(_0x36d9e2(650)) / 3 * (-parseInt(_0x36d9e2(362)) / 4) + -parseInt(_0x36d9e2(624)) / 5 * (-parseInt(_0x36d9e2(516)) / 6) + -parseInt(_0x36d9e2(580)) / 7 * (parseInt(_0x36d9e2(665)) / 8) + -parseInt(_0x36d9e2(666)) / 9 + -parseInt(_0x36d9e2(605)) / 10 + parseInt(_0x36d9e2(417)) / 11;
      if (_0x23ef20 === _0x466b9a) {
        break;
      } else {
        _0x5bb246.push(_0x5bb246.shift());
      }
    } catch (_0x31dee5) {
      _0x5bb246.push(_0x5bb246.shift());
    }
  }
})(a0_0x4b8f, 743486);
function a0_0x4f79(_0x12e6d0, _0x319890) {
  const _0x5dfe26 = a0_0x4b8f();
  a0_0x4f79 = function (_0x5c9ffb, _0x317f7b) {
    _0x5c9ffb = _0x5c9ffb - 360;
    let _0x561bc9 = _0x5dfe26[_0x5c9ffb];
    return _0x561bc9;
  };
  return a0_0x4f79(_0x12e6d0, _0x319890);
}
let code = require("../../../constant/code");
let commonDao = require("../../../dao/commonDao");
let userDao = require("../../../dao/userDao");
let userInfoServices = require("../../../services/userInfoServices");
let utils = require("../../../util/utils");
let logger = require(a0_0x5d04f4(432))[a0_0x5d04f4(707)](a0_0x5d04f4(537));
let enumeration = require(a0_0x5d04f4(560));
let DAY_MS = 86400000;
let WEEK_MS = 28 * DAY_MS;
let pomelo = require("pomelo");
let moment = require(a0_0x5d04f4(639));
let userListPenging = [];
module.exports = function (_0x520b27) {
  return new Handler(_0x520b27);
};
let Handler = function (_0x496284) {
  const _0x1763aa = a0_0x5d04f4;
  this[_0x1763aa(644)] = _0x496284;
};
function getSimData(_0x48365f) {
  const _0x4065c7 = a0_0x5d04f4;
  let _0x1789a3 = JSON[_0x4065c7(632)](JSON[_0x4065c7(523)](_0x48365f));
  delete _0x1789a3[_0x4065c7(673)];
  return JSON[_0x4065c7(523)](_0x1789a3);
}
Handler.prototype[a0_0x5d04f4(573)] = async function (_0x46332b, _0x2d7165, _0x6c1085) {
  const _0x28e127 = a0_0x5d04f4;
  logger[_0x28e127(525)]("[updateRobotScore] msg = " + getSimData(_0x46332b) + " sessionUid = " + _0x2d7165.uid);
  try {
    if (!_0x2d7165[_0x28e127(394)]) {
      _0x6c1085(null, {
        code: code[_0x28e127(456)]
      });
      return;
    }
    if (!_0x46332b[_0x28e127(468)] || !_0x46332b[_0x28e127(682)] || !_0x46332b[_0x28e127(455)]) {
      _0x6c1085(null, {
        code: code[_0x28e127(456)]
      });
      return;
    }
    let _0xa5a68b = await userDao[_0x28e127(489)](_0x2d7165[_0x28e127(394)]);
    if (!_0xa5a68b) {
      _0x6c1085(null, {
        code: code[_0x28e127(456)]
      });
      return;
    }
    let _0x2f8bb5 = _0xa5a68b[_0x28e127(622)][_0x28e127(662)](function (_0x42abe1) {
      const _0x59c42f = _0x28e127;
      return _0x42abe1[_0x59c42f(468)] === _0x46332b[_0x59c42f(468)];
    });
    if (!_0x2f8bb5) {
      _0x6c1085(null, {
        code: code[_0x28e127(610)]
      });
      return;
    }
    let _0x178e4b = await commonDao.findOneData(_0x28e127(555), {
      unionID: _0x46332b[_0x28e127(468)]
    });
    if (!_0x178e4b) {
      _0x6c1085(null, {
        code: code[_0x28e127(656)]
      });
      return;
    }
    if (_0x178e4b && (_0x2f8bb5[_0x28e127(409)] || _0x2d7165[_0x28e127(394)] == _0x178e4b[_0x28e127(558)])) {
      let _0x577e4c = await userDao[_0x28e127(593)](_0x2d7165.uid);
      if (!_0x577e4c) {
        _0x6c1085(null, {
          code: code.REQUEST_DATA_ERROR
        });
        return;
      }
      let _0x1aa26c = null;
      for (let _0x50e8e3 = 0; _0x50e8e3 < _0x577e4c[_0x28e127(622)].length; ++_0x50e8e3) {
        if (_0x577e4c[_0x28e127(622)][_0x50e8e3].unionID === _0x46332b.unionID) {
          _0x1aa26c = _0x577e4c[_0x28e127(622)][_0x50e8e3];
          break;
        }
      }
      _0x46332b[_0x28e127(682)] = parseInt(_0x46332b[_0x28e127(682)]) || 0;
      let _0x410e7a = _0x46332b[_0x28e127(455)] || [];
      let _0x3b260d = _0x46332b[_0x28e127(682)] * _0x410e7a[_0x28e127(512)];
      if (!_0x1aa26c || _0x1aa26c[_0x28e127(445)] < _0x3b260d) {
        await userDao[_0x28e127(397)](_0x2d7165.uid);
        _0x6c1085(null, {
          code: code[_0x28e127(390)]
        });
        return;
      }
      let _0x3e01ae = await userDao[_0x28e127(404)]({
        uid: _0x2d7165[_0x28e127(394)],
        "unionInfo.unionID": _0x46332b.unionID
      }, {
        $inc: {
          "unionInfo.$.score": -_0x3b260d
        }
      });
      let _0x12e97c = [];
      for (let _0x56e26b = 0; _0x56e26b < _0x410e7a[_0x28e127(512)]; _0x56e26b++) {
        let _0x5b7643 = _0x410e7a[_0x56e26b];
        let _0x6fd3a = await userDao[_0x28e127(404)]({
          uid: _0x5b7643,
          "unionInfo.unionID": _0x46332b[_0x28e127(468)]
        }, {
          $inc: {
            "unionInfo.$.score": Math[_0x28e127(435)](_0x46332b[_0x28e127(682)])
          }
        });
        let _0x10e0dc = {
          uid: _0x2d7165[_0x28e127(394)],
          nickname: _0x577e4c[_0x28e127(692)],
          avatar: _0x577e4c[_0x28e127(484)],
          gainUid: _0x5b7643,
          gainNickname: _0x6fd3a[_0x28e127(692)],
          gainAvatar: _0x6fd3a.avatar,
          unionID: _0x46332b.unionID,
          count: Math[_0x28e127(435)](_0x46332b.count),
          createTime: Date.now()
        };
        commonDao[_0x28e127(532)](_0x28e127(513), _0x10e0dc)[_0x28e127(608)](_0x33aaec => {
          const _0x883a11 = _0x28e127;
          logger[_0x883a11(595)](_0x33aaec[_0x883a11(454)]);
        });
        if (!!_0x6fd3a[_0x28e127(514)]) {
          userInfoServices[_0x28e127(652)](_0x6fd3a.uid, _0x6fd3a[_0x28e127(514)], {
            unionInfo: _0x6fd3a[_0x28e127(622)]
          }).catch(_0x32b1bc => {
            const _0x434728 = _0x28e127;
            logger[_0x434728(595)](_0x32b1bc.stack);
          });
        }
        let _0x32247c = _0x6fd3a.unionInfo.find(function (_0x5d33ed) {
          const _0x599c54 = _0x28e127;
          return _0x5d33ed[_0x599c54(468)] === _0x46332b.unionID;
        });
        _0x12e97c[_0x28e127(687)]({
          uid: _0x3e01ae.uid,
          nickname: _0x3e01ae[_0x28e127(692)],
          unionID: _0x46332b.unionID,
          changeCount: -_0x46332b.count,
          leftCount: _0x32247c[_0x28e127(445)],
          leftSafeBoxCount: _0x32247c[_0x28e127(637)],
          leftSaveBoxCount: _0x32247c.saveScore,
          changeType: enumeration[_0x28e127(437)][_0x28e127(615)],
          describe: _0x46332b[_0x28e127(682)] > 0 ? _0x28e127(551) + _0x6fd3a[_0x28e127(394)] + "加分" + _0x46332b[_0x28e127(682)] : _0x28e127(551) + _0x6fd3a[_0x28e127(394)] + "减分" + _0x46332b[_0x28e127(682)] * -1,
          createTime: Date[_0x28e127(477)]()
        });
        let _0x5011e6 = _0x6fd3a[_0x28e127(622)][_0x28e127(662)](function (_0x2ef33c) {
          const _0x29e814 = _0x28e127;
          return _0x2ef33c[_0x29e814(468)] === _0x46332b.unionID;
        });
        _0x12e97c.push({
          uid: _0x6fd3a[_0x28e127(394)],
          nickname: _0x6fd3a.nickname,
          unionID: _0x46332b[_0x28e127(468)],
          changeCount: _0x46332b[_0x28e127(682)],
          leftCount: _0x5011e6[_0x28e127(445)],
          leftSafeBoxCount: _0x5011e6[_0x28e127(637)],
          leftSaveBoxCount: _0x5011e6[_0x28e127(603)],
          changeType: enumeration[_0x28e127(437)].MODIFY_UP,
          describe: _0x46332b[_0x28e127(682)] > 0 ? "上级" + _0x3e01ae.uid + "加分" + _0x46332b.count : "上级" + _0x3e01ae[_0x28e127(394)] + "减分" + _0x46332b[_0x28e127(682)] * -1,
          createTime: Date[_0x28e127(477)]()
        });
      }
      await commonDao.createDataArr("userScoreChangeRecordModel", _0x12e97c);
      await commonDao.createDataArr(_0x28e127(490), _0x12e97c).catch(_0x24a801 => {
        const _0x5dec42 = _0x28e127;
        logger[_0x5dec42(595)](_0x24a801[_0x5dec42(454)]);
      });
      _0x6c1085(null, {
        code: code.OK,
        updateUserData: {
          unionInfo: _0x3e01ae.unionInfo
        }
      });
      logger[_0x28e127(525)](_0x28e127(452));
    } else {
      _0x6c1085(null, {
        code: code[_0x28e127(610)]
      });
      return;
    }
  } catch (_0x1c7042) {
    logger[_0x28e127(595)](_0x28e127(438) + _0x1c7042.stack);
    _0x6c1085(null, {
      code: 500
    });
  }
};
Handler.prototype[a0_0x5d04f4(706)] = async function (_0x430901, _0xee8398, _0x124c3a) {
  const _0x291be0 = a0_0x5d04f4;
  logger[_0x291be0(525)](_0x291be0(647) + getSimData(_0x430901) + _0x291be0(403) + _0xee8398[_0x291be0(394)]);
  try {
    if (!_0xee8398[_0x291be0(394)]) {
      _0x124c3a(null, {
        code: code[_0x291be0(456)]
      });
      return;
    }
    if (!_0x430901[_0x291be0(468)]) {
      _0x124c3a(null, {
        code: code[_0x291be0(610)]
      });
      return;
    }
    let _0x661f04 = await userDao[_0x291be0(489)](_0xee8398.uid);
    if (!_0x661f04) {
      _0x124c3a(null, {
        code: code[_0x291be0(456)]
      });
      return;
    }
    let _0x4904e2 = await commonDao.findOneData(_0x291be0(555), {
      unionID: _0x430901[_0x291be0(468)]
    });
    if (!_0x4904e2) {
      _0x124c3a(null, {
        code: code[_0x291be0(656)]
      });
      return;
    }
    let _0x54f73d = _0x661f04.unionInfo.find(function (_0x4f04db) {
      const _0x4823fc = _0x291be0;
      return _0x4f04db[_0x4823fc(468)] === _0x430901[_0x4823fc(468)];
    });
    if (!_0x54f73d) {
      _0x124c3a(null, {
        code: code[_0x291be0(610)]
      });
      return;
    }
    logger[_0x291be0(525)](_0x291be0(607) + _0x4904e2[_0x291be0(558)] + _0x291be0(497) + _0x54f73d[_0x291be0(409)] + _0x291be0(403) + _0xee8398[_0x291be0(394)]);
    if (_0x4904e2[_0x291be0(558)] != _0xee8398[_0x291be0(394)] && !_0x54f73d[_0x291be0(409)]) {
      _0x124c3a(null, {
        code: code[_0x291be0(610)]
      });
      return;
    }
    let _0x58b07 = {
      creatorUid: _0xee8398.uid,
      unionID: _0x430901[_0x291be0(468)],
      userList: [],
      createTime: moment()[_0x291be0(557)]("x")
    };
    await commonDao[_0x291be0(532)](_0x291be0(492), _0x58b07);
    _0x124c3a(null, {
      code: code.OK
    });
    logger[_0x291be0(525)]("[addUserBlockRule] operate success");
  } catch (_0x2e0c93) {
    logger[_0x291be0(595)](_0x291be0(520) + _0x2e0c93.stack);
    _0x124c3a(null, {
      code: 500
    });
  }
};
Handler.prototype.deleteUserBlockRule = async function (_0xd54782, _0x47efad, _0x1babd4) {
  const _0x5d2434 = a0_0x5d04f4;
  logger[_0x5d2434(525)]("[deleteUserBlockRule] msg = " + getSimData(_0xd54782) + _0x5d2434(403) + _0x47efad[_0x5d2434(394)]);
  try {
    if (!_0x47efad.uid) {
      _0x1babd4(null, {
        code: code[_0x5d2434(456)]
      });
      return;
    }
    if (!_0xd54782.unionID || !_0xd54782.ruleID) {
      _0x1babd4(null, {
        code: code[_0x5d2434(610)]
      });
      return;
    }
    let _0x2a3a8b = await userDao[_0x5d2434(489)](_0x47efad[_0x5d2434(394)]);
    if (!_0x2a3a8b) {
      _0x1babd4(null, {
        code: code[_0x5d2434(456)]
      });
      return;
    }
    let _0x2fba64 = await commonDao[_0x5d2434(695)](_0x5d2434(555), {
      unionID: _0xd54782.unionID
    });
    if (!_0x2fba64) {
      _0x1babd4(null, {
        code: code.UNION_NOT_EXIST
      });
      return;
    }
    let _0x42e1f5 = _0x2a3a8b.unionInfo[_0x5d2434(662)](function (_0x56213e) {
      const _0x57b0e8 = _0x5d2434;
      return _0x56213e[_0x57b0e8(468)] === _0xd54782[_0x57b0e8(468)];
    });
    if (!_0x42e1f5) {
      _0x1babd4(null, {
        code: code.PERMISSION_NOT_ENOUGH
      });
      return;
    }
    logger[_0x5d2434(525)](_0x5d2434(461) + _0x2fba64[_0x5d2434(558)] + _0x5d2434(497) + _0x42e1f5[_0x5d2434(409)] + _0x5d2434(403) + _0x47efad[_0x5d2434(394)]);
    if (_0x2fba64[_0x5d2434(558)] != _0x47efad[_0x5d2434(394)] && !_0x42e1f5[_0x5d2434(409)]) {
      _0x1babd4(null, {
        code: code[_0x5d2434(610)]
      });
      return;
    }
    await commonDao[_0x5d2434(411)](_0x5d2434(492), {
      ruleID: _0xd54782[_0x5d2434(609)]
    });
    _0x1babd4(null, {
      code: code.OK
    });
    logger[_0x5d2434(525)](_0x5d2434(442));
  } catch (_0x11dba6) {
    logger.error("[deleteUserBlockRule]" + _0x11dba6[_0x5d2434(454)]);
    _0x1babd4(null, {
      code: 500
    });
  }
};
Handler[a0_0x5d04f4(395)][a0_0x5d04f4(363)] = async function (_0x425ecc, _0x50dc9c, _0x4ced40) {
  const _0x53c51e = a0_0x5d04f4;
  logger[_0x53c51e(525)](_0x53c51e(408) + getSimData(_0x425ecc) + _0x53c51e(403) + _0x50dc9c[_0x53c51e(394)]);
  try {
    if (!_0x50dc9c[_0x53c51e(394)]) {
      _0x4ced40(null, {
        code: code[_0x53c51e(456)]
      });
      return;
    }
    if (!_0x425ecc.unionID || !_0x425ecc[_0x53c51e(455)] || !_0x425ecc.ruleID) {
      _0x4ced40(null, {
        code: code[_0x53c51e(610)]
      });
      return;
    }
    let _0xf87f28 = await userDao[_0x53c51e(489)](_0x50dc9c.uid);
    if (!_0xf87f28) {
      _0x4ced40(null, {
        code: code[_0x53c51e(456)]
      });
      return;
    }
    let _0x547763 = await commonDao.findOneData("unionModel", {
      unionID: _0x425ecc.unionID
    });
    if (!_0x547763) {
      _0x4ced40(null, {
        code: code[_0x53c51e(656)]
      });
      return;
    }
    let _0x3346eb = _0xf87f28[_0x53c51e(622)][_0x53c51e(662)](function (_0x34245d) {
      const _0x33a201 = _0x53c51e;
      return _0x34245d.unionID === _0x425ecc[_0x33a201(468)];
    });
    if (!_0x3346eb) {
      _0x4ced40(null, {
        code: code[_0x53c51e(610)]
      });
      return;
    }
    logger[_0x53c51e(525)](_0x53c51e(388) + _0x547763[_0x53c51e(558)] + _0x53c51e(497) + _0x3346eb[_0x53c51e(409)] + _0x53c51e(403) + _0x50dc9c[_0x53c51e(394)]);
    if (_0x547763.ownerUid != _0x50dc9c[_0x53c51e(394)] && !_0x3346eb[_0x53c51e(409)]) {
      _0x4ced40(null, {
        code: code[_0x53c51e(610)]
      });
      return;
    }
    if (_0x425ecc[_0x53c51e(373)] == 1) {
      let _0xea8502 = _0x425ecc.userList[0];
      let _0x1c4661 = await userDao[_0x53c51e(489)](_0xea8502);
      if (!_0x1c4661) {
        _0x4ced40(null, {
          code: code[_0x53c51e(456)]
        });
        return;
      }
      let _0x54c898 = _0x1c4661[_0x53c51e(622)].find(function (_0x59f8ca) {
        const _0xffc89e = _0x53c51e;
        return _0x59f8ca.unionID === _0x425ecc[_0xffc89e(468)];
      });
      if (_0x1c4661 && _0x54c898) {
        let _0x33c3e4 = {
          uid: _0xea8502,
          nickname: _0x1c4661.nickname,
          avatar: _0x1c4661[_0x53c51e(484)]
        };
        await commonDao[_0x53c51e(690)]("userBlockModel", {
          ruleID: _0x425ecc.ruleID,
          unionID: _0x425ecc[_0x53c51e(468)]
        }, {
          $pull: {
            userList: {
              uid: _0xea8502
            }
          }
        });
        await commonDao.findOneAndUpdateEx("userBlockModel", {
          ruleID: _0x425ecc.ruleID,
          unionID: _0x425ecc.unionID
        }, {
          $push: {
            userList: _0x33c3e4
          }
        });
        let _0x32e786 = await commonDao.findOneData("userBlockModel", {
          ruleID: _0x425ecc[_0x53c51e(609)],
          unionID: _0x425ecc.unionID
        });
        _0x4ced40(null, {
          code: code.OK,
          ruleData: _0x32e786
        });
        logger[_0x53c51e(525)](_0x53c51e(446));
      } else {
        logger[_0x53c51e(525)](_0x53c51e(638));
        _0x4ced40(null, {
          code: code[_0x53c51e(456)]
        });
        return;
      }
    } else {
      await commonDao[_0x53c51e(690)]("userBlockModel", {
        ruleID: _0x425ecc.ruleID,
        unionID: _0x425ecc[_0x53c51e(468)]
      }, {
        $pull: {
          userList: {
            uid: {
              $in: _0x425ecc[_0x53c51e(455)]
            }
          }
        }
      });
      let _0x8cc0bf = await commonDao[_0x53c51e(695)](_0x53c51e(492), {
        ruleID: _0x425ecc[_0x53c51e(609)],
        unionID: _0x425ecc[_0x53c51e(468)]
      });
      _0x4ced40(null, {
        code: code.OK,
        ruleData: _0x8cc0bf
      });
      logger[_0x53c51e(525)](_0x53c51e(646));
    }
  } catch (_0x474a1c) {
    logger[_0x53c51e(595)](_0x53c51e(680) + _0x474a1c.stack);
    _0x4ced40(null, {
      code: 500
    });
  }
};
Handler[a0_0x5d04f4(395)][a0_0x5d04f4(604)] = async function (_0x5d2e32, _0x1d207b, _0x5304c2) {
  const _0xe4d3e2 = a0_0x5d04f4;
  logger.info(_0xe4d3e2(552) + getSimData(_0x5d2e32) + " sessionUid = " + _0x1d207b[_0xe4d3e2(394)]);
  try {
    if (!_0x1d207b.uid) {
      _0x5304c2(null, {
        code: code.INVALID_UERS
      });
      return;
    }
    if (!_0x5d2e32.unionID) {
      _0x5304c2(null, {
        code: code[_0xe4d3e2(610)]
      });
      return;
    }
    let _0x2a38fe = await userDao[_0xe4d3e2(489)](_0x1d207b[_0xe4d3e2(394)]);
    if (!_0x2a38fe) {
      _0x5304c2(null, {
        code: code[_0xe4d3e2(456)]
      });
      return;
    }
    let _0x5c0097 = await commonDao[_0xe4d3e2(695)](_0xe4d3e2(555), {
      unionID: _0x5d2e32[_0xe4d3e2(468)]
    });
    if (!_0x5c0097) {
      _0x5304c2(null, {
        code: code[_0xe4d3e2(656)]
      });
      return;
    }
    let _0x2114d2 = _0x2a38fe[_0xe4d3e2(622)][_0xe4d3e2(662)](function (_0x467a6c) {
      const _0xa676e6 = _0xe4d3e2;
      return _0x467a6c[_0xa676e6(468)] === _0x5d2e32[_0xa676e6(468)];
    });
    if (!_0x2114d2) {
      _0x5304c2(null, {
        code: code[_0xe4d3e2(610)]
      });
      return;
    }
    logger[_0xe4d3e2(525)]("[userBlockList] ownerUid = " + _0x5c0097.ownerUid + _0xe4d3e2(497) + _0x2114d2[_0xe4d3e2(409)] + _0xe4d3e2(403) + _0x1d207b[_0xe4d3e2(394)]);
    if (_0x5c0097.ownerUid != _0x1d207b[_0xe4d3e2(394)] && !_0x2114d2.manager) {
      _0x5304c2(null, {
        code: code[_0xe4d3e2(610)]
      });
      return;
    }
    let _0x11caec = {
      unionID: _0x5d2e32[_0xe4d3e2(468)]
    };
    let _0x290c14 = await commonDao[_0xe4d3e2(465)](_0xe4d3e2(492), _0x5d2e32[_0xe4d3e2(684)] || 0, _0x5d2e32.count || 20, {
      createTime: 1
    }, _0x11caec);
    _0x5304c2(null, {
      code: code.OK,
      msg: {
        recordArr: _0x290c14[_0xe4d3e2(487)],
        totalCount: _0x290c14[_0xe4d3e2(589)]
      }
    });
    logger[_0xe4d3e2(525)](_0xe4d3e2(415));
  } catch (_0x164005) {
    logger[_0xe4d3e2(595)](_0xe4d3e2(378) + _0x164005.stack);
    _0x5304c2(null, {
      code: 500
    });
  }
};
Handler[a0_0x5d04f4(395)].getUserScore = async function (_0x3f5f14, _0x3d1eee, _0x4933cd) {
  const _0x1938d9 = a0_0x5d04f4;
  try {
    if (!_0x3d1eee.uid) {
      _0x4933cd(null, {
        code: code.INVALID_UERS
      });
      return;
    }
    if (!_0x3f5f14[_0x1938d9(468)]) {
      _0x4933cd(null, {
        code: code.PERMISSION_NOT_ENOUGH
      });
      return;
    }
    let _0x5a17fe = await userDao[_0x1938d9(489)](_0x3d1eee.uid);
    if (!_0x5a17fe) {
      _0x4933cd(null, {
        code: code[_0x1938d9(456)]
      });
      return;
    }
    let _0x53d20e = await commonDao[_0x1938d9(695)](_0x1938d9(555), {
      unionID: _0x3f5f14[_0x1938d9(468)]
    });
    if (!_0x53d20e) {
      _0x4933cd(null, {
        code: code[_0x1938d9(656)]
      });
      return;
    }
    let _0x150782 = _0x5a17fe[_0x1938d9(622)][_0x1938d9(662)](function (_0x195c1b) {
      const _0x39a219 = _0x1938d9;
      return _0x195c1b[_0x39a219(468)] === _0x3f5f14[_0x39a219(468)];
    });
    if (!_0x150782) {
      _0x4933cd(null, {
        code: code.PERMISSION_NOT_ENOUGH
      });
      return;
    }
    if (_0x53d20e[_0x1938d9(558)] != _0x3d1eee[_0x1938d9(394)] && !_0x150782[_0x1938d9(526)] && !_0x150782[_0x1938d9(409)]) {
      _0x4933cd(null, {
        code: code[_0x1938d9(610)]
      });
      return;
    }
    _0x3f5f14[_0x1938d9(614)] == moment().format("YYYYMMDD") && (await userInfoServices[_0x1938d9(528)](_0x3f5f14[_0x1938d9(468)], _0x3f5f14.dayTime));
    let _0x3d2b8d = _0x3d1eee[_0x1938d9(394)];
    _0x150782[_0x1938d9(409)] && (_0x3d2b8d = _0x53d20e[_0x1938d9(558)]);
    let _0x5b5b7a = await userInfoServices.getUserLowAll(_0x3d2b8d, _0x3f5f14[_0x1938d9(468)]);
    let _0x58f489 = {
      uid: {
        $in: _0x5b5b7a
      },
      dayTime: _0x3f5f14[_0x1938d9(614)],
      unionID: _0x3f5f14[_0x1938d9(468)]
    };
    _0x3f5f14[_0x1938d9(394)] && (_0x58f489[_0x1938d9(394)] = _0x3f5f14[_0x1938d9(394)]);
    let _0x3acc05 = {
      score: -1
    };
    if (_0x3f5f14[_0x1938d9(373)] == 1) {
      _0x58f489[_0x1938d9(445)] = {
        $gt: 0
      };
    } else {
      _0x3f5f14[_0x1938d9(373)] == 2 && (_0x58f489[_0x1938d9(445)] = {
        $lt: 0
      }, _0x3acc05 = {
        score: 1
      });
    }
    let _0x3324d2 = await commonDao.findDataAndCount("userScoreModel", _0x3f5f14[_0x1938d9(684)] || 0, _0x3f5f14[_0x1938d9(682)] || 20, _0x3acc05, _0x58f489);
    _0x4933cd(null, {
      code: code.OK,
      msg: {
        recordArr: _0x3324d2.recordArr,
        totalCount: _0x3324d2[_0x1938d9(589)]
      }
    });
  } catch (_0x1991b7) {
    logger.error(_0x1938d9(386) + _0x1991b7[_0x1938d9(454)]);
    _0x4933cd(null, {
      code: 500
    });
  }
};
Handler.prototype.unionMainList = async function (_0x53ff04, _0x24a630, _0x2683d2) {
  const _0x48f880 = a0_0x5d04f4;
  try {
    logger[_0x48f880(525)]("[hall-unionHandler] unionMainList begin");
    if (!_0x24a630.uid) {
      _0x2683d2(null, {
        code: code[_0x48f880(456)]
      });
      return;
    }
    let _0x1dcd55 = {
      isMain: {
        $gt: 0
      }
    };
    logger[_0x48f880(595)](_0x48f880(708) + JSON[_0x48f880(523)](_0x53ff04) + _0x48f880(403) + _0x24a630[_0x48f880(394)]);
    let _0x2475c1 = await commonDao[_0x48f880(475)](_0x48f880(555), _0x1dcd55, {
      isMain: -1
    }, 0, 6);
    for (let _0x39174b = 0; _0x39174b < _0x2475c1[_0x48f880(512)]; _0x39174b++) {
      let _0x453f5f = _0x2475c1[_0x39174b];
      let _0x1dc6fb = _0x453f5f[_0x48f880(468)];
      let _0x27acaf = _0x453f5f[_0x48f880(558)];
      let _0x396cd1 = await userDao[_0x48f880(681)]({
        uid: _0x27acaf
      });
      let _0x4a58e4 = _0x396cd1[_0x48f880(622)].find(function (_0x248b5f) {
        const _0x5a5654 = _0x48f880;
        return _0x248b5f[_0x5a5654(468)] === _0x1dc6fb;
      });
      _0x2475c1[_0x39174b][_0x48f880(547)] = _0x4a58e4 && _0x4a58e4[_0x48f880(547)];
    }
    logger[_0x48f880(525)](_0x48f880(517));
    _0x2683d2(null, {
      code: code.OK,
      msg: {
        result: _0x2475c1
      }
    });
  } catch (_0x3f3647) {
    logger[_0x48f880(595)](_0x48f880(451) + _0x3f3647.stack);
    _0x2683d2(null, {
      code: 500
    });
  }
};
Handler.prototype.userScoreRecord = async function (_0x28078a, _0x28d314, _0x1460ac) {
  const _0xa9bbd7 = a0_0x5d04f4;
  try {
    if (!_0x28d314[_0xa9bbd7(394)]) {
      _0x1460ac(null, {
        code: code[_0xa9bbd7(456)]
      });
      return;
    }
    if (!_0x28078a.unionID) {
      _0x1460ac(null, {
        code: code[_0xa9bbd7(434)]
      });
      return;
    }
    let _0x34064c = {
      uid: _0x28d314[_0xa9bbd7(394)],
      unionID: _0x28078a.unionID,
      createTime: {
        $gte: Date[_0xa9bbd7(477)]() - 3 * DAY_MS
      }
    };
    let _0x19800d = await commonDao[_0xa9bbd7(465)](_0xa9bbd7(490), _0x28078a[_0xa9bbd7(684)] || 0, _0x28078a[_0xa9bbd7(682)] || 20, {
      createTime: -1
    }, _0x34064c);
    _0x1460ac(null, {
      code: code.OK,
      msg: _0x19800d
    });
  } catch (_0x4f3c38) {
    logger[_0xa9bbd7(595)]("[userScoreRecord]" + _0x4f3c38[_0xa9bbd7(454)]);
    _0x1460ac(null, {
      code: 500
    });
  }
};
Handler[a0_0x5d04f4(395)][a0_0x5d04f4(507)] = async function (_0x293a65, _0x52283d, _0x5c7b85) {
  const _0x515b64 = a0_0x5d04f4;
  try {
    if (!_0x52283d[_0x515b64(394)]) {
      _0x5c7b85(null, {
        code: code.INVALID_UERS
      });
      return;
    }
    if (!_0x293a65[_0x515b64(468)]) {
      _0x5c7b85(null, {
        code: code[_0x515b64(610)]
      });
      return;
    }
    let _0x992b9b = await userDao[_0x515b64(489)](_0x52283d[_0x515b64(394)]);
    if (!_0x992b9b) {
      _0x5c7b85(null, {
        code: code[_0x515b64(456)]
      });
      return;
    }
    let _0x1016bf = await commonDao.findOneData(_0x515b64(555), {
      unionID: _0x293a65.unionID
    });
    if (!_0x1016bf) {
      _0x5c7b85(null, {
        code: code[_0x515b64(656)]
      });
      return;
    }
    let _0x5f3eda = _0x992b9b[_0x515b64(622)].find(function (_0x295158) {
      const _0x39560b = _0x515b64;
      return _0x295158[_0x39560b(468)] === _0x293a65[_0x39560b(468)];
    });
    if (!_0x5f3eda) {
      _0x5c7b85(null, {
        code: code[_0x515b64(610)]
      });
      return;
    }
    if (_0x1016bf[_0x515b64(558)] != _0x52283d[_0x515b64(394)] && !_0x5f3eda[_0x515b64(526)] && !_0x5f3eda[_0x515b64(409)]) {
      _0x5c7b85(null, {
        code: code[_0x515b64(610)]
      });
      return;
    }
    let _0x724136 = 0;
    let _0xbe5f66 = 0;
    let _0x59f042 = 0;
    let _0x32e554 = null;
    let _0x295baf = _0x5f3eda[_0x515b64(696)] || 0;
    let _0x16a1e0 = 0;
    let _0x578f32 = 0;
    let _0x5d9758 = 0;
    let _0x253852 = 0;
    let _0x29fa69 = 0;
    let _0x41bf41 = 0;
    let _0x294de4 = 0;
    if (_0x5f3eda.spreaderID) {
      let _0x47c179 = await commonDao[_0x515b64(695)](_0x515b64(488), {
        uid: _0x5f3eda.spreaderID
      });
      _0x47c179 && (_0x32e554 = {
        uid: _0x47c179[_0x515b64(394)],
        nickname: _0x47c179[_0x515b64(692)],
        avatar: _0x47c179.avatar
      });
    }
    let _0x328535 = _0x52283d[_0x515b64(394)];
    _0x5f3eda[_0x515b64(409)] && (_0x328535 = _0x1016bf[_0x515b64(558)]);
    let _0x5e0b19 = {
      unionInfo: {
        $elemMatch: {
          spreaderID: _0x328535,
          unionID: _0x293a65[_0x515b64(468)]
        }
      }
    };
    _0xbe5f66 = await commonDao[_0x515b64(531)](_0x515b64(488), _0x5e0b19);
    let _0xc2013f = await userInfoServices.getUserLowAll(_0x328535, _0x293a65.unionID);
    _0x724136 = _0xc2013f[_0x515b64(512)];
    _0x59f042 = _0x724136 - _0xbe5f66;
    let _0x55af8f = await userInfoServices.getUserDataTotal(_0x293a65[_0x515b64(468)], _0xc2013f);
    _0x578f32 = _0x55af8f[_0x515b64(426)];
    _0x5d9758 = _0x55af8f.yesterdayWinTotal;
    _0x16a1e0 = _0x55af8f[_0x515b64(509)];
    _0x294de4 = _0x55af8f[_0x515b64(568)];
    _0x253852 = _0x55af8f.todayTotalRebate;
    _0x29fa69 = _0x55af8f[_0x515b64(372)];
    let _0x77769b = await userInfoServices[_0x515b64(457)](_0x293a65[_0x515b64(468)], [_0x328535]);
    let _0xba8c36 = _0x77769b[_0x515b64(413)];
    let _0x4f4d69 = _0x77769b[_0x515b64(372)];
    if (_0x1016bf.ownerUid == _0x52283d.uid || _0x5f3eda[_0x515b64(409)]) {
      let _0x263230 = await commonDao.findData(_0x515b64(488), {
        "unionInfo.unionID": _0x293a65[_0x515b64(468)],
        isRobot: true
      }, null, 0, 0);
      let _0x257d5c = [];
      for (let _0x3c799d = 0; _0x3c799d < _0x263230[_0x515b64(512)]; _0x3c799d++) {
        _0x257d5c[_0x515b64(687)](_0x263230[_0x3c799d][_0x515b64(394)]);
      }
    }
    let _0x3b20d2 = {
      testWin: _0x41bf41,
      curUserYesterdayRebate: _0x4f4d69,
      curUserRebate: _0xba8c36,
      totalDraw: _0x294de4,
      memberTotalCount: _0x724136,
      memberCount: _0xbe5f66,
      outMemberCount: _0x59f042,
      spreaderInfo: _0x32e554,
      rebateRate: _0x295baf,
      totalScore: _0x16a1e0,
      todayWin: _0x578f32,
      yesterdayWin: _0x5d9758,
      todayRebate: _0x253852,
      yesterdayRebate: _0x29fa69
    };
    _0x5c7b85(null, {
      code: code.OK,
      msg: _0x3b20d2
    });
  } catch (_0x2a33e9) {
    logger[_0x515b64(595)](_0x515b64(412) + _0x2a33e9[_0x515b64(454)]);
    _0x5c7b85(null, {
      code: 500
    });
  }
};
Handler[a0_0x5d04f4(395)].getMyRebate = async function (_0x13ee64, _0xf96de3, _0x1ed853) {
  const _0x4eef4 = a0_0x5d04f4;
  try {
    if (!_0xf96de3[_0x4eef4(394)]) {
      _0x1ed853(null, {
        code: code[_0x4eef4(456)]
      });
      return;
    }
    if (!_0x13ee64.unionID) {
      _0x1ed853(null, {
        code: code[_0x4eef4(610)]
      });
      return;
    }
    let _0x5149a0 = await userDao[_0x4eef4(489)](_0xf96de3[_0x4eef4(394)]);
    if (!_0x5149a0) {
      _0x1ed853(null, {
        code: code[_0x4eef4(456)]
      });
      return;
    }
    let _0x591407 = await commonDao.findOneData(_0x4eef4(555), {
      unionID: _0x13ee64[_0x4eef4(468)]
    });
    if (!_0x591407) {
      _0x1ed853(null, {
        code: code[_0x4eef4(656)]
      });
      return;
    }
    let _0x21a08f = _0x5149a0[_0x4eef4(622)].find(function (_0x337d01) {
      const _0x536786 = _0x4eef4;
      return _0x337d01.unionID === _0x13ee64[_0x536786(468)];
    });
    if (!_0x21a08f) {
      _0x1ed853(null, {
        code: code[_0x4eef4(610)]
      });
      return;
    }
    if (_0x591407[_0x4eef4(558)] != _0xf96de3[_0x4eef4(394)] && !_0x21a08f.partner) {
      _0x1ed853(null, {
        code: code[_0x4eef4(610)]
      });
      return;
    }
    let _0x3877c7 = _0x21a08f[_0x4eef4(637)];
    let _0x520653 = _0x21a08f.todayRebate;
    let _0x4c7a30 = _0x21a08f[_0x4eef4(459)];
    let _0x255948 = {
      safeScore: _0x3877c7,
      todayRebate: _0x520653,
      yesterdayRebate: _0x4c7a30
    };
    if (_0x13ee64[_0x4eef4(373)] != 1) {
      let _0x1ea6ef = _0xf96de3[_0x4eef4(394)];
      let _0x4a8189 = {
        uid: _0x1ea6ef,
        unionID: _0x13ee64[_0x4eef4(468)]
      };
      let _0x402ddd = await commonDao[_0x4eef4(465)](_0x4eef4(433), _0x13ee64.startIndex || 0, _0x13ee64[_0x4eef4(682)] || 20, {
        createTime: -1
      }, _0x4a8189);
      _0x255948[_0x4eef4(487)] = _0x402ddd[_0x4eef4(487)];
      _0x255948[_0x4eef4(542)] = _0x402ddd[_0x4eef4(589)];
    }
    _0x1ed853(null, {
      code: code.OK,
      msg: _0x255948
    });
  } catch (_0x45a1ee) {
    logger[_0x4eef4(595)](_0x4eef4(502) + _0x45a1ee[_0x4eef4(454)]);
    _0x1ed853(null, {
      code: 500
    });
  }
};
Handler.prototype[a0_0x5d04f4(541)] = async function (_0x21c4fc, _0x1f1763, _0x24a831) {
  const _0x1b3c81 = a0_0x5d04f4;
  logger[_0x1b3c81(525)](_0x1b3c81(447) + getSimData(_0x21c4fc) + _0x1b3c81(403) + _0x1f1763[_0x1b3c81(394)]);
  try {
    if (!_0x1f1763[_0x1b3c81(394)]) {
      _0x24a831(null, {
        code: code[_0x1b3c81(456)]
      });
      return;
    }
    if (!_0x21c4fc[_0x1b3c81(468)] || !_0x21c4fc[_0x1b3c81(613)] || !_0x21c4fc[_0x1b3c81(424)]) {
      _0x24a831(null, {
        code: code[_0x1b3c81(456)]
      });
      return;
    }
    let _0x561f13 = await commonDao[_0x1b3c81(695)](_0x1b3c81(555), {
      unionID: _0x21c4fc[_0x1b3c81(468)]
    });
    if (!_0x561f13) {
      _0x24a831(null, {
        code: code[_0x1b3c81(656)]
      });
      return;
    }
    let _0x3ee0ec = await userDao.getUserDataByUid(_0x1f1763[_0x1b3c81(394)]);
    if (!_0x3ee0ec) {
      _0x24a831(null, {
        code: code[_0x1b3c81(456)]
      });
      return;
    }
    let _0x43e8d4 = _0x3ee0ec[_0x1b3c81(622)][_0x1b3c81(662)](function (_0x3d320d) {
      const _0x32ce7c = _0x1b3c81;
      return _0x3d320d[_0x32ce7c(468)] === _0x21c4fc[_0x32ce7c(468)];
    });
    if (!_0x43e8d4 || _0x561f13[_0x1b3c81(558)] != _0x1f1763[_0x1b3c81(394)]) {
      _0x24a831(null, {
        code: code[_0x1b3c81(610)]
      });
      return;
    }
    logger.info(_0x1b3c81(381) + _0x561f13.ownerUid + _0x1b3c81(403) + _0x1f1763[_0x1b3c81(394)]);
    let _0x5d38bc = await userDao[_0x1b3c81(489)](_0x21c4fc[_0x1b3c81(424)]);
    if (!_0x5d38bc) {
      _0x24a831(null, {
        code: code[_0x1b3c81(456)]
      });
      return;
    }
    let _0x2ed401 = _0x5d38bc[_0x1b3c81(622)][_0x1b3c81(662)](function (_0x22ed82) {
      const _0x50fecd = _0x1b3c81;
      return _0x22ed82[_0x50fecd(468)] === _0x21c4fc[_0x50fecd(468)];
    });
    if (!_0x2ed401 || !_0x2ed401[_0x1b3c81(526)]) {
      _0x24a831(null, {
        code: code.PERMISSION_NOT_ENOUGH
      });
      return;
    }
    let _0x1ae157 = await userDao[_0x1b3c81(489)](_0x21c4fc[_0x1b3c81(613)]);
    if (!_0x1ae157) {
      _0x24a831(null, {
        code: code.INVALID_UERS
      });
      return;
    }
    let _0x1d1b32 = _0x1ae157.unionInfo[_0x1b3c81(662)](function (_0x53a66d) {
      return _0x53a66d.unionID === _0x21c4fc.unionID;
    });
    if (!_0x1d1b32) {
      _0x24a831(null, {
        code: code[_0x1b3c81(602)]
      });
      return;
    }
    let _0x447f0d = await userInfoServices[_0x1b3c81(360)](_0x1ae157[_0x1b3c81(394)], _0x21c4fc[_0x1b3c81(468)]);
    if (_0x447f0d[_0x1b3c81(655)](_0x21c4fc[_0x1b3c81(424)])) {
      _0x24a831(null, {
        code: code[_0x1b3c81(585)]
      });
      return;
    }
    await userDao[_0x1b3c81(660)]({
      uid: _0x21c4fc[_0x1b3c81(613)],
      "unionInfo.unionID": _0x21c4fc.unionID
    }, {
      "unionInfo.$.spreaderID": _0x21c4fc[_0x1b3c81(424)]
    });
    logger[_0x1b3c81(525)](_0x1b3c81(633));
    _0x24a831(null, {
      code: code.OK
    });
  } catch (_0x352899) {
    logger[_0x1b3c81(595)]("[removePartner]" + _0x352899[_0x1b3c81(454)]);
    _0x24a831(null, {
      code: 500
    });
  }
};
Handler[a0_0x5d04f4(395)][a0_0x5d04f4(469)] = async function (_0x39f64e, _0x3ca93e, _0x26cb0a) {
  const _0x250918 = a0_0x5d04f4;
  logger.info(_0x250918(416) + getSimData(_0x39f64e) + _0x250918(403) + _0x3ca93e[_0x250918(394)]);
  try {
    if (!_0x3ca93e[_0x250918(394)]) {
      _0x26cb0a(null, {
        code: code[_0x250918(456)]
      });
      return;
    }
    if (!userListPenging[_0x3ca93e[_0x250918(394)]]) {
      userListPenging[_0x3ca93e[_0x250918(394)]] = moment();
    } else {
      if (moment()[_0x250918(550)](userListPenging[_0x3ca93e[_0x250918(394)]], "s") < 5) {
        _0x26cb0a(null, {
          code: code[_0x250918(434)]
        });
        return;
      }
      userListPenging[_0x3ca93e.uid] = moment();
    }
    let _0x50b0ae = _0x39f64e.unionName;
    if (!_0x50b0ae || _0x50b0ae[_0x250918(512)] > 20) {
      _0x26cb0a(null, {
        code: code[_0x250918(434)]
      });
      return;
    }
    let _0xe7c9f6 = await userDao[_0x250918(489)](_0x3ca93e.uid);
    if (!_0xe7c9f6[_0x250918(389)]) {
      _0x26cb0a(null, {
        code: code[_0x250918(434)]
      });
      return;
    }
    let _0x3bb9f4 = await commonDao[_0x250918(695)](_0x250918(555), {
      unionName: _0x50b0ae
    });
    if (!!_0x3bb9f4) {
      _0x26cb0a(null, {
        code: code[_0x250918(693)]
      });
      return;
    }
    let _0x196890 = {
      ownerUid: _0x3ca93e[_0x250918(394)],
      ownerNickname: _0xe7c9f6.nickname,
      ownerAvatar: _0xe7c9f6.avatar,
      unionName: _0x50b0ae,
      unionSkinId: _0x39f64e.unionSkinId,
      unionType: _0x39f64e.unionType || 0,
      ownerPhone: _0x39f64e[_0x250918(521)] || null,
      ownerWeChat: _0x39f64e.ownerWeChat || null,
      curMember: 1,
      createTime: Date[_0x250918(477)]()
    };
    let _0x2ff6ef = await commonDao[_0x250918(532)](_0x250918(555), _0x196890);
    if (!_0x2ff6ef) {
      _0x26cb0a(null, {
        code: code[_0x250918(374)]
      });
      return;
    }
    let _0x359308 = {
      unionID: _0x2ff6ef[_0x250918(468)],
      partner: true,
      rebateRate: 1,
      ticketRate: 1,
      fixScoreRate: 1,
      joinTime: Date[_0x250918(477)](),
      inviteID: _0x3acda5.unionInviteID
    };
    let _0x3acda5 = await commonDao[_0x250918(690)]("uniqueIDModel", {
      key: 1
    }, {
      $inc: {
        unionInviteID: 7
      }
    }, {
      new: true,
      upsert: true
    });
    let _0xc7390a = await userDao[_0x250918(618)](_0x3ca93e.uid, {
      $addToSet: {
        unionInfo: _0x359308
      }
    });
    _0x26cb0a(null, {
      code: code.OK,
      updateUserData: {
        unionInfo: _0xc7390a.unionInfo
      },
      msg: {
        unionID: _0x2ff6ef.unionID
      }
    });
    logger[_0x250918(525)](_0x250918(376));
  } catch (_0x125be7) {
    logger[_0x250918(595)](_0x250918(677) + _0x125be7[_0x250918(454)]);
    _0x26cb0a(null, {
      code: 500
    });
  }
};
Handler[a0_0x5d04f4(395)][a0_0x5d04f4(504)] = async function (_0x12ac8c, _0x1f3294, _0x37e7f9) {
  const _0x3e90de = a0_0x5d04f4;
  logger[_0x3e90de(525)]("[askJoinUnion] msg = " + getSimData(_0x12ac8c) + _0x3e90de(403) + _0x1f3294[_0x3e90de(394)]);
  try {
    if (!_0x1f3294[_0x3e90de(394)]) {
      _0x37e7f9(null, {
        code: code.INVALID_UERS
      });
      return;
    }
    let _0x3fd2dd = parseInt(_0x12ac8c.inviteID || "0");
    if (!_0x3fd2dd) {
      _0x37e7f9(null, {
        code: code.REQUEST_DATA_ERROR
      });
      return;
    }
    let _0x2d6ab1 = await userDao[_0x3e90de(681)]({
      "unionInfo.inviteID": _0x3fd2dd
    });
    if (!_0x2d6ab1) {
      _0x37e7f9(null, {
        code: code[_0x3e90de(441)]
      });
      return;
    }
    let _0x309365 = _0x2d6ab1[_0x3e90de(622)].find(function (_0x3102fd) {
      return _0x3102fd.inviteID === _0x3fd2dd;
    });
    if (!_0x309365) {
      _0x37e7f9(null, {
        code: code[_0x3e90de(441)]
      });
      return;
    }
    let _0x56c1cd = await commonDao[_0x3e90de(695)](_0x3e90de(555), {
      unionID: _0x309365[_0x3e90de(468)]
    });
    if (!_0x56c1cd) {
      _0x37e7f9(null, {
        code: code[_0x3e90de(656)]
      });
      return;
    }
    if (_0x56c1cd[_0x3e90de(540)]) {
      _0x37e7f9(null, {
        code: code[_0x3e90de(562)]
      });
      return;
    }
    if (!!_0x56c1cd[_0x3e90de(630)] && _0x1f3294.uid !== _0x56c1cd[_0x3e90de(558)]) {
      _0x37e7f9(null, {
        code: code.FORBID_INVITE_SCORE
      });
      return;
    }
    let _0x56b482 = await userDao.getUserData({
      uid: _0x1f3294[_0x3e90de(394)]
    });
    if (_0x56b482.unionInfo[_0x3e90de(662)](_0x340fdc => _0x340fdc[_0x3e90de(468)] == _0x309365[_0x3e90de(468)])) {
      _0x37e7f9(null, {
        code: code[_0x3e90de(398)]
      });
      return;
    }
    if (!_0x56c1cd.joinVerify) {
      let _0x550287 = _0x56c1cd[_0x3e90de(364)];
      if (_0x550287.find(_0x4187d4 => _0x4187d4.uid == _0x1f3294[_0x3e90de(394)])) {
        _0x37e7f9(null, {
          code: code[_0x3e90de(628)]
        });
        return;
      }
      await await commonDao[_0x3e90de(505)](_0x3e90de(555), {
        unionID: _0x309365[_0x3e90de(468)]
      }, {
        $push: {
          joinRequestList: {
            inviteID: _0x12ac8c.inviteID,
            spreaderID: _0x2d6ab1[_0x3e90de(394)],
            uid: _0x56b482[_0x3e90de(394)],
            nickname: _0x56b482[_0x3e90de(692)],
            avatar: _0x56b482[_0x3e90de(484)],
            createTime: Date[_0x3e90de(477)]()
          }
        }
      });
      logger.info(_0x3e90de(460));
      _0x37e7f9(null, {
        code: code.OK
      });
    } else {
      await commonDao[_0x3e90de(505)]("unionModel", {
        unionID: _0x309365[_0x3e90de(468)]
      }, {
        $inc: {
          curMember: 1
        }
      });
      let _0x142804 = {
        spreaderID: _0x2d6ab1.uid,
        unionID: _0x309365[_0x3e90de(468)],
        joinTime: Date.now()
      };
      let _0x1b8c57 = await commonDao.findOneAndUpdateEx(_0x3e90de(642), {
        key: 1
      }, {
        $inc: {
          unionInviteID: 7
        }
      }, {
        new: true,
        upsert: true
      });
      _0x142804[_0x3e90de(547)] = _0x1b8c57[_0x3e90de(631)];
      let _0x4d0518 = await userDao.updateUserDataByUid(_0x1f3294.uid, {
        $push: {
          unionInfo: _0x142804
        }
      });
      _0x37e7f9(null, {
        code: code.OK,
        updateUserData: {
          unionInfo: _0x4d0518.unionInfo
        },
        msg: {
          unionID: _0x309365[_0x3e90de(468)]
        }
      });
      logger[_0x3e90de(525)](_0x3e90de(470));
    }
  } catch (_0x2d40d3) {
    logger.error("[askjoinUnion]" + _0x2d40d3.stack);
    _0x37e7f9(null, {
      code: 500
    });
  }
};
Handler[a0_0x5d04f4(395)][a0_0x5d04f4(671)] = async function (_0x39be50, _0x298c48, _0x3b3d00) {
  const _0x4caa7d = a0_0x5d04f4;
  try {
    if (!_0x298c48[_0x4caa7d(394)]) {
      _0x3b3d00(null, {
        code: code.INVALID_UERS
      });
      return;
    }
    let _0x4a2d36 = await commonDao[_0x4caa7d(695)](_0x4caa7d(555), {
      unionID: _0x39be50[_0x4caa7d(468)]
    });
    if (!_0x4a2d36) {
      _0x3b3d00(null, {
        code: code[_0x4caa7d(656)]
      });
      return;
    }
    let _0x35a70b = await userDao[_0x4caa7d(681)]({
      uid: _0x298c48.uid
    });
    let _0x37456f = _0x35a70b[_0x4caa7d(622)][_0x4caa7d(662)](_0x3aba66 => _0x3aba66[_0x4caa7d(468)] == _0x39be50[_0x4caa7d(468)]);
    let _0x5d5806 = [];
    _0x37456f && (_0x4a2d36[_0x4caa7d(558)] == _0x298c48[_0x4caa7d(394)] || _0x37456f[_0x4caa7d(409)]) && (_0x5d5806 = _0x4a2d36.joinRequestList);
    _0x3b3d00(null, {
      code: code.OK,
      list: _0x5d5806
    });
  } catch (_0x426be9) {
    logger[_0x4caa7d(595)](_0x4caa7d(439) + _0x426be9[_0x4caa7d(454)]);
    _0x3b3d00(null, {
      code: 500
    });
  }
};
Handler[a0_0x5d04f4(395)][a0_0x5d04f4(606)] = async function (_0x26084c, _0x5d7f77, _0x358594) {
  const _0x1d90c4 = a0_0x5d04f4;
  logger[_0x1d90c4(525)](_0x1d90c4(377) + getSimData(_0x26084c) + _0x1d90c4(403) + _0x5d7f77[_0x1d90c4(394)]);
  try {
    if (!_0x5d7f77[_0x1d90c4(394)] || !_0x26084c[_0x1d90c4(394)]) {
      _0x358594(null, {
        code: code[_0x1d90c4(456)]
      });
      return;
    }
    let _0x55ea4c = _0x26084c[_0x1d90c4(547)];
    let _0x4cbc59 = await userDao[_0x1d90c4(681)]({
      "unionInfo.inviteID": _0x55ea4c
    });
    if (!_0x4cbc59) {
      _0x358594(null, {
        code: code[_0x1d90c4(441)]
      });
      return;
    }
    let _0x5d2e36 = _0x4cbc59.unionInfo.find(function (_0x38b4d6) {
      const _0x22f561 = _0x1d90c4;
      return _0x38b4d6[_0x22f561(547)] == _0x55ea4c;
    });
    if (!_0x5d2e36) {
      _0x358594(null, {
        code: code[_0x1d90c4(441)]
      });
      return;
    }
    let _0x2060be = await commonDao[_0x1d90c4(695)](_0x1d90c4(555), {
      unionID: _0x5d2e36.unionID
    });
    if (!_0x2060be) {
      _0x358594(null, {
        code: code[_0x1d90c4(656)]
      });
      return;
    }
    if (!!_0x2060be[_0x1d90c4(630)] && (_0x5d7f77[_0x1d90c4(394)] !== _0x2060be[_0x1d90c4(558)] || !_0x5d2e36[_0x1d90c4(526)])) {
      _0x358594(null, {
        code: code[_0x1d90c4(527)]
      });
      return;
    }
    await await commonDao.updateData(_0x1d90c4(555), {
      unionID: _0x5d2e36[_0x1d90c4(468)]
    }, {
      $inc: {
        curMember: 1
      },
      $pull: {
        joinRequestList: {
          inviteID: _0x26084c.inviteID,
          uid: _0x26084c.uid
        }
      }
    });
    if (_0x26084c[_0x1d90c4(430)]) {
      let _0x35f078 = {
        spreaderID: _0x4cbc59[_0x1d90c4(394)],
        unionID: _0x5d2e36[_0x1d90c4(468)],
        joinTime: Date[_0x1d90c4(477)]()
      };
      let _0x549fce = await commonDao[_0x1d90c4(690)](_0x1d90c4(642), {
        key: 1
      }, {
        $inc: {
          unionInviteID: 7
        }
      }, {
        new: true,
        upsert: true
      });
      _0x35f078[_0x1d90c4(547)] = _0x549fce[_0x1d90c4(631)];
      let _0xaff5a7 = await userDao[_0x1d90c4(618)](_0x26084c[_0x1d90c4(394)], {
        $push: {
          unionInfo: _0x35f078
        }
      });
      if (!!_0xaff5a7[_0x1d90c4(514)]) {
        userInfoServices.updateUserDataNotify(_0xaff5a7[_0x1d90c4(394)], _0xaff5a7[_0x1d90c4(514)], {
          unionInfo: _0xaff5a7.unionInfo
        }).catch(_0x3b7c7a => {
          const _0x12547b = _0x1d90c4;
          logger[_0x12547b(595)](_0x3b7c7a[_0x12547b(454)]);
        });
      }
      logger[_0x1d90c4(525)](_0x1d90c4(530));
    }
    _0x358594(null, {
      code: code.OK
    });
  } catch (_0x59a9d3) {
    logger[_0x1d90c4(595)](_0x1d90c4(699) + _0x59a9d3[_0x1d90c4(454)]);
    _0x358594(null, {
      code: 500
    });
  }
};
Handler.prototype.joinUnion = async function (_0x28ee72, _0x597c4e, _0x4cecae) {
  const _0x2492cd = a0_0x5d04f4;
  try {
    if (!_0x597c4e[_0x2492cd(394)]) {
      _0x4cecae(null, {
        code: code[_0x2492cd(456)]
      });
      return;
    }
    let _0x71d76 = parseInt(_0x28ee72[_0x2492cd(547)] || "0");
    if (!_0x71d76) {
      _0x4cecae(null, {
        code: code.REQUEST_DATA_ERROR
      });
      return;
    }
    let _0x2d93c8 = await userDao[_0x2492cd(681)]({
      "unionInfo.inviteID": _0x71d76
    });
    if (!_0x2d93c8) {
      _0x4cecae(null, {
        code: code.INVITE_ID_ERROR
      });
      return;
    }
    let _0x3de7e9 = _0x2d93c8[_0x2492cd(622)][_0x2492cd(662)](function (_0x4e0369) {
      const _0x15f5fb = _0x2492cd;
      return _0x4e0369[_0x15f5fb(547)] === _0x71d76;
    });
    if (!_0x3de7e9) {
      _0x4cecae(null, {
        code: code[_0x2492cd(441)]
      });
      return;
    }
    let _0x31b47b = await commonDao[_0x2492cd(695)](_0x2492cd(555), {
      unionID: _0x3de7e9.unionID
    });
    if (!_0x31b47b) {
      _0x4cecae(null, {
        code: code[_0x2492cd(656)]
      });
      return;
    }
    if (!!_0x31b47b[_0x2492cd(630)] && _0x597c4e.uid !== _0x31b47b[_0x2492cd(558)]) {
      _0x4cecae(null, {
        code: code[_0x2492cd(527)]
      });
      return;
    }
    let _0x4bc638 = await userDao[_0x2492cd(681)]({
      uid: _0x597c4e[_0x2492cd(394)]
    });
    for (let _0x12957f = 0; _0x12957f < _0x4bc638[_0x2492cd(622)].length; ++_0x12957f) {
      let _0x54cca7 = _0x4bc638.unionInfo[_0x12957f];
      if (_0x54cca7[_0x2492cd(468)] === _0x3de7e9[_0x2492cd(468)]) {
        _0x4cecae(null, {
          code: code[_0x2492cd(398)]
        });
        return;
      }
    }
    await await commonDao[_0x2492cd(505)](_0x2492cd(555), {
      unionID: _0x3de7e9[_0x2492cd(468)]
    }, {
      $inc: {
        curMember: 1
      }
    });
    let _0x186818 = {
      spreaderID: _0x2d93c8[_0x2492cd(394)],
      unionID: _0x3de7e9[_0x2492cd(468)],
      joinTime: Date.now()
    };
    let _0x4fb834 = await commonDao[_0x2492cd(690)](_0x2492cd(642), {
      key: 1
    }, {
      $inc: {
        unionInviteID: 7
      }
    }, {
      new: true,
      upsert: true
    });
    _0x186818[_0x2492cd(547)] = _0x4fb834[_0x2492cd(631)];
    let _0x4187c3 = await userDao.updateUserDataByUid(_0x597c4e[_0x2492cd(394)], {
      $push: {
        unionInfo: _0x186818
      }
    });
    _0x4cecae(null, {
      code: code.OK,
      updateUserData: {
        unionInfo: _0x4187c3[_0x2492cd(622)]
      },
      msg: {
        unionID: _0x3de7e9.unionID
      }
    });
  } catch (_0x278e37) {
    logger.error(_0x2492cd(481) + _0x278e37[_0x2492cd(454)]);
    _0x4cecae(null, {
      code: 500
    });
  }
};
Handler[a0_0x5d04f4(395)][a0_0x5d04f4(575)] = async function (_0x155563, _0x1f9955, _0x567e9d) {
  const _0x490d2c = a0_0x5d04f4;
  logger[_0x490d2c(525)]("[exitUnion] msg = " + getSimData(_0x155563) + _0x490d2c(403) + _0x1f9955[_0x490d2c(394)]);
  try {
    if (!_0x1f9955[_0x490d2c(394)]) {
      _0x567e9d(null, {
        code: code.INVALID_UERS
      });
      return;
    }
    if (!_0x155563.unionID) {
      _0x567e9d(null, {
        code: code[_0x490d2c(434)]
      });
      return;
    }
    let _0x4f775f = await commonDao[_0x490d2c(695)](_0x490d2c(555), {
      unionID: _0x155563[_0x490d2c(468)]
    });
    if (!_0x4f775f) {
      let _0x3a628f = await userDao.updateUserDataByUid(_0x1f9955[_0x490d2c(394)], {
        $push: {
          unionInfo: {
            unionID: _0x155563[_0x490d2c(468)]
          }
        }
      });
      _0x567e9d(null, {
        code: code.OK,
        updateUserData: {
          unionInfo: _0x3a628f[_0x490d2c(622)]
        }
      });
      return;
    }
    if (_0x4f775f.ownerUid === _0x1f9955[_0x490d2c(394)]) {
      _0x567e9d(null, {
        code: code.REQUEST_DATA_ERROR
      });
      return;
    }
    let _0x487c45 = await userDao[_0x490d2c(681)]({
      uid: _0x1f9955[_0x490d2c(394)],
      "unionInfo.unionID": _0x155563.unionID
    });
    if (!_0x487c45) {
      _0x567e9d(null, {
        code: code.OK
      });
      return;
    }
    let _0x262300 = null;
    for (let _0x3adb7f = 0; _0x3adb7f < _0x487c45[_0x490d2c(622)][_0x490d2c(512)]; ++_0x3adb7f) {
      if (_0x487c45[_0x490d2c(622)][_0x3adb7f][_0x490d2c(468)] === _0x155563[_0x490d2c(468)]) {
        _0x262300 = _0x487c45[_0x490d2c(622)][_0x3adb7f];
        break;
      }
    }
    if (!_0x262300) {
      _0x567e9d(null, {
        code: code.OK
      });
      return;
    }
    if (_0x262300[_0x490d2c(445)] > 1 || _0x262300[_0x490d2c(445)] < 0) {
      _0x567e9d(null, {
        code: code[_0x490d2c(434)]
      });
      return;
    }
    let _0x14e8aa = await userDao[_0x490d2c(618)](_0x1f9955[_0x490d2c(394)], {
      $pull: {
        unionInfo: {
          unionID: _0x155563[_0x490d2c(468)]
        }
      }
    });
    await commonDao.updateAllData("userModel", {
      unionInfo: {
        $elemMatch: {
          spreaderID: _0x1f9955[_0x490d2c(394)],
          unionID: _0x155563[_0x490d2c(468)]
        }
      }
    }, {
      "unionInfo.$.spreaderID": _0x262300[_0x490d2c(486)]
    });
    commonDao.updateData(_0x490d2c(555), {
      unionID: _0x155563.unionID
    }, {
      $inc: {
        curMember: -1
      }
    }).catch(_0x58ab96 => {
      const _0x3a7271 = _0x490d2c;
      logger.error(_0x58ab96[_0x3a7271(454)]);
    });
    _0x567e9d(null, {
      code: code.OK,
      updateUserData: {
        unionInfo: _0x14e8aa.unionInfo
      }
    });
    logger[_0x490d2c(525)](_0x490d2c(571));
  } catch (_0x16bb88) {
    logger.error(_0x490d2c(597) + _0x16bb88[_0x490d2c(454)]);
    _0x567e9d(null, {
      code: 500
    });
  }
};
Handler.prototype.getUserUnionList = async function (_0x3f822a, _0x3badfd, _0x787b25) {
  const _0x295887 = a0_0x5d04f4;
  try {
    if (!_0x3badfd[_0x295887(394)]) {
      _0x787b25(null, {
        code: code[_0x295887(456)]
      });
      return;
    }
    let _0x40df99 = await userDao.getUserDataByUid(_0x3badfd[_0x295887(394)]);
    let _0x205561 = [];
    for (let _0x3667ef = 0; _0x3667ef < _0x40df99[_0x295887(622)][_0x295887(512)]; ++_0x3667ef) {
      _0x205561[_0x295887(687)](_0x40df99.unionInfo[_0x3667ef][_0x295887(468)]);
    }
    if (_0x205561[_0x295887(512)] === 0) {
      _0x787b25(null, {
        code: code.OK,
        msg: {
          recordArr: []
        }
      });
      return;
    }
    let _0x4c4a1e = await commonDao[_0x295887(475)](_0x295887(555), {
      unionID: {
        $in: _0x205561
      },
      isDel: {
        $ne: true
      }
    });
    let _0x45cd0a = [];
    for (let _0x2cf3be = 0; _0x2cf3be < _0x4c4a1e[_0x295887(512)]; ++_0x2cf3be) {
      let _0x19e90f = _0x4c4a1e[_0x2cf3be];
      _0x45cd0a[_0x295887(687)]({
        unionID: _0x19e90f[_0x295887(468)],
        unionName: _0x19e90f.unionName,
        ownerUid: _0x19e90f[_0x295887(558)],
        ownerAvatar: _0x19e90f[_0x295887(653)],
        ownerNickname: _0x19e90f[_0x295887(510)],
        memberCount: _0x19e90f.curMember,
        onlineCount: _0x19e90f[_0x295887(402)],
        tableColor: _0x19e90f[_0x295887(499)],
        unionBg: _0x19e90f[_0x295887(599)],
        tableStyle: _0x19e90f[_0x295887(582)],
        emptyTable: _0x19e90f[_0x295887(545)],
        isInvite: _0x19e90f[_0x295887(590)],
        unionSkinId: _0x19e90f[_0x295887(491)],
        unionType: _0x19e90f[_0x295887(428)],
        disApplyCount: _0x19e90f[_0x295887(669)],
        inviteLimit: _0x19e90f.inviteLimit,
        joinVerify: _0x19e90f[_0x295887(382)],
        propsLimit: _0x19e90f[_0x295887(450)],
        tableHideCount: _0x19e90f[_0x295887(581)],
        unReadyKick: _0x19e90f[_0x295887(601)],
        groupLimit: _0x19e90f[_0x295887(619)],
        tableSort: _0x19e90f[_0x295887(534)],
        dismissType: _0x19e90f[_0x295887(688)],
        canNegativeScore: _0x19e90f[_0x295887(495)]
      });
    }
    _0x787b25(null, {
      code: code.OK,
      msg: {
        recordArr: _0x45cd0a
      }
    });
  } catch (_0x1a9372) {
    logger.error(_0x295887(371) + _0x1a9372.stack);
    _0x787b25(null, {
      code: 500
    });
  }
};
Handler.prototype[a0_0x5d04f4(425)] = async function (_0x6a2452, _0x21b316, _0x1dd732) {
  const _0xc62a39 = a0_0x5d04f4;
  try {
    if (!_0x21b316[_0xc62a39(394)]) {
      _0x1dd732(null, {
        code: code[_0xc62a39(456)]
      });
      return;
    }
    if (!_0x6a2452.unionID) {
      _0x1dd732(null, {
        code: code[_0xc62a39(434)]
      });
      return;
    }
    logger[_0xc62a39(595)]("getAllOnLineList msg = " + JSON[_0xc62a39(523)](_0x6a2452) + _0xc62a39(403) + _0x21b316[_0xc62a39(394)]);
    let _0x47ca19 = await commonDao.findDataAndCount(_0xc62a39(488), _0x6a2452.startIndex || 0, _0x6a2452[_0xc62a39(682)] || 20, {
      frontendId: 1,
      roomID: 1
    }, _0x6a2452.matchData);
    let _0x4f23bf = await commonDao[_0xc62a39(531)](_0xc62a39(488), _0x6a2452[_0xc62a39(554)]);
    let _0x999d67 = [];
    for (let _0x2c02e1 = 0; _0x2c02e1 < _0x47ca19[_0xc62a39(487)][_0xc62a39(512)]; ++_0x2c02e1) {
      let _0x3cd206 = _0x47ca19.recordArr[_0x2c02e1];
      let _0x5703eb = _0x3cd206[_0xc62a39(622)][_0xc62a39(662)](function (_0x4f2c54) {
        const _0x5d8b2e = _0xc62a39;
        return _0x4f2c54[_0x5d8b2e(468)] === _0x6a2452.unionID;
      });
      let _0x316984 = null;
      if (_0x5703eb.spreaderID) {
        let _0x37c9f2 = await commonDao[_0xc62a39(695)](_0xc62a39(488), {
          uid: _0x5703eb[_0xc62a39(486)]
        });
        _0x37c9f2 && (_0x316984 = {
          uid: _0x37c9f2[_0xc62a39(394)],
          nickname: utils.getNickName(_0x37c9f2[_0xc62a39(692)]),
          avatar: _0x37c9f2[_0xc62a39(484)]
        });
      }
      if (_0x3cd206[_0xc62a39(514)] == "") {
        continue;
      }
      _0x999d67[_0xc62a39(687)]({
        uid: _0x3cd206.uid,
        avatar: _0x3cd206[_0xc62a39(484)],
        nickname: utils[_0xc62a39(508)](_0x3cd206[_0xc62a39(692)]),
        lastLoginTime: _0x3cd206[_0xc62a39(627)],
        roomID: _0x3cd206.roomID,
        frontendId: _0x3cd206.frontendId
      });
    }
    _0x1dd732(null, {
      code: code.OK,
      msg: {
        recordArr: _0x999d67,
        recordCount: _0x4f23bf
      }
    });
  } catch (_0x264e3f) {
    logger.error(_0xc62a39(577) + _0x264e3f.stack);
    _0x1dd732(null, {
      code: 500
    });
  }
};
Handler[a0_0x5d04f4(395)].getMemberList = async function (_0x199b09, _0x155166, _0x3a34fa) {
  const _0x3363ed = a0_0x5d04f4;
  logger[_0x3363ed(525)](_0x3363ed(478) + getSimData(_0x199b09) + _0x3363ed(403) + _0x155166[_0x3363ed(394)]);
  try {
    if (!_0x155166[_0x3363ed(394)]) {
      _0x3a34fa(null, {
        code: code[_0x3363ed(456)]
      });
      return;
    }
    if (!_0x199b09[_0x3363ed(468)]) {
      _0x3a34fa(null, {
        code: code[_0x3363ed(434)]
      });
      return;
    }
    let _0xccf1b0 = await commonDao[_0x3363ed(465)](_0x3363ed(488), _0x199b09[_0x3363ed(684)] || 0, _0x199b09.count || 20, {
      "unionInfo.joinTime": 1
    }, _0x199b09[_0x3363ed(554)]);
    let _0x14c130 = _0xccf1b0[_0x3363ed(589)];
    let _0x210ed6 = [];
    if (_0x199b09[_0x3363ed(474)]) {
      for (let _0x3a0eab = 0; _0x3a0eab < _0xccf1b0[_0x3363ed(487)].length; ++_0x3a0eab) {
        let _0x1559ae = _0xccf1b0[_0x3363ed(487)][_0x3a0eab];
        let _0x5ebe8b = _0x1559ae[_0x3363ed(622)].find(function (_0x7540ae) {
          const _0x55f400 = _0x3363ed;
          return _0x7540ae.unionID === _0x199b09[_0x55f400(468)];
        });
        let _0x4a3d7f = null;
        if (_0x5ebe8b[_0x3363ed(486)]) {
          let _0x5eab55 = await commonDao.findOneData(_0x3363ed(488), {
            uid: _0x5ebe8b[_0x3363ed(486)]
          });
          _0x5eab55 && (_0x4a3d7f = {
            uid: _0x5eab55.uid,
            nickname: utils.getNickName(_0x5eab55.nickname),
            avatar: _0x5eab55[_0x3363ed(484)]
          });
        }
        _0x210ed6[_0x3363ed(687)]({
          spreaderInfo: _0x4a3d7f,
          uid: _0x1559ae[_0x3363ed(394)],
          nickname: utils[_0x3363ed(508)](_0x1559ae[_0x3363ed(692)]),
          lastLoginTime: _0x1559ae.lastLoginTime,
          avatar: _0x1559ae[_0x3363ed(484)],
          isRobot: _0x1559ae[_0x3363ed(472)],
          frontendId: _0x1559ae[_0x3363ed(514)],
          roomID: _0x1559ae.roomID,
          spreaderID: _0x5ebe8b[_0x3363ed(486)],
          score: _0x5ebe8b[_0x3363ed(445)],
          safeScore: _0x5ebe8b.safeScore,
          prohibitGame: _0x5ebe8b[_0x3363ed(598)],
          partner: _0x5ebe8b.partner,
          manager: _0x5ebe8b[_0x3363ed(409)],
          targetScore: _0x5ebe8b[_0x3363ed(694)],
          floatScore: _0x5ebe8b[_0x3363ed(686)],
          yesterdayDraw: _0x5ebe8b[_0x3363ed(406)],
          yesterdayBigWinDraw: _0x5ebe8b[_0x3363ed(683)],
          yesterdayRebate: _0x5ebe8b.yesterdayRebate,
          todayRebate: _0x5ebe8b[_0x3363ed(464)],
          memberYesterdayDraw: _0x5ebe8b[_0x3363ed(473)],
          memberYesterdayBigWinDraw: _0x5ebe8b[_0x3363ed(391)],
          yesterdayProvideRebate: _0x5ebe8b.yesterdayProvideRebate,
          todayProvideRebate: _0x5ebe8b[_0x3363ed(616)],
          todayWin: _0x5ebe8b[_0x3363ed(592)],
          yesterdayWin: _0x5ebe8b[_0x3363ed(574)],
          totalDraw: _0x5ebe8b[_0x3363ed(568)],
          limitScore: _0x5ebe8b[_0x3363ed(431)],
          rebateRate: _0x5ebe8b.rebateRate,
          fixScoreRate: _0x5ebe8b[_0x3363ed(556)],
          ticketRate: _0x5ebe8b[_0x3363ed(485)]
        });
      }
      _0x3a34fa(null, {
        code: code.OK,
        msg: {
          recordArr: _0x210ed6,
          recordCount: _0x14c130
        }
      });
    } else {
      let _0x3ac1e6 = _0x155166[_0x3363ed(394)];
      if (_0x199b09.partnerPage) {
        let _0x2818ee = await commonDao.findOneData(_0x3363ed(488), {
          uid: _0x155166[_0x3363ed(394)]
        });
        let _0x32f065 = _0x2818ee[_0x3363ed(622)][_0x3363ed(662)](function (_0x4b255c) {
          const _0x417e83 = _0x3363ed;
          return _0x4b255c[_0x417e83(468)] === _0x199b09[_0x417e83(468)];
        });
        _0x32f065 && !_0x32f065[_0x3363ed(409)] && _0xccf1b0[_0x3363ed(487)][_0x3363ed(566)](_0x2818ee);
        let _0x52c656 = await commonDao.findOneData("unionModel", {
          unionID: _0x199b09[_0x3363ed(468)]
        });
        _0x52c656 && _0x52c656[_0x3363ed(558)] != _0x155166[_0x3363ed(394)] && _0x32f065[_0x3363ed(409)] && (_0x2818ee = await commonDao.findOneData(_0x3363ed(488), {
          uid: _0x52c656[_0x3363ed(558)]
        }), _0xccf1b0[_0x3363ed(487)].unshift(_0x2818ee), _0x3ac1e6 = _0x52c656[_0x3363ed(558)]);
      }
      let _0x2289e6 = await userInfoServices[_0x3363ed(668)](_0x199b09[_0x3363ed(468)]);
      for (let _0xd77156 = 0; _0xd77156 < _0xccf1b0.recordArr[_0x3363ed(512)]; ++_0xd77156) {
        let _0x1bf3b1 = _0xccf1b0[_0x3363ed(487)][_0xd77156];
        let _0x552c69 = 0;
        let _0xfd4e1e = 0;
        let _0x4406c7 = 0;
        let _0x3b1afb = _0x1bf3b1[_0x3363ed(622)][_0x3363ed(662)](function (_0x268e89) {
          return _0x268e89.unionID === _0x199b09.unionID;
        });
        for (let _0x49b9ad = 0; _0x49b9ad < _0x1bf3b1[_0x3363ed(622)].length; ++_0x49b9ad) {
          _0x1bf3b1.unionInfo[_0x49b9ad][_0x3363ed(468)] === _0x199b09.unionID && (_0x552c69 = _0x1bf3b1.unionInfo[_0x49b9ad].score, _0xfd4e1e = _0x1bf3b1[_0x3363ed(622)][_0x49b9ad][_0x3363ed(637)], _0x4406c7 = _0x1bf3b1.unionInfo[_0x49b9ad][_0x3363ed(603)] || 0);
        }
        let _0x31e535 = await userInfoServices[_0x3363ed(360)](_0x1bf3b1[_0x3363ed(394)], _0x199b09[_0x3363ed(468)], _0x2289e6);
        let _0x421b68 = moment()[_0x3363ed(557)](_0x3363ed(569));
        let _0x362269 = moment()[_0x3363ed(543)](-1, "d")[_0x3363ed(557)]("YYYYMMDD");
        let _0xb9b13a = await userInfoServices[_0x3363ed(405)](_0x199b09[_0x3363ed(468)], _0x31e535, _0x421b68);
        let _0x23fdc0 = await userInfoServices[_0x3363ed(405)](_0x199b09[_0x3363ed(468)], _0x31e535, _0x362269);
        let _0x4166c9 = _0x31e535[_0x3363ed(629)](_0x39bc9b => _0x39bc9b == _0x1bf3b1[_0x3363ed(394)]);
        let _0x40bd57 = await userInfoServices[_0x3363ed(457)](_0x199b09.unionID, _0x31e535, false);
        let _0x266995 = _0x40bd57[_0x3363ed(589)];
        let _0x2a61c3 = _0x40bd57[_0x3363ed(509)];
        let _0x5b504a = null;
        if (_0x3b1afb.spreaderID) {
          let _0x28fcf0 = await commonDao[_0x3363ed(695)](_0x3363ed(488), {
            uid: _0x3b1afb[_0x3363ed(486)]
          });
          _0x28fcf0 && (_0x5b504a = {
            uid: _0x28fcf0[_0x3363ed(394)],
            nickname: utils[_0x3363ed(508)](_0x28fcf0.nickname),
            avatar: _0x28fcf0[_0x3363ed(484)]
          });
        }
        _0x210ed6[_0x3363ed(687)]({
          todayWin: _0xb9b13a.todayWin,
          todayDraw: _0xb9b13a[_0x3363ed(479)],
          yesterdayDrawTotal: _0x23fdc0[_0x3363ed(479)],
          yesterdayWin: _0x23fdc0[_0x3363ed(592)],
          spreaderInfo: _0x5b504a,
          uid: _0x1bf3b1[_0x3363ed(394)],
          playerCount: _0x266995,
          totalScore: _0x2a61c3,
          nickname: utils.getNickName(_0x1bf3b1[_0x3363ed(692)]),
          lastLoginTime: _0x1bf3b1[_0x3363ed(627)],
          avatar: _0x1bf3b1[_0x3363ed(484)],
          frontendId: _0x1bf3b1[_0x3363ed(514)],
          roomID: _0x1bf3b1[_0x3363ed(444)],
          spreaderID: _0x3b1afb[_0x3363ed(486)],
          score: _0x3b1afb[_0x3363ed(445)],
          saveScore: _0x3b1afb[_0x3363ed(603)] || 0,
          safeScore: _0x3b1afb[_0x3363ed(637)],
          prohibitGame: _0x3b1afb[_0x3363ed(598)],
          yesterdayDraw: _0x3b1afb[_0x3363ed(406)],
          yesterdayBigWinDraw: _0x3b1afb[_0x3363ed(683)],
          yesterdayRebate: _0x3b1afb[_0x3363ed(459)],
          todayRebate: _0x3b1afb[_0x3363ed(464)],
          memberYesterdayDraw: _0x3b1afb[_0x3363ed(473)],
          memberYesterdayBigWinDraw: _0x3b1afb[_0x3363ed(391)],
          yesterdayProvideRebate: _0x3b1afb[_0x3363ed(697)],
          totalDraw: _0x3b1afb.totalDraw,
          limitScore: _0x3b1afb[_0x3363ed(431)],
          rebateRate: _0x3b1afb[_0x3363ed(696)],
          fixScoreRate: _0x3b1afb[_0x3363ed(556)],
          ticketRate: _0x3b1afb[_0x3363ed(485)],
          partner: _0x3b1afb[_0x3363ed(526)],
          targetScore: _0x3b1afb[_0x3363ed(694)],
          floatScore: _0x3b1afb[_0x3363ed(686)]
        });
      }
      _0x3a34fa(null, {
        code: code.OK,
        msg: {
          recordArr: _0x210ed6,
          recordCount: _0x14c130,
          totalCount: _0x14c130
        }
      });
    }
  } catch (_0x155f29) {
    logger[_0x3363ed(595)]("[getMemberList]" + _0x155f29[_0x3363ed(454)]);
    _0x3a34fa(null, {
      code: 500
    });
  }
};
Handler.prototype[a0_0x5d04f4(587)] = async function (_0x284ec1, _0x26bdeb, _0x85d5b4) {
  const _0x39e72 = a0_0x5d04f4;
  try {
    if (!_0x26bdeb.uid) {
      _0x85d5b4(null, {
        code: code.INVALID_UERS
      });
      return;
    }
    if (!_0x284ec1.unionID) {
      _0x85d5b4(null, {
        code: code[_0x39e72(434)]
      });
      return;
    }
    logger[_0x39e72(595)](_0x39e72(493) + JSON[_0x39e72(523)](_0x284ec1) + _0x39e72(403) + _0x26bdeb[_0x39e72(394)]);
    let _0x4a248d = {
      _id: null,
      yesterdayTotalDraw: {
        $sum: _0x39e72(421)
      },
      yesterdayTotalProvideRebate: {
        $sum: _0x39e72(384)
      },
      totalCount: {
        $sum: 1
      }
    };
    let _0x3c119f = [{
      $unwind: _0x39e72(670)
    }, {
      $match: _0x284ec1.matchData
    }, {
      $group: _0x4a248d
    }];
    let _0x1c1e71 = await commonDao[_0x39e72(635)]("userModel", _0x3c119f);
    let _0x3cc214 = 0;
    let _0x16cef1 = 0;
    let _0x40a24b = 0;
    _0x1c1e71.length > 0 && (_0x3cc214 = _0x1c1e71[0].yesterdayTotalDraw || 0, _0x16cef1 = _0x1c1e71[0][_0x39e72(649)] || 0, _0x40a24b = _0x1c1e71[0].totalCount);
    _0x85d5b4(null, {
      code: code.OK,
      msg: {
        yesterdayTotalDraw: _0x3cc214,
        totalCount: _0x40a24b,
        yesterdayTotalProvideRebate: _0x16cef1
      }
    });
  } catch (_0x5d9866) {
    logger[_0x39e72(595)](_0x39e72(392) + _0x5d9866.stack);
    _0x85d5b4(null, {
      code: 500
    });
  }
};
Handler[a0_0x5d04f4(395)][a0_0x5d04f4(620)] = async function (_0xcaaa4, _0x2e4041, _0x801a30) {
  const _0x20d951 = a0_0x5d04f4;
  try {
    if (!_0x2e4041[_0x20d951(394)]) {
      _0x801a30(null, {
        code: code.INVALID_UERS
      });
      return;
    }
    if (!_0xcaaa4[_0x20d951(468)]) {
      _0x801a30(null, {
        code: code.REQUEST_DATA_ERROR
      });
      return;
    }
    let _0x1a6141 = await commonDao[_0x20d951(695)](_0x20d951(555), {
      unionID: _0xcaaa4[_0x20d951(468)]
    });
    if (!_0x1a6141) {
      _0x801a30(null, {
        code: code[_0x20d951(434)]
      });
      return;
    }
    let _0x1a22f4 = await commonDao[_0x20d951(465)](_0x20d951(488), _0xcaaa4.startIndex || 0, _0xcaaa4[_0x20d951(682)] || 20, {
      "unionInfo.joinTime": 1
    }, _0xcaaa4.matchData);
    let _0x2882e9 = await commonDao[_0x20d951(531)](_0x20d951(488), _0xcaaa4[_0x20d951(554)]);
    let _0x1e6fc2 = [];
    for (let _0x5df2f3 = 0; _0x5df2f3 < _0x1a22f4[_0x20d951(487)][_0x20d951(512)]; ++_0x5df2f3) {
      let _0x518666 = _0x1a22f4[_0x20d951(487)][_0x5df2f3];
      let _0x4df0c8 = _0x518666[_0x20d951(622)][_0x20d951(662)](function (_0x21512c) {
        const _0x381e7f = _0x20d951;
        return _0x21512c[_0x381e7f(468)] === _0xcaaa4.unionID;
      });
      _0x1e6fc2[_0x20d951(687)]({
        uid: _0x518666[_0x20d951(394)],
        isRobot: _0x518666[_0x20d951(472)],
        nickname: utils[_0x20d951(508)](_0x518666.nickname),
        avatar: _0x518666[_0x20d951(484)],
        score: _0x4df0c8[_0x20d951(445)],
        safeScore: _0x4df0c8[_0x20d951(637)],
        saveScore: _0x4df0c8.saveScore || 0,
        spreaderID: _0x4df0c8[_0x20d951(486)]
      });
    }
    let _0x1d8723 = await userDao[_0x20d951(489)](_0x2e4041[_0x20d951(394)]);
    if (!_0x1d8723) {
      _0x801a30(null, {
        code: code[_0x20d951(643)]
      });
      return;
    }
    let _0xf276a = _0x1d8723[_0x20d951(622)].find(function (_0x381e65) {
      const _0x4adccb = _0x20d951;
      return _0x381e65[_0x4adccb(468)] === _0xcaaa4[_0x4adccb(468)];
    });
    if (!_0xf276a) {
      _0x801a30(null, {
        code: code.REQUEST_DATA_ERROR
      });
      return;
    }
    let _0x1570d0 = null;
    if (_0x1a6141[_0x20d951(558)] === _0x2e4041.uid || _0xf276a[_0x20d951(409)]) {
      _0x1570d0 = await commonDao[_0x20d951(465)]("userModel", 0, 0, {
        "unionInfo.score": -1
      }, _0xcaaa4[_0x20d951(554)]);
    } else {
      let _0x1a4666 = {
        unionInfo: {
          $elemMatch: {
            unionID: _0xcaaa4[_0x20d951(468)],
            spreaderID: _0x2e4041[_0x20d951(394)]
          }
        }
      };
      _0x1570d0 = await commonDao.findDataAndCount(_0x20d951(488), 0, 0, {
        "unionInfo.score": -1
      }, _0x1a4666);
    }
    let _0x1b8d86 = _0x1570d0.recordArr.length;
    let _0x42a331 = 0;
    for (let _0x48d51d = 0; _0x48d51d < _0x1570d0.recordArr.length; ++_0x48d51d) {
      let _0x107327 = _0x1570d0[_0x20d951(487)][_0x48d51d];
      let _0x3f6d60 = _0x107327[_0x20d951(622)].find(function (_0x20c529) {
        const _0x33426c = _0x20d951;
        return _0x20c529[_0x33426c(468)] === _0xcaaa4[_0x33426c(468)];
      });
      _0x3f6d60 && (_0x42a331 += parseFloat((_0x3f6d60[_0x20d951(445)] + (_0x3f6d60[_0x20d951(603)] || 0) + _0x3f6d60[_0x20d951(637)])[_0x20d951(645)](2)));
    }
    _0x801a30(null, {
      code: code.OK,
      msg: {
        recordArr: _0x1e6fc2,
        recordCount: _0x2882e9,
        totalCount: _0x1b8d86,
        totalScore: _0x42a331
      }
    });
  } catch (_0x222794) {
    logger[_0x20d951(595)](_0x20d951(553) + _0x222794.stack);
    _0x801a30(null, {
      code: 500
    });
  }
};
Handler.prototype.safeBoxOperation = async function (_0x34b8b3, _0x1eec24, _0x2db8d1) {
  const _0x4fb740 = a0_0x5d04f4;
  if (!userListPenging[_0x1eec24.uid]) {
    userListPenging[_0x1eec24.uid] = moment();
  } else {
    if (moment()[_0x4fb740(550)](userListPenging[_0x1eec24[_0x4fb740(394)]], "s") < 3) {
      _0x2db8d1(null, {
        code: code[_0x4fb740(434)]
      });
      return;
    }
    userListPenging[_0x1eec24[_0x4fb740(394)]] = moment();
  }
  logger[_0x4fb740(525)]("[safeBoxOperation] msg = " + getSimData(_0x34b8b3) + " sessionUid = " + _0x1eec24[_0x4fb740(394)]);
  try {
    if (!_0x1eec24.uid) {
      _0x2db8d1(null, {
        code: code[_0x4fb740(456)]
      });
      return;
    }
    if (!_0x34b8b3[_0x4fb740(468)]) {
      _0x2db8d1(null, {
        code: code[_0x4fb740(434)]
      });
      return;
    }
    let _0x32cbbf = await userDao[_0x4fb740(593)](_0x1eec24.uid);
    if (!_0x32cbbf) {
      _0x2db8d1(null, {
        code: code[_0x4fb740(643)]
      });
      return;
    }
    if (!!_0x32cbbf.roomID) {
      await userDao[_0x4fb740(397)](_0x1eec24[_0x4fb740(394)]);
      _0x2db8d1(null, {
        code: code[_0x4fb740(434)]
      });
      return;
    }
    let _0x266d20 = null;
    for (let _0x5e707c = 0; _0x5e707c < _0x32cbbf.unionInfo[_0x4fb740(512)]; ++_0x5e707c) {
      if (_0x32cbbf.unionInfo[_0x5e707c][_0x4fb740(468)] === _0x34b8b3.unionID) {
        _0x266d20 = _0x32cbbf[_0x4fb740(622)][_0x5e707c];
        break;
      }
    }
    if (!_0x266d20) {
      await userDao[_0x4fb740(397)](_0x1eec24[_0x4fb740(394)]);
      _0x2db8d1(null, {
        code: code[_0x4fb740(434)]
      });
      return;
    }
    let _0x226e32 = _0x266d20.safeScore;
    _0x34b8b3.count && (_0x226e32 = parseFloat(_0x34b8b3[_0x4fb740(682)]));
    if (_0x266d20[_0x4fb740(637)] <= 0 || _0x226e32 > _0x266d20[_0x4fb740(637)]) {
      await userDao[_0x4fb740(397)](_0x1eec24[_0x4fb740(394)]);
      _0x2db8d1(null, {
        code: code[_0x4fb740(434)]
      });
      return;
    }
    let _0x37d0cf = {
      $inc: {
        "unionInfo.$.score": _0x226e32,
        "unionInfo.$.safeScore": -_0x226e32
      }
    };
    let _0x53b99d = await userDao[_0x4fb740(404)]({
      uid: _0x1eec24[_0x4fb740(394)],
      "unionInfo.unionID": _0x266d20[_0x4fb740(468)]
    }, _0x37d0cf);
    let _0x67767d = {
      uid: _0x1eec24[_0x4fb740(394)],
      unionID: _0x34b8b3.unionID,
      count: _0x226e32,
      type: 0,
      createTime: Date.now()
    };
    await commonDao.createData(_0x4fb740(679), _0x67767d);
    let _0x18ce30 = _0x53b99d[_0x4fb740(622)].find(function (_0x1b92a3) {
      const _0x4e6fed = _0x4fb740;
      return _0x1b92a3[_0x4e6fed(468)] === _0x34b8b3[_0x4e6fed(468)];
    });
    _0x226e32 = _0x226e32[_0x4fb740(645)](2);
    let _0x5e7e6d = {
      uid: _0x1eec24[_0x4fb740(394)],
      nickname: _0x53b99d[_0x4fb740(692)],
      unionID: _0x34b8b3.unionID,
      changeCount: _0x226e32,
      leftCount: _0x18ce30[_0x4fb740(445)],
      leftSafeBoxCount: _0x18ce30[_0x4fb740(637)],
      leftSaveBoxCount: _0x18ce30.saveScore,
      changeType: enumeration.scoreChangeType[_0x4fb740(410)],
      describe: _0x4fb740(380) + _0x226e32,
      createTime: Date[_0x4fb740(477)]()
    };
    await commonDao.createData(_0x4fb740(564), _0x5e7e6d);
    await commonDao[_0x4fb740(532)]("userScoreDetailModel", _0x5e7e6d)[_0x4fb740(608)](_0x3a76eb => {
      const _0x119382 = _0x4fb740;
      logger[_0x119382(595)](_0x3a76eb[_0x119382(454)]);
    });
    _0x2db8d1(null, {
      code: code.OK,
      updateUserData: {
        unionInfo: _0x53b99d[_0x4fb740(622)]
      }
    });
    logger[_0x4fb740(525)](_0x4fb740(565));
  } catch (_0x1dcd3e) {
    logger[_0x4fb740(595)](_0x4fb740(674) + _0x1dcd3e.stack);
    _0x2db8d1(null, {
      code: 500
    });
  }
};
Handler[a0_0x5d04f4(395)][a0_0x5d04f4(367)] = async function (_0x2ee7b, _0xfeccea, _0x24d0b0) {
  const _0x310abd = a0_0x5d04f4;
  logger[_0x310abd(525)]("[saveBoxOperation] step 1 msg = " + getSimData(_0x2ee7b) + _0x310abd(403) + _0xfeccea.uid);
  if (!userListPenging[_0xfeccea[_0x310abd(394)]]) {
    userListPenging[_0xfeccea[_0x310abd(394)]] = moment();
  } else {
    if (moment()[_0x310abd(550)](userListPenging[_0xfeccea[_0x310abd(394)]], "s") < 3) {
      _0x24d0b0(null, {
        code: code.REQUEST_DATA_ERROR
      });
      return;
    }
    userListPenging[_0xfeccea[_0x310abd(394)]] = moment();
  }
  logger[_0x310abd(525)]("[saveBoxOperation] step 2 msg = " + getSimData(_0x2ee7b) + _0x310abd(403) + _0xfeccea[_0x310abd(394)]);
  try {
    if (!_0xfeccea[_0x310abd(394)]) {
      _0x24d0b0(null, {
        code: code[_0x310abd(456)]
      });
      return;
    }
    if (!_0x2ee7b[_0x310abd(468)] || !_0x2ee7b[_0x310abd(682)] || typeof _0x2ee7b.count !== _0x310abd(588)) {
      _0x24d0b0(null, {
        code: code[_0x310abd(434)]
      });
      return;
    }
    let _0x1cec10 = await userDao.getUnlockUserDataAndLock(_0xfeccea[_0x310abd(394)]);
    if (!_0x1cec10) {
      _0x24d0b0(null, {
        code: code[_0x310abd(643)]
      });
      return;
    }
    if (!!_0x1cec10[_0x310abd(444)]) {
      await userDao[_0x310abd(397)](_0xfeccea[_0x310abd(394)]);
      _0x24d0b0(null, {
        code: code.USER_IN_ROOM_DATA_LOCKED
      });
      return;
    }
    let _0x2026b1 = null;
    for (let _0x3a8b9c = 0; _0x3a8b9c < _0x1cec10[_0x310abd(622)][_0x310abd(512)]; ++_0x3a8b9c) {
      if (_0x1cec10.unionInfo[_0x3a8b9c][_0x310abd(468)] === _0x2ee7b.unionID) {
        _0x2026b1 = _0x1cec10[_0x310abd(622)][_0x3a8b9c];
        break;
      }
    }
    if (!_0x2026b1) {
      await userDao.unlockUserData(_0xfeccea[_0x310abd(394)]);
      _0x24d0b0(null, {
        code: code[_0x310abd(533)]
      });
      return;
    }
    if (_0x2ee7b[_0x310abd(682)] > 0 && _0x2026b1.score < _0x2ee7b[_0x310abd(682)] || _0x2ee7b.count < 0 && _0x2026b1.saveScore + _0x2ee7b[_0x310abd(682)] < 0) {
      await userDao[_0x310abd(397)](_0xfeccea[_0x310abd(394)]);
      _0x24d0b0(null, {
        code: code.USER_IN_ROOM_DATA_LOCKED
      });
      return;
    }
    let _0xcb7aa3 = {
      $inc: {
        "unionInfo.$.score": -_0x2ee7b.count,
        "unionInfo.$.saveScore": _0x2ee7b.count
      }
    };
    let _0x4d206c = await userDao[_0x310abd(404)]({
      uid: _0xfeccea.uid,
      "unionInfo.unionID": _0x2026b1[_0x310abd(468)]
    }, _0xcb7aa3);
    let _0x1f1a0c = {
      uid: _0xfeccea.uid,
      unionID: _0x2ee7b[_0x310abd(468)],
      count: _0x2ee7b[_0x310abd(682)],
      type: 1,
      createTime: Date[_0x310abd(477)]()
    };
    await commonDao[_0x310abd(532)](_0x310abd(679), _0x1f1a0c);
    let _0x46971b = _0x4d206c[_0x310abd(622)][_0x310abd(662)](function (_0x164f98) {
      const _0x5e7221 = _0x310abd;
      return _0x164f98.unionID === _0x2ee7b[_0x5e7221(468)];
    });
    let _0x139671 = {
      uid: _0xfeccea[_0x310abd(394)],
      nickname: _0x4d206c.nickname,
      unionID: _0x2ee7b[_0x310abd(468)],
      changeCount: -_0x2ee7b[_0x310abd(682)],
      leftCount: _0x46971b[_0x310abd(445)],
      leftSafeBoxCount: _0x46971b[_0x310abd(637)] || 0,
      leftSaveBoxCount: _0x46971b[_0x310abd(603)] || 0,
      changeType: enumeration[_0x310abd(437)][_0x310abd(466)],
      describe: _0x2ee7b[_0x310abd(682)] > 0 ? _0x310abd(658) + _0x2ee7b[_0x310abd(682)] : _0x310abd(625) + _0x2ee7b[_0x310abd(682)] * -1,
      createTime: Date[_0x310abd(477)]()
    };
    await commonDao.createData(_0x310abd(564), _0x139671);
    await commonDao[_0x310abd(532)](_0x310abd(490), _0x139671)[_0x310abd(608)](_0x129d39 => {
      const _0x14d95d = _0x310abd;
      logger[_0x14d95d(595)](_0x129d39[_0x14d95d(454)]);
    });
    _0x24d0b0(null, {
      code: code.OK,
      updateUserData: {
        unionInfo: _0x4d206c[_0x310abd(622)]
      }
    });
    logger[_0x310abd(525)]("[saveBoxOperation] operate success");
  } catch (_0x1b2106) {
    logger[_0x310abd(595)](_0x310abd(705) + _0x1b2106[_0x310abd(454)]);
    _0x24d0b0(null, {
      code: 500
    });
  }
};
Handler.prototype.safeBoxOperationRecord = async function (_0x502d35, _0x4ca1cf, _0x83d6bc) {
  const _0x1f63e5 = a0_0x5d04f4;
  logger[_0x1f63e5(525)](_0x1f63e5(506) + getSimData(_0x502d35) + _0x1f63e5(403) + _0x4ca1cf[_0x1f63e5(394)]);
  try {
    if (!_0x4ca1cf[_0x1f63e5(394)]) {
      _0x83d6bc(null, {
        code: code[_0x1f63e5(456)]
      });
      return;
    }
    if (!_0x502d35.unionID) {
      _0x83d6bc(null, {
        code: code.REQUEST_DATA_ERROR
      });
      return;
    }
    let _0x43d611 = {
      uid: _0x4ca1cf[_0x1f63e5(394)],
      unionID: _0x502d35.unionID,
      type: _0x502d35[_0x1f63e5(373)],
      createTime: {
        $gte: Date[_0x1f63e5(477)]() - WEEK_MS
      }
    };
    let _0x2243e8 = await commonDao[_0x1f63e5(465)](_0x1f63e5(679), _0x502d35[_0x1f63e5(684)] || 0, _0x502d35[_0x1f63e5(682)] || 20, {
      createTime: -1
    }, _0x43d611);
    _0x83d6bc(null, {
      code: code.OK,
      msg: _0x2243e8
    });
  } catch (_0x19cb11) {
    logger[_0x1f63e5(595)](_0x1f63e5(663) + _0x19cb11[_0x1f63e5(454)]);
    _0x83d6bc(null, {
      code: 500
    });
  }
};
Handler[a0_0x5d04f4(395)][a0_0x5d04f4(659)] = async function (_0x5b4276, _0x5023a9, _0x35296f) {
  const _0x3cee65 = a0_0x5d04f4;
  logger[_0x3cee65(525)](_0x3cee65(546) + getSimData(_0x5b4276) + " sessionUid = " + _0x5023a9[_0x3cee65(394)]);
  if (!userListPenging[_0x5023a9[_0x3cee65(394)]]) {
    userListPenging[_0x5023a9.uid] = moment();
  } else {
    if (moment()[_0x3cee65(550)](userListPenging[_0x5023a9.uid], "s") < 3) {
      _0x35296f(null, {
        code: code[_0x3cee65(643)]
      });
      return;
    }
    userListPenging[_0x5023a9[_0x3cee65(394)]] = moment();
  }
  logger[_0x3cee65(525)](_0x3cee65(654) + getSimData(_0x5b4276) + " sessionUid = " + _0x5023a9[_0x3cee65(394)]);
  try {
    if (!_0x5023a9.uid) {
      _0x35296f(null, {
        code: code.INVALID_UERS
      });
      return;
    }
    let _0xbb632f = await commonDao[_0x3cee65(695)]("unionModel", {
      unionID: _0x5b4276[_0x3cee65(468)]
    });
    if (_0xbb632f && _0x5023a9.uid == _0x5b4276.memberUid && _0x5b4276[_0x3cee65(613)] == _0xbb632f[_0x3cee65(558)]) {
      let _0x24d845 = await userDao.getUnlockUserDataAndLock(_0x5023a9[_0x3cee65(394)]);
      let _0x373bda = await userDao[_0x3cee65(404)]({
        uid: _0x5b4276[_0x3cee65(613)],
        "unionInfo.unionID": _0x5b4276[_0x3cee65(468)]
      }, {
        $inc: {
          "unionInfo.$.score": _0x5b4276[_0x3cee65(682)]
        }
      });
      let _0x51fc90 = {
        uid: _0x5023a9.uid,
        nickname: _0x24d845[_0x3cee65(692)],
        avatar: _0x24d845[_0x3cee65(484)],
        gainUid: _0x5b4276[_0x3cee65(613)],
        gainNickname: _0x24d845[_0x3cee65(692)],
        gainAvatar: _0x24d845.avatar,
        unionID: _0x5b4276[_0x3cee65(468)],
        count: _0x5b4276[_0x3cee65(682)],
        createTime: Date[_0x3cee65(477)]()
      };
      commonDao[_0x3cee65(532)](_0x3cee65(513), _0x51fc90)[_0x3cee65(608)](_0x35add6 => {
        const _0x35fe06 = _0x3cee65;
        logger[_0x35fe06(595)](_0x35add6[_0x35fe06(454)]);
      });
      if (!!_0x373bda[_0x3cee65(514)]) {
        userInfoServices[_0x3cee65(652)](_0x373bda[_0x3cee65(394)], _0x373bda.frontendId, {
          unionInfo: _0x373bda.unionInfo
        })[_0x3cee65(608)](_0x2eb5d8 => {
          const _0x3dd761 = _0x3cee65;
          logger[_0x3dd761(595)](_0x2eb5d8.stack);
        });
      }
      let _0x1834bd = [];
      let _0x40c1c2 = _0x373bda[_0x3cee65(622)][_0x3cee65(662)](function (_0x2b103e) {
        const _0x488ca1 = _0x3cee65;
        return _0x2b103e[_0x488ca1(468)] === _0x5b4276[_0x488ca1(468)];
      });
      _0x1834bd.push({
        uid: _0x373bda.uid,
        nickname: _0x373bda[_0x3cee65(692)],
        unionID: _0x5b4276[_0x3cee65(468)],
        changeCount: _0x5b4276.count,
        leftCount: _0x40c1c2[_0x3cee65(445)],
        leftSafeBoxCount: _0x40c1c2[_0x3cee65(637)],
        changeType: enumeration[_0x3cee65(437)].MODIFY_UP,
        describe: _0x5b4276[_0x3cee65(682)] > 0 ? _0x3cee65(691) + _0x24d845[_0x3cee65(394)] + "加分" + _0x5b4276[_0x3cee65(682)] : "盟主自己" + _0x24d845[_0x3cee65(394)] + "减分" + _0x5b4276[_0x3cee65(682)] * -1,
        createTime: Date[_0x3cee65(477)]()
      });
      await commonDao[_0x3cee65(600)](_0x3cee65(564), _0x1834bd);
      await commonDao[_0x3cee65(600)](_0x3cee65(490), _0x1834bd).catch(_0x340762 => {
        const _0xe6b792 = _0x3cee65;
        logger[_0xe6b792(595)](_0x340762[_0xe6b792(454)]);
      });
      _0x35296f(null, {
        code: code.OK,
        updateUserData: {
          unionInfo: _0x373bda[_0x3cee65(622)]
        }
      });
      logger[_0x3cee65(525)](_0x3cee65(448));
    } else {
      if (!_0x5b4276[_0x3cee65(468)] || !_0x5b4276[_0x3cee65(682)] || typeof _0x5b4276[_0x3cee65(682)] !== _0x3cee65(588) || !_0x5b4276[_0x3cee65(613)] || _0x5023a9[_0x3cee65(394)] === _0x5b4276[_0x3cee65(613)]) {
        _0x35296f(null, {
          code: code[_0x3cee65(434)]
        });
        return;
      }
      if (!_0xbb632f) {
        _0x35296f(null, {
          code: code[_0x3cee65(434)]
        });
        return;
      }
      if (!!_0xbb632f.forbidGive && _0x5023a9.uid !== _0xbb632f[_0x3cee65(558)]) {
        _0x35296f(null, {
          code: code[_0x3cee65(518)]
        });
        return;
      }
      let _0x53d271 = await userDao[_0x3cee65(593)](_0x5023a9.uid);
      if (!_0x53d271) {
        _0x35296f(null, {
          code: code.REQUEST_DATA_ERROR
        });
        return;
      }
      if (!!_0x53d271[_0x3cee65(444)]) {
        await userDao[_0x3cee65(397)](_0x5023a9[_0x3cee65(394)]);
        _0x35296f(null, {
          code: code[_0x3cee65(533)]
        });
        return;
      }
      let _0x1796d7 = null;
      for (let _0x1d7dc8 = 0; _0x1d7dc8 < _0x53d271[_0x3cee65(622)].length; ++_0x1d7dc8) {
        if (_0x53d271[_0x3cee65(622)][_0x1d7dc8][_0x3cee65(468)] === _0x5b4276.unionID) {
          _0x1796d7 = _0x53d271[_0x3cee65(622)][_0x1d7dc8];
          break;
        }
      }
      if (!_0x1796d7 || _0x1796d7.score < _0x5b4276.count) {
        await userDao[_0x3cee65(397)](_0x5023a9[_0x3cee65(394)]);
        _0x35296f(null, {
          code: code.NOT_ENOUGH_SCORE
        });
        return;
      }
      if (_0x1796d7[_0x3cee65(409)] && _0x5b4276[_0x3cee65(682)] < 0 && _0x5b4276[_0x3cee65(613)] == _0xbb632f[_0x3cee65(558)]) {
        await userDao[_0x3cee65(397)](_0x5023a9[_0x3cee65(394)]);
        _0x35296f(null, {
          code: code[_0x3cee65(610)]
        });
        return;
      }
      let _0x3cd358 = await userDao.getUnlockUserDataAndLock(_0x5b4276.memberUid);
      if (!_0x3cd358) {
        await userDao[_0x3cee65(397)](_0x5023a9[_0x3cee65(394)]);
        await userDao.unlockUserData(_0x5b4276[_0x3cee65(613)]);
        _0x35296f(null, {
          code: code[_0x3cee65(533)]
        });
        return;
      }
      if (!!_0x3cd358[_0x3cee65(444)] && _0x5b4276[_0x3cee65(682)] < 0) {
        await userDao[_0x3cee65(397)](_0x5b4276.memberUid);
        await userDao[_0x3cee65(397)](_0x5023a9[_0x3cee65(394)]);
        _0x35296f(null, {
          code: code[_0x3cee65(533)]
        });
        return;
      }
      let _0x4b704c = null;
      for (let _0x1b4275 = 0; _0x1b4275 < _0x3cd358.unionInfo[_0x3cee65(512)]; ++_0x1b4275) {
        if (_0x3cd358[_0x3cee65(622)][_0x1b4275].unionID === _0x5b4276.unionID) {
          _0x4b704c = _0x3cd358[_0x3cee65(622)][_0x1b4275];
          break;
        }
      }
      if (!_0x4b704c || _0x5b4276[_0x3cee65(682)] < 0 && _0x4b704c[_0x3cee65(445)] + _0x5b4276.count < 0) {
        await userDao.unlockUserData(_0x5023a9[_0x3cee65(394)]);
        await userDao[_0x3cee65(397)](_0x5b4276[_0x3cee65(613)]);
        _0x35296f(null, {
          code: code[_0x3cee65(390)]
        });
        return;
      }
      logger[_0x3cee65(525)](_0x3cee65(636) + _0x5023a9[_0x3cee65(394)] + " ownerUid = " + _0xbb632f[_0x3cee65(558)] + " isPartner = " + _0x1796d7.partner + _0x3cee65(497) + _0x1796d7[_0x3cee65(409)] + _0x3cee65(453) + _0x4b704c[_0x3cee65(486)]);
      if (!_0x1796d7[_0x3cee65(409)] && !_0x1796d7[_0x3cee65(526)]) {
        await userDao[_0x3cee65(397)](_0x5023a9[_0x3cee65(394)]);
        await userDao[_0x3cee65(397)](_0x5b4276[_0x3cee65(613)]);
        _0x35296f(null, {
          code: code[_0x3cee65(610)]
        });
        return;
      }
      if (_0x4b704c.spreaderID == _0x5023a9[_0x3cee65(394)] || _0x5023a9[_0x3cee65(394)] == _0xbb632f.ownerUid || _0x1796d7[_0x3cee65(409)]) {
        if (_0x4b704c[_0x3cee65(445)] <= 1 && _0x5b4276[_0x3cee65(682)] > 0) {
          let _0x483b08 = await userDao.updateUserData({
            uid: _0x5b4276[_0x3cee65(613)],
            "unionInfo.unionID": _0x5b4276[_0x3cee65(468)]
          }, {
            "unionInfo.$.targetScore": _0x5b4276[_0x3cee65(682)],
            "unionInfo.$.floatScore": _0x5b4276[_0x3cee65(682)] / 2
          });
        }
        let _0x1f9ed9 = await userDao[_0x3cee65(404)]({
          uid: _0x5023a9[_0x3cee65(394)],
          "unionInfo.unionID": _0x5b4276[_0x3cee65(468)]
        }, {
          $inc: {
            "unionInfo.$.score": -_0x5b4276[_0x3cee65(682)]
          }
        });
        let _0x11a903 = await userDao[_0x3cee65(404)]({
          uid: _0x5b4276.memberUid,
          "unionInfo.unionID": _0x5b4276[_0x3cee65(468)]
        }, {
          $inc: {
            "unionInfo.$.score": _0x5b4276.count
          }
        });
        let _0xe64c6c = {
          uid: _0x5023a9[_0x3cee65(394)],
          nickname: _0x53d271[_0x3cee65(692)],
          avatar: _0x53d271[_0x3cee65(484)],
          gainUid: _0x5b4276.memberUid,
          gainNickname: _0x3cd358[_0x3cee65(692)],
          gainAvatar: _0x3cd358[_0x3cee65(484)],
          unionID: _0x5b4276[_0x3cee65(468)],
          count: _0x5b4276.count,
          createTime: Date.now()
        };
        commonDao[_0x3cee65(532)](_0x3cee65(513), _0xe64c6c)[_0x3cee65(608)](_0x1d7930 => {
          const _0x476222 = _0x3cee65;
          logger[_0x476222(595)](_0x1d7930[_0x476222(454)]);
        });
        if (!!_0x11a903[_0x3cee65(514)]) {
          userInfoServices[_0x3cee65(652)](_0x11a903[_0x3cee65(394)], _0x11a903[_0x3cee65(514)], {
            unionInfo: _0x11a903[_0x3cee65(622)]
          })[_0x3cee65(608)](_0xb35f0a => {
            const _0x7d32ef = _0x3cee65;
            logger[_0x7d32ef(595)](_0xb35f0a[_0x7d32ef(454)]);
          });
        }
        let _0x3429cf = _0x1f9ed9[_0x3cee65(622)].find(function (_0x2c2d85) {
          const _0x380b91 = _0x3cee65;
          return _0x2c2d85[_0x380b91(468)] === _0x5b4276.unionID;
        });
        let _0x6ec789 = [];
        _0x6ec789[_0x3cee65(687)]({
          uid: _0x1f9ed9[_0x3cee65(394)],
          nickname: _0x1f9ed9.nickname,
          unionID: _0x5b4276[_0x3cee65(468)],
          changeCount: -_0x5b4276[_0x3cee65(682)],
          leftCount: _0x3429cf[_0x3cee65(445)],
          leftSafeBoxCount: _0x3429cf.safeScore,
          leftSaveBoxCount: _0x3429cf[_0x3cee65(603)],
          changeType: enumeration[_0x3cee65(437)][_0x3cee65(615)],
          describe: _0x5b4276.count > 0 ? "给下级" + _0x11a903[_0x3cee65(394)] + "加分" + _0x5b4276.count : _0x3cee65(551) + _0x11a903[_0x3cee65(394)] + "减分" + _0x5b4276.count * -1,
          createTime: Date[_0x3cee65(477)]()
        });
        let _0x31a1da = _0x11a903[_0x3cee65(622)][_0x3cee65(662)](function (_0x4a48f0) {
          const _0x29680b = _0x3cee65;
          return _0x4a48f0[_0x29680b(468)] === _0x5b4276[_0x29680b(468)];
        });
        _0x6ec789[_0x3cee65(687)]({
          uid: _0x11a903.uid,
          nickname: _0x11a903.nickname,
          unionID: _0x5b4276[_0x3cee65(468)],
          changeCount: _0x5b4276.count,
          leftCount: _0x31a1da.score,
          leftSafeBoxCount: _0x31a1da[_0x3cee65(637)],
          leftSaveBoxCount: _0x31a1da[_0x3cee65(603)],
          changeType: enumeration[_0x3cee65(437)][_0x3cee65(423)],
          describe: _0x5b4276[_0x3cee65(682)] > 0 ? "上级" + _0x1f9ed9[_0x3cee65(394)] + "加分" + _0x5b4276.count : "上级" + _0x1f9ed9[_0x3cee65(394)] + "减分" + _0x5b4276[_0x3cee65(682)] * -1,
          createTime: Date[_0x3cee65(477)]()
        });
        await commonDao[_0x3cee65(600)](_0x3cee65(564), _0x6ec789);
        await commonDao[_0x3cee65(600)](_0x3cee65(490), _0x6ec789)[_0x3cee65(608)](_0x361829 => {
          const _0x1c6485 = _0x3cee65;
          logger[_0x1c6485(595)](_0x361829[_0x1c6485(454)]);
        });
        _0x35296f(null, {
          code: code.OK,
          updateUserData: {
            unionInfo: _0x1f9ed9.unionInfo
          }
        });
        logger[_0x3cee65(525)]("[modifyScore] operate success");
      } else {
        await userDao[_0x3cee65(397)](_0x5b4276.memberUid);
        await userDao[_0x3cee65(397)](_0x5023a9.uid);
        _0x35296f(null, {
          code: code.UNION_ADD_SCORE_LIMIT
        });
        return;
      }
    }
  } catch (_0x4dd5fe) {
    logger.error(_0x3cee65(396) + _0x4dd5fe[_0x3cee65(454)]);
    _0x35296f(null, {
      code: 500
    });
  }
};
Handler[a0_0x5d04f4(395)].addPartner = async function (_0x4ef3d5, _0x5a145a, _0x1471ff) {
  const _0x402193 = a0_0x5d04f4;
  logger[_0x402193(525)](_0x402193(471) + getSimData(_0x4ef3d5) + _0x402193(403) + _0x5a145a[_0x402193(394)]);
  try {
    if (!_0x5a145a[_0x402193(394)]) {
      _0x1471ff(null, {
        code: code[_0x402193(456)]
      });
      return;
    }
    if (!_0x4ef3d5[_0x402193(468)] || !_0x4ef3d5[_0x402193(613)]) {
      _0x1471ff(null, {
        code: code[_0x402193(456)]
      });
      return;
    }
    let _0x5be3b4 = await commonDao[_0x402193(695)](_0x402193(555), {
      unionID: _0x4ef3d5.unionID
    });
    if (!_0x5be3b4) {
      _0x1471ff(null, {
        code: code[_0x402193(456)]
      });
      return;
    }
    if (!!_0x5be3b4[_0x402193(630)]) {
      _0x1471ff(null, {
        code: code[_0x402193(527)]
      });
      return;
    }
    let _0x539eca = await userDao[_0x402193(489)](_0x5a145a.uid);
    if (!_0x539eca) {
      _0x1471ff(null, {
        code: code[_0x402193(434)]
      });
      return;
    }
    let _0x55186a = _0x539eca[_0x402193(622)].find(function (_0x51025e) {
      const _0xed7bb4 = _0x402193;
      return _0x51025e[_0xed7bb4(468)] === _0x4ef3d5.unionID;
    });
    if (!_0x55186a) {
      _0x1471ff(null, {
        code: code[_0x402193(610)]
      });
      return;
    }
    logger[_0x402193(525)](_0x402193(375) + _0x5be3b4[_0x402193(558)] + _0x402193(497) + _0x55186a[_0x402193(409)] + _0x402193(403) + _0x5a145a[_0x402193(394)]);
    let _0x2a3ca0 = await userDao[_0x402193(489)](_0x4ef3d5.memberUid);
    if (!_0x2a3ca0) {
      _0x1471ff(null, {
        code: code.INVALID_UERS
      });
      return;
    }
    let _0x4f3c75 = _0x2a3ca0.unionInfo[_0x402193(662)](function (_0x17463c) {
      const _0xa51294 = _0x402193;
      return _0x17463c.unionID === _0x4ef3d5[_0xa51294(468)];
    });
    if (!!_0x4f3c75) {
      if (_0x4f3c75[_0x402193(526)]) {
        _0x1471ff(null, {
          code: code.OK
        });
        return;
      }
      let _0x2b9ba2 = await userDao[_0x402193(660)]({
        uid: _0x4ef3d5[_0x402193(613)],
        "unionInfo.unionID": _0x4ef3d5.unionID
      }, {
        "unionInfo.$.partner": true
      });
      if (!!_0x2b9ba2[_0x402193(514)]) {
        userInfoServices[_0x402193(652)](_0x2b9ba2.uid, _0x2b9ba2[_0x402193(514)], {
          unionInfo: _0x2b9ba2.unionInfo
        })[_0x402193(608)](_0x5ebcc2 => {
          logger.error(_0x5ebcc2.stack);
        });
      }
      _0x1471ff(null, {
        code: code.OK
      });
      logger[_0x402193(525)](_0x402193(480));
      return;
    } else {
      await commonDao[_0x402193(505)](_0x402193(555), {
        unionID: _0x4ef3d5[_0x402193(468)]
      }, {
        $inc: {
          curMember: 1
        }
      });
      let _0x42670e = _0x2a3ca0.uid;
      let _0x3736e0 = _0x2a3ca0.avatar;
      let _0x11c2fe = _0x2a3ca0[_0x402193(692)];
      let _0x3b6714 = _0x539eca.uid;
      let _0xb9d320 = _0x539eca[_0x402193(484)];
      let _0x25abab = _0x539eca[_0x402193(692)];
      await commonDao[_0x402193(532)]("userDelModel", {
        type: 0,
        doneUid: _0x42670e,
        doneAvatar: _0x3736e0,
        doneNickname: _0x11c2fe,
        uid: _0x3b6714,
        avatar: _0xb9d320,
        nickname: _0x25abab,
        score: 0,
        unionID: _0x4ef3d5[_0x402193(468)],
        createTime: Date[_0x402193(477)]()
      });
      let _0x2f8ada = {
        unionID: _0x4ef3d5[_0x402193(468)],
        spreaderID: _0x5a145a.uid,
        partner: true,
        joinTime: Date[_0x402193(477)]()
      };
      let _0x2b963d = await commonDao[_0x402193(690)](_0x402193(642), {
        key: 1
      }, {
        $inc: {
          unionInviteID: 7
        }
      }, {
        new: true,
        upsert: true
      });
      _0x2f8ada[_0x402193(547)] = _0x2b963d[_0x402193(631)];
      let _0x3b80ff = await userDao[_0x402193(618)](_0x4ef3d5[_0x402193(613)], {
        $push: {
          unionInfo: _0x2f8ada
        }
      });
      if (!!_0x3b80ff[_0x402193(514)]) {
        userInfoServices[_0x402193(652)](_0x3b80ff.uid, _0x3b80ff[_0x402193(514)], {
          unionInfo: _0x3b80ff[_0x402193(622)]
        })[_0x402193(608)](_0x5abaff => {
          const _0x130df8 = _0x402193;
          logger.error(_0x5abaff[_0x130df8(454)]);
        });
      }
      _0x1471ff(null, {
        code: code.OK
      });
      logger.info(_0x402193(501));
    }
  } catch (_0x3a47b4) {
    logger[_0x402193(595)](_0x402193(467) + _0x3a47b4.stack);
    _0x1471ff(null, {
      code: 500
    });
  }
};
Handler[a0_0x5d04f4(395)][a0_0x5d04f4(538)] = async function (_0x1e8503, _0x2d1af7, _0x4eaba5) {
  const _0x41aad6 = a0_0x5d04f4;
  logger[_0x41aad6(525)](_0x41aad6(572) + getSimData(_0x1e8503) + _0x41aad6(403) + _0x2d1af7[_0x41aad6(394)]);
  try {
    if (!_0x2d1af7[_0x41aad6(394)]) {
      _0x4eaba5(null, {
        code: code[_0x41aad6(456)]
      });
      return;
    }
    if (!_0x1e8503[_0x41aad6(468)] || !_0x1e8503[_0x41aad6(613)]) {
      _0x4eaba5(null, {
        code: code[_0x41aad6(434)]
      });
      return;
    }
    if (_0x2d1af7[_0x41aad6(394)] == _0x1e8503.memberUid) {
      _0x4eaba5(null, {
        code: code.PERMISSION_NOT_ENOUGH
      });
      return;
    }
    let _0x47aeac = await commonDao[_0x41aad6(695)](_0x41aad6(555), {
      unionID: _0x1e8503.unionID
    });
    if (!_0x47aeac) {
      _0x4eaba5(null, {
        code: code[_0x41aad6(434)]
      });
      return;
    }
    let _0x3bf722 = await userDao.getUserDataByUid(_0x2d1af7.uid);
    if (!_0x3bf722) {
      _0x4eaba5(null, {
        code: code.REQUEST_DATA_ERROR
      });
      return;
    }
    let _0x14d977 = _0x3bf722[_0x41aad6(622)][_0x41aad6(662)](function (_0x4f16d6) {
      const _0x39d253 = _0x41aad6;
      return _0x4f16d6.unionID === _0x1e8503[_0x39d253(468)];
    });
    if (!_0x14d977) {
      _0x4eaba5(null, {
        code: code[_0x41aad6(434)]
      });
      return;
    }
    let _0x4472ea = await userDao[_0x41aad6(489)](_0x1e8503[_0x41aad6(613)]);
    if (!_0x4472ea) {
      _0x4eaba5(null, {
        code: code[_0x41aad6(602)]
      });
      return;
    }
    let _0x245432 = _0x4472ea.unionInfo[_0x41aad6(662)](function (_0x1410ee) {
      const _0x455c69 = _0x41aad6;
      return _0x1410ee[_0x455c69(468)] === _0x1e8503[_0x455c69(468)];
    });
    if (_0x47aeac[_0x41aad6(558)] !== _0x2d1af7[_0x41aad6(394)]) {
      _0x4eaba5(null, {
        code: code[_0x41aad6(610)]
      });
      return;
    }
    logger[_0x41aad6(525)]("[addManager] ownerUid = " + _0x47aeac.ownerUid + _0x41aad6(403) + _0x2d1af7[_0x41aad6(394)]);
    let _0x1bcc1f = _0x1e8503[_0x41aad6(596)] || false;
    if (!_0x1bcc1f && _0x245432[_0x41aad6(409)]) {
      _0x4eaba5(null, {
        code: code.OK
      });
      return;
    }
    if (_0x1bcc1f && !_0x245432[_0x41aad6(409)]) {
      _0x4eaba5(null, {
        code: code.OK
      });
      return;
    }
    let _0x982304 = _0x1bcc1f ? false : true;
    let _0x3606c1 = await userDao[_0x41aad6(660)]({
      uid: _0x1e8503.memberUid,
      "unionInfo.unionID": _0x1e8503.unionID
    }, {
      "unionInfo.$.manager": _0x982304
    });
    if (!!_0x3606c1[_0x41aad6(514)]) {
      userInfoServices[_0x41aad6(652)](_0x3606c1[_0x41aad6(394)], _0x3606c1.frontendId, {
        unionInfo: _0x3606c1[_0x41aad6(622)]
      })[_0x41aad6(608)](_0x3fa08f => {
        const _0x3b1dea = _0x41aad6;
        logger[_0x3b1dea(595)](_0x3fa08f.stack);
      });
    }
    _0x4eaba5(null, {
      code: code.OK
    });
    logger.info(_0x41aad6(482));
  } catch (_0x40973a) {
    logger[_0x41aad6(595)]("[addManager]" + _0x40973a[_0x41aad6(454)]);
    _0x4eaba5(null, {
      code: 500
    });
  }
};
Handler[a0_0x5d04f4(395)][a0_0x5d04f4(536)] = async function (_0xcbdff2, _0x5b9621, _0x49a3cb) {
  const _0x4ca10c = a0_0x5d04f4;
  try {
    if (!_0x5b9621[_0x4ca10c(394)]) {
      _0x49a3cb(null, {
        code: code.INVALID_UERS
      });
      return;
    }
    if (!_0xcbdff2[_0x4ca10c(468)] || !_0xcbdff2.matchData) {
      _0x49a3cb(null, {
        code: code[_0x4ca10c(434)]
      });
      return;
    }
    let _0x3cb0f9 = await commonDao[_0x4ca10c(465)]("scoreModifyRecordModel", _0xcbdff2[_0x4ca10c(684)], _0xcbdff2[_0x4ca10c(682)], {
      createTime: -1
    }, _0xcbdff2[_0x4ca10c(554)]);
    let _0x453692 = 0;
    {
      let _0x57fcc7 = {
        _id: null,
        totalCount: {
          $sum: "$count"
        }
      };
      let _0x2d7800 = [{
        $match: _0xcbdff2[_0x4ca10c(554)]
      }, {
        $group: _0x57fcc7
      }];
      let _0x3cf4d5 = await commonDao[_0x4ca10c(635)](_0x4ca10c(513), _0x2d7800);
      _0x3cf4d5[_0x4ca10c(512)] > 0 && (_0x453692 = _0x3cf4d5[0][_0x4ca10c(589)]);
    }
    _0x49a3cb(null, {
      code: code.OK,
      msg: {
        recordArr: _0x3cb0f9.recordArr,
        totalCount: _0x3cb0f9[_0x4ca10c(589)],
        totalScoreCount: _0x453692
      }
    });
  } catch (_0x52ac4c) {
    logger[_0x4ca10c(595)](_0x4ca10c(419) + _0x52ac4c[_0x4ca10c(454)]);
    _0x49a3cb(null, {
      code: 500
    });
  }
};
Handler.prototype[a0_0x5d04f4(703)] = async function (_0x421c47, _0x5c279a, _0x5d1d3d) {
  const _0x53b178 = a0_0x5d04f4;
  logger[_0x53b178(525)]("[inviteJoinUnion] msg = " + getSimData(_0x421c47) + _0x53b178(403) + _0x5c279a[_0x53b178(394)]);
  try {
    if (!_0x5c279a[_0x53b178(394)]) {
      _0x5d1d3d(null, {
        code: code[_0x53b178(456)]
      });
      return;
    }
    if (!_0x421c47[_0x53b178(468)] || !_0x421c47.uid) {
      _0x5d1d3d(null, {
        code: code[_0x53b178(456)]
      });
      return;
    }
    let _0x4004d7 = await commonDao[_0x53b178(695)](_0x53b178(555), {
      unionID: _0x421c47[_0x53b178(468)]
    });
    if (!_0x4004d7) {
      _0x5d1d3d(null, {
        code: code[_0x53b178(456)]
      });
      return;
    }
    if (!!_0x4004d7.forbidInvite) {
      _0x5d1d3d(null, {
        code: code[_0x53b178(527)]
      });
      return;
    }
    let _0x3872cd = await userDao[_0x53b178(489)](_0x5c279a[_0x53b178(394)]);
    if (!_0x3872cd) {
      _0x5d1d3d(null, {
        code: code[_0x53b178(434)]
      });
      return;
    }
    let _0x13de6c = _0x3872cd.unionInfo[_0x53b178(662)](function (_0x2ced08) {
      const _0x46dbbd = _0x53b178;
      return _0x2ced08[_0x46dbbd(468)] === _0x421c47[_0x46dbbd(468)];
    });
    if (!_0x13de6c) {
      _0x5d1d3d(null, {
        code: code[_0x53b178(434)]
      });
      return;
    }
    let _0x283e9e = await userDao[_0x53b178(489)](_0x421c47[_0x53b178(394)]);
    if (!_0x283e9e) {
      _0x5d1d3d(null, {
        code: code.INVALID_UERS
      });
      return;
    }
    let _0x1bc75f = _0x283e9e.unionInfo[_0x53b178(662)](function (_0x468dea) {
      const _0xcd391d = _0x53b178;
      return _0x468dea[_0xcd391d(468)] === _0x421c47[_0xcd391d(468)];
    });
    if (!!_0x1bc75f) {
      _0x5d1d3d(null, {
        code: code[_0x53b178(398)]
      });
      return;
    }
    logger[_0x53b178(525)](_0x53b178(611) + _0x4004d7[_0x53b178(558)] + _0x53b178(399) + _0x13de6c.partner + _0x53b178(497) + _0x13de6c[_0x53b178(409)] + _0x53b178(561) + _0x5c279a[_0x53b178(394)]);
    if (_0x5c279a.uid !== _0x4004d7[_0x53b178(558)] && !_0x13de6c[_0x53b178(526)] && !_0x13de6c[_0x53b178(409)]) {
      _0x5d1d3d(null, {
        code: code.PERMISSION_NOT_ENOUGH
      });
      return;
    }
    await await commonDao[_0x53b178(505)]("unionModel", {
      unionID: _0x421c47.unionID
    }, {
      $inc: {
        curMember: 1
      }
    });
    let _0x55946a = _0x283e9e[_0x53b178(394)];
    let _0xbf83e8 = _0x283e9e.avatar;
    let _0x14efd8 = _0x283e9e[_0x53b178(692)];
    let _0x5c904e = _0x3872cd[_0x53b178(394)];
    let _0x2d06a2 = _0x3872cd[_0x53b178(484)];
    let _0xeb744 = _0x3872cd[_0x53b178(692)];
    await commonDao[_0x53b178(532)]("userDelModel", {
      type: 0,
      doneUid: _0x55946a,
      doneAvatar: _0xbf83e8,
      doneNickname: _0x14efd8,
      uid: _0x5c904e,
      avatar: _0x2d06a2,
      nickname: _0xeb744,
      score: 0,
      unionID: _0x421c47[_0x53b178(468)],
      createTime: Date[_0x53b178(477)]()
    });
    let _0x3e3edc = {
      unionID: _0x421c47[_0x53b178(468)],
      spreaderID: _0x5c279a.uid,
      partner: false,
      joinTime: Date.now(),
      inviteID: _0x202b57[_0x53b178(631)]
    };
    let _0x202b57 = await commonDao[_0x53b178(690)](_0x53b178(642), {
      key: 1
    }, {
      $inc: {
        unionInviteID: 7
      }
    }, {
      new: true,
      upsert: true
    });
    let _0x2c77db = await userDao.updateUserDataByUid(_0x421c47.uid, {
      $push: {
        unionInfo: _0x3e3edc
      }
    });
    if (!!_0x2c77db[_0x53b178(514)]) {
      userInfoServices[_0x53b178(652)](_0x2c77db[_0x53b178(394)], _0x2c77db.frontendId, {
        unionInfo: _0x2c77db.unionInfo
      })[_0x53b178(608)](_0x1cf737 => {
        const _0x3cdf76 = _0x53b178;
        logger.error(_0x1cf737[_0x3cdf76(454)]);
      });
    }
    _0x5d1d3d(null, {
      code: code.OK
    });
    logger.info(_0x53b178(393));
  } catch (_0x367de0) {
    logger[_0x53b178(595)](_0x53b178(496) + _0x367de0[_0x53b178(454)]);
    _0x5d1d3d(null, {
      code: 500
    });
  }
};
Handler[a0_0x5d04f4(395)].operationInviteJoinUnion = async function (_0x3a812b, _0x2940d, _0x460a2f) {
  const _0x364e41 = a0_0x5d04f4;
  logger[_0x364e41(525)]("[operationInviteJoinUnion] msg = " + getSimData(_0x3a812b) + _0x364e41(403) + _0x2940d[_0x364e41(394)]);
  try {
    if (!_0x2940d.uid) {
      _0x460a2f(null, {
        code: code[_0x364e41(456)]
      });
      return;
    }
    if (!_0x3a812b[_0x364e41(394)] || !_0x3a812b.unionID) {
      _0x460a2f(null, {
        code: code[_0x364e41(434)]
      });
      return;
    }
    let _0x3f50e0 = await userDao.getUserDataByUid(_0x2940d[_0x364e41(394)]);
    let _0x5a91f8 = _0x3f50e0.inviteMsg[_0x364e41(662)](function (_0x306c4a) {
      const _0x4c72f9 = _0x364e41;
      return _0x306c4a[_0x4c72f9(468)] === _0x3a812b.unionID && _0x306c4a.uid === _0x3a812b[_0x4c72f9(394)];
    });
    if (!_0x5a91f8) {
      _0x460a2f(null, {
        code: code[_0x364e41(434)]
      });
      return;
    }
    async function _0x1d4964(_0x40f91a) {
      const _0x328b38 = _0x364e41;
      return await userDao.updateUserDataByUid(_0x2940d[_0x328b38(394)], _0x40f91a);
    }
    if (!_0x3a812b[_0x364e41(369)]) {
      let _0x4e94f3 = await _0x1d4964({
        $pull: {
          inviteMsg: {
            unionID: _0x3a812b[_0x364e41(468)],
            uid: _0x3a812b.uid
          }
        }
      });
      _0x460a2f(null, {
        code: code.OK,
        updateUserData: {
          inviteMsg: _0x4e94f3[_0x364e41(368)]
        }
      });
      return;
    }
    if (_0x3f50e0.unionInfo[_0x364e41(512)] >= 20) {
      _0x460a2f(null, {
        code: code.REQUEST_DATA_ERROR
      });
      return;
    }
    let _0x219ee2 = await commonDao[_0x364e41(695)]("unionModel", {
      unionID: _0x3a812b.unionID
    });
    if (!_0x219ee2) {
      let _0x567e0d = await _0x1d4964({
        $pull: {
          inviteMsg: {
            unionID: _0x3a812b[_0x364e41(468)]
          }
        }
      });
      _0x460a2f(null, {
        code: code[_0x364e41(434)],
        updateUserData: {
          inviteMsg: _0x567e0d[_0x364e41(368)]
        }
      });
      return;
    }
    let _0x1a7226 = _0x3f50e0[_0x364e41(622)].find(function (_0x412e35) {
      const _0x545ee1 = _0x364e41;
      return _0x412e35[_0x545ee1(468)] === _0x3a812b[_0x545ee1(468)];
    });
    if (!!_0x1a7226) {
      let _0x216f9e = await _0x1d4964({
        $pull: {
          inviteMsg: {
            unionID: _0x3a812b[_0x364e41(468)]
          }
        }
      });
      _0x460a2f(null, {
        code: code.OK,
        updateUserData: {
          inviteMsg: _0x216f9e[_0x364e41(368)]
        }
      });
      return;
    }
    await await commonDao[_0x364e41(505)](_0x364e41(555), {
      unionID: _0x3a812b[_0x364e41(468)]
    }, {
      $inc: {
        curMember: 1
      }
    });
    let _0x55d295 = {
      unionID: _0x3a812b.unionID,
      spreaderID: _0x3a812b.uid,
      partner: _0x5a91f8[_0x364e41(526)],
      joinTime: Date[_0x364e41(477)](),
      inviteID: _0x1ddc8c[_0x364e41(631)]
    };
    let _0x1ddc8c = await commonDao[_0x364e41(690)]("uniqueIDModel", {
      key: 1
    }, {
      $inc: {
        unionInviteID: 7
      }
    }, {
      new: true,
      upsert: true
    });
    let _0x1c3926 = await userDao.updateUserDataByUid(_0x2940d[_0x364e41(394)], {
      $push: {
        unionInfo: _0x55d295
      },
      $pull: {
        inviteMsg: {
          unionID: _0x3a812b[_0x364e41(468)]
        }
      }
    });
    _0x460a2f(null, {
      code: code.OK,
      updateUserData: {
        inviteMsg: _0x1c3926[_0x364e41(368)],
        unionInfo: _0x1c3926[_0x364e41(622)]
      }
    });
  } catch (_0x20f8f7) {
    logger[_0x364e41(595)](_0x364e41(436) + _0x20f8f7.stack);
    _0x460a2f(null, {
      code: 500
    });
  }
};
Handler[a0_0x5d04f4(395)][a0_0x5d04f4(462)] = async function (_0x405c99, _0x4fda78, _0x43b5eb) {
  const _0x504a65 = a0_0x5d04f4;
  try {
    if (!_0x4fda78[_0x504a65(394)]) {
      _0x43b5eb(null, {
        code: code[_0x504a65(456)]
      });
      return;
    }
    _0x405c99[_0x504a65(696)] = _0x405c99[_0x504a65(485)];
    if (!_0x405c99[_0x504a65(468)] || !_0x405c99[_0x504a65(613)] || typeof _0x405c99[_0x504a65(696)] !== _0x504a65(588) || _0x405c99.rebateRate > 1 || _0x405c99.rebateRate < 0) {
      _0x43b5eb(null, {
        code: code.REQUEST_DATA_ERROR
      });
      return;
    }
    let _0x1bfc83 = await commonDao[_0x504a65(695)]("unionModel", {
      unionID: _0x405c99[_0x504a65(468)]
    });
    if (!_0x1bfc83) {
      _0x43b5eb(null, {
        code: code.PERMISSION_NOT_ENOUGH
      });
      return;
    }
    let _0x16e16c = await userDao[_0x504a65(489)](_0x4fda78[_0x504a65(394)]);
    if (!_0x16e16c) {
      _0x43b5eb(null, {
        code: code[_0x504a65(610)]
      });
      return;
    }
    let _0x5186c2 = _0x16e16c.unionInfo.find(function (_0x263ac5) {
      const _0x211182 = _0x504a65;
      return _0x263ac5[_0x211182(468)] === _0x405c99.unionID;
    });
    if (!_0x5186c2) {
      _0x43b5eb(null, {
        code: code[_0x504a65(434)]
      });
      return;
    }
    let _0x104a75 = await userDao.getUserDataByUid(_0x405c99[_0x504a65(613)]);
    if (!_0x104a75) {
      _0x43b5eb(null, {
        code: code[_0x504a65(533)]
      });
      return;
    }
    let _0x4edad5 = _0x104a75[_0x504a65(622)][_0x504a65(662)](function (_0x205a11) {
      const _0x42d64f = _0x504a65;
      return _0x205a11.unionID === _0x405c99[_0x42d64f(468)];
    });
    if (!_0x4edad5 || _0x4edad5[_0x504a65(486)] !== _0x4fda78[_0x504a65(394)]) {
      _0x43b5eb(null, {
        code: code[_0x504a65(610)]
      });
      return;
    }
    let _0x4baee8 = await userDao[_0x504a65(660)]({
      uid: _0x405c99[_0x504a65(613)],
      "unionInfo.unionID": _0x405c99[_0x504a65(468)]
    }, {
      "unionInfo.$.ticketRate": _0x405c99[_0x504a65(696)]
    });
    if (!!_0x4baee8.frontendId) {
      userInfoServices[_0x504a65(652)](_0x4baee8[_0x504a65(394)], _0x4baee8[_0x504a65(514)], {
        unionInfo: _0x4baee8[_0x504a65(622)]
      })[_0x504a65(608)](_0x29642a => {
        const _0x4fb288 = _0x504a65;
        logger[_0x4fb288(595)](_0x29642a);
      });
    }
    _0x43b5eb(null, {
      code: code.OK
    });
  } catch (_0x539b6c) {
    logger[_0x504a65(595)]("[updateUnionTicketRebate]" + _0x539b6c[_0x504a65(454)]);
    _0x43b5eb(null, {
      code: 500
    });
  }
};
Handler[a0_0x5d04f4(395)][a0_0x5d04f4(519)] = async function (_0x2c51ea, _0x29f67a, _0x4795af) {
  const _0x37aec1 = a0_0x5d04f4;
  try {
    if (!_0x29f67a[_0x37aec1(394)]) {
      _0x4795af(null, {
        code: code[_0x37aec1(456)]
      });
      return;
    }
    if (!_0x2c51ea.unionID || !_0x2c51ea[_0x37aec1(613)] || typeof _0x2c51ea[_0x37aec1(696)] !== _0x37aec1(588) || _0x2c51ea[_0x37aec1(696)] > 1 || _0x2c51ea[_0x37aec1(696)] < 0) {
      _0x4795af(null, {
        code: code.REQUEST_DATA_ERROR
      });
      return;
    }
    let _0x502b5b = await commonDao[_0x37aec1(695)](_0x37aec1(555), {
      unionID: _0x2c51ea[_0x37aec1(468)]
    });
    if (!_0x502b5b) {
      _0x4795af(null, {
        code: code.PERMISSION_NOT_ENOUGH
      });
      return;
    }
    let _0x2e8fea = await userDao[_0x37aec1(489)](_0x29f67a[_0x37aec1(394)]);
    if (!_0x2e8fea) {
      _0x4795af(null, {
        code: code[_0x37aec1(610)]
      });
      return;
    }
    let _0x8cf5af = _0x2e8fea.unionInfo[_0x37aec1(662)](function (_0xf2119b) {
      const _0x495918 = _0x37aec1;
      return _0xf2119b[_0x495918(468)] === _0x2c51ea[_0x495918(468)];
    });
    if (!_0x8cf5af || _0x8cf5af.rebateRate < _0x2c51ea.rebateRate) {
      _0x4795af(null, {
        code: code[_0x37aec1(434)]
      });
      return;
    }
    let _0xf1326c = await userDao[_0x37aec1(489)](_0x2c51ea[_0x37aec1(613)]);
    if (!_0xf1326c) {
      _0x4795af(null, {
        code: code[_0x37aec1(533)]
      });
      return;
    }
    let _0x42dc87 = _0xf1326c[_0x37aec1(622)][_0x37aec1(662)](function (_0x38ebf1) {
      const _0x220fd3 = _0x37aec1;
      return _0x38ebf1[_0x220fd3(468)] === _0x2c51ea[_0x220fd3(468)];
    });
    if (!_0x42dc87 || _0x42dc87[_0x37aec1(486)] !== _0x29f67a[_0x37aec1(394)]) {
      _0x4795af(null, {
        code: code[_0x37aec1(610)]
      });
      return;
    }
    let _0x54370b = await userDao[_0x37aec1(660)]({
      uid: _0x2c51ea[_0x37aec1(613)],
      "unionInfo.unionID": _0x2c51ea[_0x37aec1(468)]
    }, {
      "unionInfo.$.rebateRate": _0x2c51ea[_0x37aec1(696)]
    });
    if (!!_0x54370b[_0x37aec1(514)]) {
      userInfoServices[_0x37aec1(652)](_0x54370b[_0x37aec1(394)], _0x54370b[_0x37aec1(514)], {
        unionInfo: _0x54370b[_0x37aec1(622)]
      })[_0x37aec1(608)](_0x3cac46 => {
        const _0xc3fbf5 = _0x37aec1;
        logger[_0xc3fbf5(595)](_0x3cac46);
      });
    }
    _0x4795af(null, {
      code: code.OK
    });
  } catch (_0x15a368) {
    logger[_0x37aec1(595)](_0x37aec1(387) + _0x15a368[_0x37aec1(454)]);
    _0x4795af(null, {
      code: 500
    });
  }
};
Handler.prototype[a0_0x5d04f4(594)] = async function (_0x4362a7, _0x236d48, _0x321eb1) {
  const _0x4b8748 = a0_0x5d04f4;
  try {
    if (!_0x236d48.uid) {
      _0x321eb1(null, {
        code: code[_0x4b8748(456)]
      });
      return;
    }
    if (!_0x4362a7[_0x4b8748(468)] || !_0x4362a7.memberUid || typeof _0x4362a7[_0x4b8748(431)] !== _0x4b8748(588)) {
      _0x321eb1(null, {
        code: code.REQUEST_DATA_ERROR
      });
      return;
    }
    let _0x4ba69c = await commonDao[_0x4b8748(695)](_0x4b8748(555), {
      unionID: _0x4362a7[_0x4b8748(468)]
    });
    if (!_0x4ba69c) {
      _0x321eb1(null, {
        code: code[_0x4b8748(434)]
      });
      return;
    }
    let _0x5c8277 = await userDao.getUserDataByUid(_0x236d48.uid);
    if (!_0x5c8277) {
      _0x321eb1(null, {
        code: code[_0x4b8748(434)]
      });
      return;
    }
    let _0x1e3e8f = _0x5c8277[_0x4b8748(622)][_0x4b8748(662)](function (_0x4e267a) {
      const _0xbca7a2 = _0x4b8748;
      return _0x4e267a[_0xbca7a2(468)] === _0x4362a7.unionID;
    });
    if (!_0x1e3e8f) {
      _0x321eb1(null, {
        code: code[_0x4b8748(434)]
      });
      return;
    }
    let _0x4b0e0f = await userDao[_0x4b8748(489)](_0x4362a7[_0x4b8748(613)]);
    if (!_0x4b0e0f) {
      _0x321eb1(null, {
        code: code[_0x4b8748(533)]
      });
      return;
    }
    let _0x5a7389 = _0x4b0e0f[_0x4b8748(622)].find(function (_0x319ce8) {
      const _0x52cbdb = _0x4b8748;
      return _0x319ce8[_0x52cbdb(468)] === _0x4362a7.unionID;
    });
    if (!_0x5a7389 || _0x5a7389[_0x4b8748(486)] !== _0x236d48[_0x4b8748(394)]) {
      _0x321eb1(null, {
        code: code[_0x4b8748(610)]
      });
      return;
    }
    let _0x5de2b4 = await userDao[_0x4b8748(660)]({
      uid: _0x4362a7.memberUid,
      "unionInfo.unionID": _0x4362a7[_0x4b8748(468)]
    }, {
      "unionInfo.$.limitScore": _0x4362a7.limitScore
    });
    if (!!_0x5de2b4.frontendId) {
      userInfoServices.updateUserDataNotify(_0x5de2b4[_0x4b8748(394)], _0x5de2b4.frontendId, {
        unionInfo: _0x5de2b4[_0x4b8748(622)]
      })[_0x4b8748(608)](_0x33e405 => {
        const _0x4701ee = _0x4b8748;
        logger[_0x4701ee(595)](_0x33e405);
      });
    }
    _0x321eb1(null, {
      code: code.OK
    });
  } catch (_0x3a3239) {
    logger[_0x4b8748(595)](_0x4b8748(612) + _0x3a3239[_0x4b8748(454)]);
    _0x321eb1(null, {
      code: 500
    });
  }
};
Handler[a0_0x5d04f4(395)][a0_0x5d04f4(579)] = async function (_0x2f7be2, _0x4e5787, _0xb50ec6) {
  const _0x2e147e = a0_0x5d04f4;
  try {
    if (!_0x4e5787[_0x2e147e(394)]) {
      _0xb50ec6(null, {
        code: code.INVALID_UERS
      });
      return;
    }
    if (!_0x2f7be2[_0x2e147e(468)] || !_0x2f7be2[_0x2e147e(613)]) {
      _0xb50ec6(null, {
        code: code[_0x2e147e(434)]
      });
      return;
    }
    let _0x100f77 = await commonDao[_0x2e147e(695)](_0x2e147e(555), {
      unionID: _0x2f7be2[_0x2e147e(468)]
    });
    if (!_0x100f77) {
      _0xb50ec6(null, {
        code: code.REQUEST_DATA_ERROR
      });
      return;
    }
    let _0x1324dd = await userDao[_0x2e147e(489)](_0x4e5787.uid);
    if (!_0x1324dd) {
      _0xb50ec6(null, {
        code: code.REQUEST_DATA_ERROR
      });
      return;
    }
    let _0x26ccbf = await userDao.getUserDataByUid(_0x2f7be2[_0x2e147e(613)]);
    if (!_0x26ccbf) {
      _0xb50ec6(null, {
        code: code.PERMISSION_NOT_ENOUGH
      });
      return;
    }
    let _0x29866e = _0x26ccbf[_0x2e147e(622)][_0x2e147e(662)](function (_0x45a802) {
      const _0x16a685 = _0x2e147e;
      return _0x45a802[_0x16a685(468)] === _0x2f7be2.unionID;
    });
    if (!_0x29866e) {
      _0xb50ec6(null, {
        code: code[_0x2e147e(610)]
      });
      return;
    }
    if (_0x100f77.ownerUid !== _0x4e5787[_0x2e147e(394)] && !_0x29866e[_0x2e147e(526)] && !_0x29866e[_0x2e147e(409)]) {
      _0xb50ec6(null, {
        code: code[_0x2e147e(610)]
      });
      return;
    }
    let _0x3f1409 = _0x2f7be2[_0x2e147e(503)] == 1 ? true : false;
    let _0x4d59cb = await userDao[_0x2e147e(660)]({
      uid: _0x2f7be2[_0x2e147e(613)],
      "unionInfo.unionID": _0x2f7be2.unionID
    }, {
      "unionInfo.$.showFixScore": _0x3f1409
    });
    if (!!_0x4d59cb[_0x2e147e(514)]) {
      userInfoServices[_0x2e147e(652)](_0x4d59cb.uid, _0x4d59cb.frontendId, {
        unionInfo: _0x4d59cb[_0x2e147e(622)]
      })[_0x2e147e(608)](_0x629703 => {
        const _0x4f28d4 = _0x2e147e;
        logger[_0x4f28d4(595)](_0x629703);
      });
    }
    let _0x380412 = {
      code: code.OK,
      isShow: _0x2f7be2.isShow
    };
    _0xb50ec6(null, _0x380412);
  } catch (_0x6c7e0e) {
    logger[_0x2e147e(595)](_0x2e147e(544) + _0x6c7e0e[_0x2e147e(454)]);
    _0xb50ec6(null, {
      code: 500
    });
  }
};
Handler[a0_0x5d04f4(395)][a0_0x5d04f4(586)] = async function (_0x4cdca1, _0x15f516, _0x556d89) {
  const _0x56a106 = a0_0x5d04f4;
  try {
    if (!_0x15f516[_0x56a106(394)]) {
      _0x556d89(null, {
        code: code[_0x56a106(456)]
      });
      return;
    }
    if (!_0x4cdca1[_0x56a106(468)] || !_0x4cdca1[_0x56a106(613)]) {
      _0x556d89(null, {
        code: code.REQUEST_DATA_ERROR
      });
      return;
    }
    let _0xf0350a = await commonDao[_0x56a106(695)](_0x56a106(555), {
      unionID: _0x4cdca1[_0x56a106(468)]
    });
    if (!_0xf0350a) {
      _0x556d89(null, {
        code: code[_0x56a106(434)]
      });
      return;
    }
    let _0x5bd98d = await userDao[_0x56a106(489)](_0x15f516[_0x56a106(394)]);
    if (!_0x5bd98d) {
      _0x556d89(null, {
        code: code[_0x56a106(434)]
      });
      return;
    }
    let _0x5d0807 = await userDao.getUserDataByUid(_0x4cdca1.memberUid);
    if (!_0x5d0807) {
      _0x556d89(null, {
        code: code[_0x56a106(533)]
      });
      return;
    }
    let _0x18c91e = _0x5d0807[_0x56a106(622)].find(function (_0x148ba0) {
      const _0x1ba938 = _0x56a106;
      return _0x148ba0[_0x1ba938(468)] === _0x4cdca1[_0x1ba938(468)];
    });
    if (!_0x18c91e) {
      _0x556d89(null, {
        code: code.PERMISSION_NOT_ENOUGH
      });
      return;
    }
    if (_0xf0350a[_0x56a106(558)] !== _0x15f516.uid && !_0x18c91e.partner && !_0x18c91e[_0x56a106(409)]) {
      _0x556d89(null, {
        code: code[_0x56a106(610)]
      });
      return;
    }
    let _0x379e91 = _0x4cdca1[_0x56a106(556)] || 0;
    let _0x18c7e2 = await userDao.updateUserData({
      uid: _0x4cdca1[_0x56a106(613)],
      "unionInfo.unionID": _0x4cdca1[_0x56a106(468)]
    }, {
      "unionInfo.$.fixScoreRate": _0x379e91
    });
    if (!!_0x18c7e2[_0x56a106(514)]) {
      userInfoServices[_0x56a106(652)](_0x18c7e2[_0x56a106(394)], _0x18c7e2[_0x56a106(514)], {
        unionInfo: _0x18c7e2.unionInfo
      })[_0x56a106(608)](_0x85b115 => {
        const _0x498b20 = _0x56a106;
        logger[_0x498b20(595)](_0x85b115);
      });
    }
    let _0x4142cb = {
      code: code.OK,
      fixScoreRate: _0x4cdca1.fixScoreRate
    };
    _0x556d89(null, _0x4142cb);
  } catch (_0x55c728) {
    logger.error(_0x56a106(476) + _0x55c728.stack);
    _0x556d89(null, {
      code: 500
    });
  }
};
Handler[a0_0x5d04f4(395)].updateUnionNotice = async function (_0x337020, _0x55c9fa, _0x3c6917) {
  const _0x371eb2 = a0_0x5d04f4;
  try {
    if (!_0x55c9fa[_0x371eb2(394)]) {
      _0x3c6917(null, {
        code: code.INVALID_UERS
      });
      return;
    }
    if (!_0x337020[_0x371eb2(468)] || !_0x337020[_0x371eb2(539)] || _0x337020[_0x371eb2(539)].length > 40) {
      _0x3c6917(null, {
        code: code[_0x371eb2(434)]
      });
      return;
    }
    let _0x262064 = await userDao[_0x371eb2(660)]({
      uid: _0x55c9fa[_0x371eb2(394)],
      "unionInfo.unionID": _0x337020[_0x371eb2(468)]
    }, {
      "unionInfo.$.notice": _0x337020[_0x371eb2(539)]
    });
    _0x3c6917(null, {
      code: code.OK,
      updateUserData: {
        unionInfo: _0x262064[_0x371eb2(622)]
      }
    });
  } catch (_0xac9772) {
    logger[_0x371eb2(595)](_0x371eb2(626) + _0xac9772[_0x371eb2(454)]);
    _0x3c6917(null, {
      code: 500
    });
  }
};
Handler[a0_0x5d04f4(395)][a0_0x5d04f4(440)] = async function (_0x89ca5a, _0x36518c, _0x2533d6) {
  const _0x26c726 = a0_0x5d04f4;
  if (!userListPenging[_0x36518c[_0x26c726(394)]]) {
    userListPenging[_0x36518c[_0x26c726(394)]] = moment();
  } else {
    if (moment()[_0x26c726(550)](userListPenging[_0x36518c[_0x26c726(394)]], "s") < 3) {
      _0x2533d6(null, {
        code: code.USER_DATA_LOCKED
      });
      return;
    }
    userListPenging[_0x36518c[_0x26c726(394)]] = moment();
  }
  logger[_0x26c726(525)](_0x26c726(383) + getSimData(_0x89ca5a) + _0x26c726(403) + _0x36518c[_0x26c726(394)]);
  try {
    if (!_0x36518c[_0x26c726(394)]) {
      _0x2533d6(null, {
        code: code[_0x26c726(456)]
      });
      return;
    }
    _0x89ca5a.count = parseInt(_0x89ca5a[_0x26c726(682)]);
    if (!_0x89ca5a[_0x26c726(468)] || typeof _0x89ca5a.count !== "number" || _0x89ca5a.count <= 0 || !_0x89ca5a[_0x26c726(559)] || _0x36518c[_0x26c726(394)] === _0x89ca5a[_0x26c726(559)]) {
      _0x2533d6(null, {
        code: code[_0x26c726(434)]
      });
      return;
    }
    let _0x23a9a2 = await commonDao[_0x26c726(695)](_0x26c726(555), {
      unionID: _0x89ca5a[_0x26c726(468)]
    });
    if (!_0x23a9a2) {
      _0x2533d6(null, {
        code: code[_0x26c726(434)]
      });
      return;
    }
    if (!!_0x23a9a2[_0x26c726(524)] && _0x36518c[_0x26c726(394)] !== _0x23a9a2[_0x26c726(558)]) {
      _0x2533d6(null, {
        code: code[_0x26c726(518)]
      });
      return;
    }
    let _0x412c20 = await userDao.getUnlockUserDataAndLock(_0x36518c.uid);
    if (!_0x412c20 || !!_0x412c20[_0x26c726(444)]) {
      _0x2533d6(null, {
        code: code[_0x26c726(434)]
      });
      return;
    }
    let _0xe96e2 = _0x412c20[_0x26c726(622)][_0x26c726(662)](function (_0x48cc5e) {
      const _0x4a68e0 = _0x26c726;
      return _0x48cc5e[_0x4a68e0(468)] === _0x89ca5a.unionID;
    });
    if (!_0xe96e2 || _0xe96e2[_0x26c726(445)] < _0x89ca5a.count && _0x36518c[_0x26c726(394)] !== _0x23a9a2[_0x26c726(558)]) {
      await userDao[_0x26c726(397)](_0x36518c[_0x26c726(394)]);
      _0x2533d6(null, {
        code: code[_0x26c726(434)]
      });
      return;
    }
    let _0x493ede = await userDao[_0x26c726(489)](_0x89ca5a[_0x26c726(559)]);
    if (!_0x493ede) {
      _0x2533d6(null, {
        code: code[_0x26c726(456)]
      });
      return;
    }
    let _0x3a302e = _0x493ede.unionInfo[_0x26c726(662)](function (_0x45c92e) {
      return _0x45c92e.unionID === _0x89ca5a.unionID;
    });
    if (!_0x3a302e) {
      await userDao.unlockUserData(_0x36518c[_0x26c726(394)]);
      _0x2533d6(null, {
        code: code.NOT_IN_UNION
      });
      return;
    }
    let _0x96977f = null;
    _0x96977f = await userDao.updateUserDataAndUnlock({
      uid: _0x36518c[_0x26c726(394)],
      "unionInfo.unionID": _0x89ca5a[_0x26c726(468)]
    }, {
      $inc: {
        "unionInfo.$.score": -_0x89ca5a[_0x26c726(682)]
      }
    });
    let _0x1774da = await userDao[_0x26c726(660)]({
      uid: _0x89ca5a[_0x26c726(559)],
      "unionInfo.unionID": _0x89ca5a[_0x26c726(468)]
    }, {
      $inc: {
        "unionInfo.$.score": _0x89ca5a[_0x26c726(682)]
      }
    });
    let _0x5d4cee = {
      uid: _0x36518c[_0x26c726(394)],
      nickname: _0x96977f[_0x26c726(692)],
      gainUid: _0x89ca5a.giveUid,
      gainNickname: _0x493ede.nickname,
      gainAvatar: _0x493ede[_0x26c726(484)],
      unionID: _0x89ca5a[_0x26c726(468)],
      count: _0x89ca5a.count,
      createTime: Date[_0x26c726(477)]()
    };
    commonDao[_0x26c726(532)](_0x26c726(407), _0x5d4cee)[_0x26c726(608)](_0x4e43e8 => {
      const _0x1c8c1f = _0x26c726;
      logger[_0x1c8c1f(595)](_0x4e43e8.stack);
    });
    if (!!_0x1774da[_0x26c726(514)]) {
      userInfoServices[_0x26c726(652)](_0x1774da[_0x26c726(394)], _0x1774da[_0x26c726(514)], {
        unionInfo: _0x1774da[_0x26c726(622)]
      })[_0x26c726(608)](_0x244309 => {
        const _0x18b09b = _0x26c726;
        logger[_0x18b09b(595)](_0x244309[_0x18b09b(454)]);
      });
    }
    let _0x3b7de9 = _0x96977f.unionInfo[_0x26c726(662)](function (_0x329c8b) {
      const _0x4b53c5 = _0x26c726;
      return _0x329c8b[_0x4b53c5(468)] === _0x89ca5a[_0x4b53c5(468)];
    });
    let _0x20135d = [];
    _0x20135d[_0x26c726(687)]({
      uid: _0x96977f.uid,
      nickname: _0x96977f[_0x26c726(692)],
      unionID: _0x89ca5a[_0x26c726(468)],
      changeCount: -_0x89ca5a.count,
      leftCount: _0x3b7de9[_0x26c726(445)],
      leftSafeBoxCount: _0x3b7de9[_0x26c726(637)],
      leftSaveBoxCount: _0x3b7de9[_0x26c726(603)],
      changeType: enumeration.scoreChangeType[_0x26c726(548)],
      describe: _0x26c726(664) + _0x1774da[_0x26c726(394)] + ":" + _0x89ca5a[_0x26c726(682)],
      createTime: Date.now()
    });
    let _0x20b36a = _0x1774da[_0x26c726(622)][_0x26c726(662)](function (_0x31feb6) {
      const _0xc14990 = _0x26c726;
      return _0x31feb6[_0xc14990(468)] === _0x89ca5a[_0xc14990(468)];
    });
    _0x20135d.push({
      uid: _0x1774da[_0x26c726(394)],
      nickname: _0x1774da[_0x26c726(692)],
      unionID: _0x89ca5a[_0x26c726(468)],
      changeCount: _0x89ca5a[_0x26c726(682)],
      leftCount: _0x20b36a.score,
      leftSafeBoxCount: _0x20b36a[_0x26c726(637)],
      leftSaveBoxCount: _0x20b36a[_0x26c726(603)],
      changeType: enumeration[_0x26c726(437)][_0x26c726(548)],
      describe: _0x96977f[_0x26c726(394)] + "赠送" + ":" + _0x89ca5a.count,
      createTime: Date[_0x26c726(477)]()
    });
    await commonDao[_0x26c726(600)]("userScoreChangeRecordModel", _0x20135d);
    await commonDao[_0x26c726(600)](_0x26c726(490), _0x20135d).catch(_0x6c896 => {
      const _0x34266a = _0x26c726;
      logger[_0x34266a(595)](_0x6c896[_0x34266a(454)]);
    });
    _0x2533d6(null, {
      code: code.OK,
      updateUserData: {
        unionInfo: _0x96977f[_0x26c726(622)]
      }
    });
  } catch (_0x2ab9d8) {
    logger.error("[giveScore]" + _0x2ab9d8[_0x26c726(454)]);
    _0x2533d6(null, {
      code: code.OK
    });
  }
};
Handler[a0_0x5d04f4(395)][a0_0x5d04f4(672)] = async function (_0x22494a, _0x12b555, _0x182938) {
  const _0x2942d2 = a0_0x5d04f4;
  try {
    if (!_0x12b555[_0x2942d2(394)]) {
      _0x182938(null, {
        code: code[_0x2942d2(456)]
      });
      return;
    }
    if (!_0x22494a[_0x2942d2(468)] || !_0x22494a[_0x2942d2(554)]) {
      _0x182938(null, {
        code: code[_0x2942d2(434)]
      });
      return;
    }
    let _0x299d63 = await commonDao.findDataAndCount(_0x2942d2(407), _0x22494a[_0x2942d2(684)] || 0, _0x22494a[_0x2942d2(682)] || 20, {
      createTime: -1
    }, _0x22494a[_0x2942d2(554)]);
    let _0x5c924f = 0;
    if (!!_0x22494a.total) {
      let _0x54f0df = {
        _id: null,
        totalGiveCount: {
          $sum: "$count"
        }
      };
      let _0x5e3fb3 = [{
        $match: {
          uid: _0x12b555[_0x2942d2(394)],
          unionID: _0x22494a[_0x2942d2(468)]
        }
      }, {
        $group: _0x54f0df
      }];
      let _0x1e9a4e = await commonDao[_0x2942d2(635)](_0x2942d2(407), _0x5e3fb3);
      _0x1e9a4e[_0x2942d2(512)] > 0 && (_0x5c924f = _0x1e9a4e[0][_0x2942d2(427)]);
    }
    let _0xdf7b4a = 0;
    if (!!_0x22494a[_0x2942d2(361)]) {
      let _0x33f300 = {
        _id: null,
        totalGiveCount: {
          $sum: _0x2942d2(685)
        }
      };
      let _0x1f1d2c = [{
        $match: {
          gainUid: _0x12b555.uid,
          unionID: _0x22494a[_0x2942d2(468)]
        }
      }, {
        $group: _0x33f300
      }];
      let _0x3fc965 = await commonDao[_0x2942d2(635)](_0x2942d2(407), _0x1f1d2c);
      _0x3fc965[_0x2942d2(512)] > 0 && (_0xdf7b4a = _0x3fc965[0][_0x2942d2(427)]);
    }
    let _0x404468 = {
      recordArr: _0x299d63[_0x2942d2(487)],
      totalCount: _0x299d63[_0x2942d2(589)]
    };
    _0x22494a[_0x2942d2(361)] && (_0x404468[_0x2942d2(427)] = _0x5c924f, _0x404468[_0x2942d2(667)] = _0xdf7b4a);
    _0x182938(null, {
      code: code.OK,
      msg: _0x404468
    });
  } catch (_0x4a451c) {
    logger[_0x2942d2(595)]("[getGiveScoreRecord]" + _0x4a451c.stack);
    _0x182938(null, {
      code: 500
    });
  }
};
Handler[a0_0x5d04f4(395)][a0_0x5d04f4(549)] = async function (_0xe73b8e, _0x4acd0f, _0x422bda) {
  const _0x41d8d8 = a0_0x5d04f4;
  try {
    if (!_0x4acd0f.uid) {
      _0x422bda(null, {
        code: code.INVALID_UERS
      });
      return;
    }
    if (!_0xe73b8e[_0x41d8d8(554)]) {
      _0x422bda(null, {
        code: code[_0x41d8d8(434)]
      });
      return;
    }
    let _0x2ea76d = await commonDao[_0x41d8d8(465)]("userRebateRecordModel", _0xe73b8e[_0x41d8d8(684)] || 0, _0xe73b8e.count || 20, {
      createTime: -1
    }, _0xe73b8e.matchData);
    _0x422bda(null, {
      code: code.OK,
      msg: {
        recordArr: _0x2ea76d.recordArr,
        totalCount: _0x2ea76d.totalCount
      }
    });
  } catch (_0x5bd911) {
    logger[_0x41d8d8(595)]("[getUnionRebateRecord]" + _0x5bd911[_0x41d8d8(454)]);
    _0x422bda(null, {
      code: 500
    });
  }
};
Handler.prototype[a0_0x5d04f4(641)] = async function (_0xff47a5, _0x5a2896, _0x468f43) {
  const _0x1db6c5 = a0_0x5d04f4;
  try {
    if (!_0x5a2896[_0x1db6c5(394)]) {
      _0x468f43(null, {
        code: code[_0x1db6c5(456)]
      });
      return;
    }
    if (!_0xff47a5[_0x1db6c5(704)]) {
      _0x468f43(null, {
        code: code[_0x1db6c5(434)]
      });
      return;
    }
    let _0x42a349 = await commonDao[_0x1db6c5(695)](_0x1db6c5(365), {
      index: _0xff47a5[_0x1db6c5(704)]
    });
    _0x468f43(null, {
      code: code.OK,
      msg: _0x42a349
    });
  } catch (_0x546f2b) {
    logger.error(_0x1db6c5(429) + _0x546f2b[_0x1db6c5(454)]);
    _0x468f43(null, {
      code: 500
    });
  }
};
Handler[a0_0x5d04f4(395)].getGameRecord = async function (_0x4e6b1f, _0x2d9d8e, _0x4b3cbd) {
  const _0x54a09c = a0_0x5d04f4;
  try {
    if (!_0x2d9d8e[_0x54a09c(394)]) {
      _0x4b3cbd(null, {
        code: code[_0x54a09c(456)]
      });
      return;
    }
    if (!_0x4e6b1f[_0x54a09c(394)]) {
      _0x4b3cbd(null, {
        code: code[_0x54a09c(456)]
      });
      return;
    }
    if (!_0x4e6b1f[_0x54a09c(554)]) {
      _0x4b3cbd(null, {
        code: code[_0x54a09c(434)]
      });
      return;
    }
    let _0x51c5cf = _0x4e6b1f[_0x54a09c(394)];
    let _0x1b19fb = await commonDao.findDataAndCount(_0x54a09c(365), _0x4e6b1f[_0x54a09c(684)] || 0, _0x4e6b1f[_0x54a09c(682)] || 20, {
      createTime: -1
    }, _0x4e6b1f[_0x54a09c(554)]);
    let _0x3a59b7 = await commonDao.findDataAndCount(_0x54a09c(365), 0, 0, {
      createTime: -1
    }, _0x4e6b1f[_0x54a09c(554)]);
    let _0x1260d9 = 0;
    let _0xba4c26 = 0;
    let _0x4251a1 = 0;
    let _0xf4e0da = 0;
    let _0x547af2 = _0x3a59b7[_0x54a09c(487)];
    for (let _0x369f3d = 0; _0x369f3d < _0x547af2[_0x54a09c(512)]; _0x369f3d++) {
      let _0x4a0b0a = _0x547af2[_0x369f3d];
      let _0x467e65 = _0x4a0b0a[_0x54a09c(455)];
      let _0x5249ab = null;
      let _0x2b6b2a = 0;
      for (let _0x25c7eb = 0; _0x25c7eb < _0x467e65[_0x54a09c(512)]; _0x25c7eb++) {
        let _0x4caef0 = _0x467e65[_0x25c7eb];
        _0x4caef0[_0x54a09c(445)] > _0x2b6b2a && (_0x2b6b2a = _0x4caef0[_0x54a09c(445)], _0x5249ab = _0x4caef0[_0x54a09c(394)]);
        _0x4caef0[_0x54a09c(394)] == _0x51c5cf && (_0x1260d9 += 1, _0xf4e0da += _0x4caef0.score, _0x4caef0[_0x54a09c(445)] > 0 && (_0xba4c26 += 1));
      }
      _0x5249ab == _0x51c5cf && (_0x4251a1 += 1);
    }
    _0x4b3cbd(null, {
      code: code.OK,
      msg: {
        recordArr: _0x1b19fb[_0x54a09c(487)],
        totalCount: _0x1b19fb[_0x54a09c(589)],
        totalDraw: _0x1260d9,
        totalbigWinDraw: _0x4251a1,
        totalWinDraw: _0xba4c26,
        totalWin: _0xf4e0da
      }
    });
  } catch (_0x2bed73) {
    logger.error(_0x54a09c(494) + _0x2bed73.stack);
    _0x4b3cbd(null, {
      code: 500
    });
  }
};
Handler[a0_0x5d04f4(395)].getVideoRecord = async function (_0x21d4f2, _0x554f03, _0x22e58a) {
  const _0x298a60 = a0_0x5d04f4;
  try {
    if (!_0x554f03[_0x298a60(394)]) {
      _0x22e58a(null, {
        code: code.INVALID_UERS
      });
      return;
    }
    if (!_0x21d4f2[_0x298a60(634)]) {
      _0x22e58a(null, {
        code: code[_0x298a60(434)]
      });
      return;
    }
    let _0x424fe3 = await commonDao[_0x298a60(695)]("gameVideoRecordModel", {
      videoRecordID: _0x21d4f2[_0x298a60(634)]
    });
    _0x22e58a(null, {
      code: code.OK,
      msg: {
        gameVideoRecordData: _0x424fe3
      }
    });
  } catch (_0x431626) {
    logger[_0x298a60(595)](_0x298a60(511) + _0x431626[_0x298a60(454)]);
    _0x22e58a(null, {
      code: 500
    });
  }
};
Handler[a0_0x5d04f4(395)][a0_0x5d04f4(498)] = async function (_0x1797f7, _0xad4131, _0x4dea31) {
  const _0x365b31 = a0_0x5d04f4;
  try {
    if (!_0xad4131[_0x365b31(394)]) {
      _0x4dea31(null, {
        code: code[_0x365b31(456)]
      });
      return;
    }
    if (!_0x1797f7[_0x365b31(468)] || !_0x1797f7.uid) {
      _0x4dea31(null, {
        code: code[_0x365b31(434)]
      });
      return;
    }
    let _0x927674 = await userDao.getUserDataByUid(_0xad4131[_0x365b31(394)]);
    let _0x2e2bfb = _0x927674[_0x365b31(622)][_0x365b31(662)](function (_0x1033ef) {
      const _0x14b5ef = _0x365b31;
      return _0x1033ef[_0x14b5ef(468)] === _0x1797f7[_0x14b5ef(468)];
    });
    if (!_0x2e2bfb) {
      _0x4dea31(null, {
        code: code[_0x365b31(610)]
      });
      return;
    }
    let _0x56ae87 = _0x1797f7[_0x365b31(570)] || false;
    let _0x6f8868 = await commonDao.findOneData("unionModel", {
      unionID: _0x1797f7.unionID
    });
    if (!_0x6f8868 || _0x6f8868[_0x365b31(558)] !== _0xad4131[_0x365b31(394)] && !_0x2e2bfb[_0x365b31(409)]) {
      _0x4dea31(null, {
        code: code[_0x365b31(610)]
      });
      return;
    }
    let _0x267708 = await userDao.getUserDataByUid(_0x1797f7[_0x365b31(394)]);
    if (!_0x267708) {
      _0x4dea31(null, {
        code: code[_0x365b31(434)]
      });
      return;
    }
    if (_0x267708[_0x365b31(598)] === _0x56ae87) {
      _0x4dea31(null, {
        code: code.OK
      });
      return;
    }
    let _0x2f680f = await userDao[_0x365b31(660)]({
      uid: _0x1797f7.uid,
      "unionInfo.unionID": _0x1797f7[_0x365b31(468)]
    }, {
      "unionInfo.$.prohibitGame": _0x56ae87
    });
    if (!!_0x2f680f[_0x365b31(514)]) {
      userInfoServices[_0x365b31(652)](_0x2f680f[_0x365b31(394)], _0x2f680f[_0x365b31(514)], {
        unionInfo: _0x2f680f[_0x365b31(622)]
      })[_0x365b31(608)](_0x41122c => {
        const _0x4345c0 = _0x365b31;
        logger[_0x4345c0(595)](_0x41122c[_0x4345c0(454)]);
      });
    }
    _0x4dea31(null, {
      code: code.OK
    });
  } catch (_0x4aefc6) {
    logger.error(_0x365b31(576) + _0x4aefc6[_0x365b31(454)]);
    _0x4dea31(null, {
      code: 500
    });
  }
};
Handler[a0_0x5d04f4(395)].getRank = async function (_0x376449, _0x534c8e, _0x438e33) {
  const _0xf12ae1 = a0_0x5d04f4;
  try {
    if (!_0x534c8e[_0xf12ae1(394)]) {
      _0x438e33(null, {
        code: code.INVALID_UERS
      });
      return;
    }
    if (!_0x376449[_0xf12ae1(468)] || !_0x376449.matchData || !_0x376449.sortData) {
      _0x438e33(null, {
        code: code[_0xf12ae1(434)]
      });
      return;
    }
    let _0x511d2c = await userDao[_0xf12ae1(489)](_0x534c8e.uid);
    let _0x3254a5 = _0x511d2c[_0xf12ae1(622)][_0xf12ae1(662)](function (_0xa2d099) {
      const _0x34d3fd = _0xf12ae1;
      return _0xa2d099[_0x34d3fd(468)] === _0x376449[_0x34d3fd(468)];
    });
    if (!_0x3254a5) {
      _0x438e33(null, {
        code: code.REQUEST_DATA_ERROR
      });
      return;
    }
    let _0x24dd94 = await commonDao[_0xf12ae1(695)](_0xf12ae1(555), {
      unionID: _0x376449.unionID
    });
    if (!_0x24dd94 || _0x24dd94[_0xf12ae1(558)] !== _0x534c8e.uid && !_0x3254a5.manager && !_0x24dd94[_0xf12ae1(567)]) {
      _0x438e33(null, {
        code: code[_0xf12ae1(434)]
      });
      return;
    }
    let _0x53f2f4 = [{
      $unwind: "$unionInfo"
    }, {
      $match: _0x376449[_0xf12ae1(554)]
    }, {
      $match: _0x376449[_0xf12ae1(554)]
    }, {
      $sort: _0x376449[_0xf12ae1(689)]
    }, {
      $skip: _0x376449.startIndex || 0
    }, {
      $limit: _0x376449.count || 10
    }];
    let _0x524b93 = await commonDao[_0xf12ae1(635)](_0xf12ae1(488), _0x53f2f4);
    let _0x4d6d6c = [];
    for (let _0x54b57d = 0; _0x54b57d < _0x524b93[_0xf12ae1(512)]; ++_0x54b57d) {
      let _0x5b2649 = _0x524b93[_0x54b57d];
      let _0xe37eff = _0x5b2649[_0xf12ae1(622)];
      if (!_0xe37eff) {
        continue;
      }
      _0x4d6d6c.push({
        uid: _0x5b2649[_0xf12ae1(394)],
        nickname: _0x5b2649.nickname,
        avatar: _0x5b2649[_0xf12ae1(484)],
        todayWin: _0xe37eff[_0xf12ae1(592)] || 0,
        todayDraw: _0xe37eff.todayDraw,
        weekDraw: _0xe37eff[_0xf12ae1(443)] || 0,
        totalDraw: _0xe37eff.totalDraw || 0,
        score: _0xe37eff[_0xf12ae1(445)] || 0,
        yesterdayWin: _0xe37eff.yesterdayWin || 0
      });
    }
    _0x438e33(null, {
      code: code.OK,
      msg: {
        recordArr: _0x4d6d6c
      }
    });
  } catch (_0x5e3afd) {
    logger.error(_0xf12ae1(515) + _0x5e3afd[_0xf12ae1(454)]);
    _0x438e33(null, {
      code: 500
    });
  }
};
Handler[a0_0x5d04f4(395)][a0_0x5d04f4(414)] = async function (_0x5426b0, _0xe1e5ed, _0x239330) {
  const _0x362ddd = a0_0x5d04f4;
  try {
    if (!_0xe1e5ed[_0x362ddd(394)]) {
      _0x239330(null, {
        code: code[_0x362ddd(456)]
      });
      return;
    }
    if (!_0x5426b0[_0x362ddd(468)] || !_0x5426b0[_0x362ddd(554)] || !_0x5426b0[_0x362ddd(689)]) {
      _0x239330(null, {
        code: code[_0x362ddd(434)]
      });
      return;
    }
    let _0x11adee = await userDao[_0x362ddd(489)](_0xe1e5ed[_0x362ddd(394)]);
    let _0xc80e27 = _0x11adee[_0x362ddd(622)][_0x362ddd(662)](function (_0xfdf48f) {
      const _0x1c252d = _0x362ddd;
      return _0xfdf48f[_0x1c252d(468)] === _0x5426b0.unionID;
    });
    if (!_0xc80e27) {
      _0x239330(null, {
        code: code[_0x362ddd(434)]
      });
      return;
    }
    let _0x1b2c9c = await commonDao[_0x362ddd(695)](_0x362ddd(555), {
      unionID: _0x5426b0[_0x362ddd(468)]
    });
    if (!_0x1b2c9c || _0x1b2c9c.ownerUid !== _0xe1e5ed[_0x362ddd(394)] && !_0xc80e27.manager && !_0x1b2c9c[_0x362ddd(420)]) {
      _0x239330(null, {
        code: code[_0x362ddd(434)]
      });
      return;
    }
    _0x5426b0[_0x362ddd(554)][_0x362ddd(385)] = {
      $gte: utils[_0x362ddd(676)]()
    };
    let _0x465acc = {
      _id: _0x362ddd(701),
      nickname: {
        $first: _0x362ddd(675)
      },
      avatar: {
        $first: _0x362ddd(483)
      }
    };
    _0x5426b0[_0x362ddd(689)].score === 1 ? _0x465acc[_0x362ddd(445)] = {
      $min: _0x362ddd(366)
    } : _0x465acc[_0x362ddd(445)] = {
      $max: "$userList.score"
    };
    let _0x3c97c4 = [{
      $match: _0x5426b0.matchData
    }, {
      $unwind: _0x362ddd(702)
    }, {
      $match: _0x5426b0[_0x362ddd(554)]
    }, {
      $group: _0x465acc
    }, {
      $sort: _0x5426b0[_0x362ddd(689)]
    }, {
      $skip: _0x5426b0[_0x362ddd(684)] || 0
    }, {
      $limit: _0x5426b0[_0x362ddd(682)] || 10
    }];
    let _0x8445ee = await commonDao[_0x362ddd(635)](_0x362ddd(365), _0x3c97c4);
    let _0x311fee = [];
    for (let _0x378e6a = 0; _0x378e6a < _0x8445ee[_0x362ddd(512)]; ++_0x378e6a) {
      let _0x41d332 = _0x8445ee[_0x378e6a];
      _0x41d332.uid = _0x41d332[_0x362ddd(578)];
      _0x311fee.push(_0x41d332);
    }
    _0x239330(null, {
      code: code.OK,
      msg: {
        recordArr: _0x311fee
      }
    });
  } catch (_0x5025f5) {
    logger.error(_0x362ddd(584) + _0x5025f5[_0x362ddd(454)]);
    _0x239330(null, {
      code: 500
    });
  }
};
Handler[a0_0x5d04f4(395)][a0_0x5d04f4(379)] = async function (_0x18d41f, _0x41f90f, _0x17916e) {
  const _0x4c8ccf = a0_0x5d04f4;
  try {
    if (!_0x41f90f[_0x4c8ccf(394)]) {
      _0x17916e(null, {
        code: code.INVALID_UERS
      });
      return;
    }
    if (!_0x18d41f[_0x4c8ccf(468)] || !_0x18d41f[_0x4c8ccf(370)] || !_0x18d41f[_0x4c8ccf(394)]) {
      _0x17916e(null, {
        code: code[_0x4c8ccf(434)]
      });
      return;
    }
    commonDao[_0x4c8ccf(449)](_0x4c8ccf(500), {
      uid: _0x18d41f[_0x4c8ccf(394)],
      unionID: _0x18d41f[_0x4c8ccf(468)]
    }, {
      uid: _0x18d41f[_0x4c8ccf(394)],
      unionID: _0x18d41f[_0x4c8ccf(468)],
      list: _0x18d41f.list
    }, {
      upsert: true
    }).catch(_0x12ffc2 => {
      const _0xea5377 = _0x4c8ccf;
      logger[_0xea5377(595)](_0x12ffc2);
    });
    _0x17916e(null, {
      code: code.OK
    });
  } catch (_0x2dd960) {
    logger[_0x4c8ccf(595)]("[userLimitAdd]" + _0x2dd960[_0x4c8ccf(454)]);
    _0x17916e(null, {
      code: 500
    });
  }
};
Handler[a0_0x5d04f4(395)].userLimitRecord = async function (_0x23ebca, _0x33e28a, _0x28dbfd) {
  const _0x4898e8 = a0_0x5d04f4;
  try {
    if (!_0x33e28a[_0x4898e8(394)]) {
      _0x28dbfd(null, {
        code: code.INVALID_UERS
      });
      return;
    }
    if (!_0x23ebca.unionID || !_0x23ebca.uid) {
      _0x28dbfd(null, {
        code: code.REQUEST_DATA_ERROR
      });
      return;
    }
    let _0x4854f6 = {
      uid: _0x23ebca.uid,
      unionID: _0x23ebca[_0x4898e8(468)]
    };
    let _0x42b904 = await commonDao[_0x4898e8(695)]("gameLimitModel", _0x4854f6);
    _0x28dbfd(null, {
      code: code.OK,
      msg: _0x42b904
    });
  } catch (_0x3de642) {
    logger.error(_0x4898e8(591) + _0x3de642[_0x4898e8(454)]);
    _0x28dbfd(null, {
      code: 500
    });
  }
};
Handler[a0_0x5d04f4(395)][a0_0x5d04f4(617)] = async function (_0x10e754, _0x501dd3, _0x54d351) {
  const _0x7de49a = a0_0x5d04f4;
  try {
    if (!_0x501dd3[_0x7de49a(394)]) {
      _0x54d351(null, {
        code: code[_0x7de49a(456)]
      });
      return;
    }
    if (!_0x10e754[_0x7de49a(468)]) {
      _0x54d351(null, {
        code: code[_0x7de49a(434)]
      });
      return;
    }
    let _0x45d776 = {
      unionID: _0x10e754[_0x7de49a(468)]
    };
    let _0x21555a = await commonDao[_0x7de49a(465)](_0x7de49a(698), _0x10e754[_0x7de49a(684)] || 0, _0x10e754[_0x7de49a(682)] || 20, {
      createTime: -1
    }, _0x45d776);
    _0x54d351(null, {
      code: code.OK,
      msg: _0x21555a
    });
  } catch (_0x32db27) {
    logger[_0x7de49a(595)]("[userDelRecord]" + _0x32db27[_0x7de49a(454)]);
    _0x54d351(null, {
      code: 500
    });
  }
};
Handler.prototype[a0_0x5d04f4(583)] = async function (_0x9a562c, _0x32ddba, _0xa87f6b) {
  const _0x326305 = a0_0x5d04f4;
  logger[_0x326305(525)]("[deleteUserForUnion] msg = " + getSimData(_0x9a562c) + _0x326305(403) + _0x32ddba[_0x326305(394)]);
  try {
    if (!_0x32ddba[_0x326305(394)]) {
      _0xa87f6b(null, {
        code: code[_0x326305(456)]
      });
      return;
    }
    if (!_0x9a562c[_0x326305(468)]) {
      _0xa87f6b(null, {
        code: code[_0x326305(434)]
      });
      return;
    }
    let _0x41111c = await commonDao.findOneData(_0x326305(555), {
      unionID: _0x9a562c[_0x326305(468)]
    });
    if (!_0x41111c) {
      let _0xe01c83 = await userDao[_0x326305(618)](_0x32ddba[_0x326305(394)], {
        $push: {
          unionInfo: {
            unionID: _0x9a562c.unionID
          }
        }
      });
      _0xa87f6b(null, {
        code: code.OK,
        updateUserData: {
          unionInfo: _0xe01c83[_0x326305(622)]
        }
      });
      return;
    }
    if (_0x41111c[_0x326305(558)] === _0x9a562c[_0x326305(394)]) {
      _0xa87f6b(null, {
        code: code[_0x326305(434)]
      });
      return;
    }
    let _0x1e3f51 = await userDao.getUserData({
      uid: _0x9a562c[_0x326305(394)],
      "unionInfo.unionID": _0x9a562c[_0x326305(468)]
    });
    if (!_0x1e3f51) {
      _0xa87f6b(null, {
        code: code.OK
      });
      return;
    }
    if (!!_0x1e3f51[_0x326305(444)]) {
      _0xa87f6b(null, {
        code: code.USER_IN_ROOM_DATA_LOCKED
      });
      return;
    }
    let _0x111afb = null;
    for (let _0x353ed8 = 0; _0x353ed8 < _0x1e3f51.unionInfo[_0x326305(512)]; ++_0x353ed8) {
      if (_0x1e3f51[_0x326305(622)][_0x353ed8].unionID === _0x9a562c[_0x326305(468)]) {
        _0x111afb = _0x1e3f51[_0x326305(622)][_0x353ed8];
        break;
      }
    }
    if (!_0x111afb) {
      _0xa87f6b(null, {
        code: code.OK
      });
      return;
    }
    let _0x472983 = await userDao.getUserDataByUid(_0x32ddba[_0x326305(394)]);
    if (!_0x472983) {
      _0xa87f6b(null, {
        code: code.INVALID_UERS
      });
      return;
    }
    let _0x369d31 = _0x472983[_0x326305(622)][_0x326305(662)](function (_0x2fdecc) {
      const _0x10f654 = _0x326305;
      return _0x2fdecc[_0x10f654(468)] === _0x9a562c[_0x10f654(468)];
    });
    if (!_0x369d31) {
      _0xa87f6b(null, {
        code: code[_0x326305(610)]
      });
      return;
    }
    logger.info(_0x326305(651) + _0x41111c[_0x326305(558)] + _0x326305(453) + _0x111afb[_0x326305(486)] + _0x326305(399) + _0x369d31.partner + "  isManager = " + _0x111afb[_0x326305(409)] + _0x326305(403) + _0x32ddba[_0x326305(394)]);
    if (!_0x369d31.partner) {
      _0xa87f6b(null, {
        code: code[_0x326305(610)]
      });
      return;
    }
    if (_0x32ddba.uid != _0x111afb[_0x326305(486)] && _0x32ddba[_0x326305(394)] != _0x41111c[_0x326305(558)]) {
      _0xa87f6b(null, {
        code: code[_0x326305(610)]
      });
      return;
    }
    let _0x1232f5 = parseFloat((_0x111afb[_0x326305(445)] + _0x111afb[_0x326305(637)] + (_0x111afb[_0x326305(603)] || 0))[_0x326305(645)](2));
    if (_0x1232f5 > 1) {
      _0xa87f6b(null, {
        code: code[_0x326305(434)]
      });
      return;
    }
    if (_0x1232f5 < 0) {
      logger[_0x326305(525)](_0x326305(422) + _0x1232f5);
      _0xa87f6b(null, {
        code: code.REQUEST_DATA_ERROR
      });
      return;
    }
    let _0x1fd394 = await userDao[_0x326305(660)]({
      uid: _0x41111c[_0x326305(558)],
      "unionInfo.unionID": _0x9a562c[_0x326305(468)]
    }, {
      $inc: {
        "unionInfo.$.score": _0x1232f5
      }
    });
    if (!!_0x1fd394[_0x326305(514)]) {
      userInfoServices[_0x326305(652)](_0x1fd394[_0x326305(394)], _0x1fd394[_0x326305(514)], {
        unionInfo: _0x1fd394[_0x326305(622)]
      })[_0x326305(608)](_0x1b46e8 => {
        const _0x5b301d = _0x326305;
        logger.error(_0x1b46e8[_0x5b301d(454)]);
      });
    }
    let _0x2a10bb = _0x1e3f51[_0x326305(394)];
    let _0x5f1d43 = _0x1e3f51[_0x326305(484)];
    let _0x397809 = _0x1e3f51.nickname;
    let _0x4f92f7 = await userDao[_0x326305(489)](_0x32ddba.uid);
    let _0xf0370f = _0x4f92f7[_0x326305(394)];
    let _0x870ea6 = _0x4f92f7[_0x326305(484)];
    let _0x3b1fd9 = _0x4f92f7[_0x326305(692)];
    await commonDao.createData(_0x326305(698), {
      type: 1,
      doneUid: _0x2a10bb,
      doneAvatar: _0x5f1d43,
      doneNickname: _0x397809,
      uid: _0xf0370f,
      avatar: _0x870ea6,
      nickname: _0x3b1fd9,
      score: _0x1232f5,
      unionID: _0x9a562c[_0x326305(468)],
      createTime: Date[_0x326305(477)]()
    });
    let _0x4289c1 = await userDao[_0x326305(618)](_0x9a562c[_0x326305(394)], {
      $pull: {
        unionInfo: {
          unionID: _0x9a562c.unionID
        }
      },
      unionID: 0,
      isBind: false
    });
    if (!!_0x4289c1[_0x326305(514)]) {
      userInfoServices[_0x326305(652)](_0x4289c1[_0x326305(394)], _0x4289c1[_0x326305(514)], {
        unionInfo: _0x4289c1[_0x326305(622)]
      })[_0x326305(608)](_0x3ee510 => {
        const _0x12162a = _0x326305;
        logger[_0x12162a(595)](_0x3ee510.stack);
      });
    }
    await commonDao.updateAllData(_0x326305(488), {
      unionInfo: {
        $elemMatch: {
          spreaderID: _0x9a562c[_0x326305(394)],
          unionID: _0x9a562c[_0x326305(468)]
        }
      }
    }, {
      "unionInfo.$.spreaderID": _0x111afb[_0x326305(486)]
    });
    commonDao[_0x326305(505)](_0x326305(555), {
      unionID: _0x9a562c[_0x326305(468)]
    }, {
      $inc: {
        curMember: -1
      }
    })[_0x326305(608)](_0x3f902e => {
      const _0x18d958 = _0x326305;
      logger[_0x18d958(595)](_0x3f902e[_0x18d958(454)]);
    });
    _0xa87f6b(null, {
      code: code.OK
    });
    logger[_0x326305(525)](_0x326305(401));
  } catch (_0x46da83) {
    logger.error(_0x326305(535) + _0x46da83[_0x326305(454)]);
    _0xa87f6b(null, {
      code: 500
    });
  }
};
Handler[a0_0x5d04f4(395)].removeCaptainPartner = async function (_0x1d0bc6, _0x3129a9, _0x296566) {
  const _0x311cdb = a0_0x5d04f4;
  logger.info("[removeCaptainPartner] msg = " + getSimData(_0x1d0bc6) + " sessionUid = " + _0x3129a9.uid);
  try {
    if (!_0x3129a9[_0x311cdb(394)]) {
      _0x296566(null, {
        code: code[_0x311cdb(456)]
      });
      return;
    }
    if (!_0x1d0bc6[_0x311cdb(468)] || !_0x1d0bc6[_0x311cdb(613)] || !_0x1d0bc6[_0x311cdb(418)]) {
      _0x296566(null, {
        code: code[_0x311cdb(456)]
      });
      return;
    }
    let _0x3fe3c2 = await commonDao[_0x311cdb(695)](_0x311cdb(555), {
      unionID: _0x1d0bc6[_0x311cdb(468)]
    });
    if (!_0x3fe3c2) {
      _0x296566(null, {
        code: code.UNION_NOT_EXIST
      });
      return;
    }
    let _0x4094c1 = await userDao[_0x311cdb(489)](_0x3129a9.uid);
    if (!_0x4094c1) {
      _0x296566(null, {
        code: code.INVALID_UERS
      });
      return;
    }
    let _0x39a5f0 = await userDao[_0x311cdb(489)](_0x1d0bc6[_0x311cdb(418)]);
    if (!_0x39a5f0) {
      _0x296566(null, {
        code: code.INVALID_UERS
      });
      return;
    }
    let _0x542bf3 = _0x39a5f0[_0x311cdb(622)][_0x311cdb(662)](function (_0xfd4701) {
      const _0x5290ed = _0x311cdb;
      return _0xfd4701[_0x5290ed(468)] === _0x1d0bc6.unionID;
    });
    if (!_0x542bf3 || !_0x542bf3[_0x311cdb(526)]) {
      _0x296566(null, {
        code: code[_0x311cdb(610)]
      });
      return;
    }
    let _0xb9b00f = await userDao[_0x311cdb(489)](_0x1d0bc6[_0x311cdb(613)]);
    if (!_0xb9b00f) {
      _0x296566(null, {
        code: code.INVALID_UERS
      });
      return;
    }
    let _0x27f0f5 = _0xb9b00f.unionInfo.find(function (_0x455d11) {
      const _0x29aa7e = _0x311cdb;
      return _0x455d11[_0x29aa7e(468)] === _0x1d0bc6[_0x29aa7e(468)];
    });
    if (!_0x27f0f5) {
      _0x296566(null, {
        code: code[_0x311cdb(602)]
      });
      return;
    }
    if (!_0x27f0f5.partner) {
      _0x296566(null, {
        code: code[_0x311cdb(456)]
      });
      return;
    }
    let _0x27335c = await userInfoServices.getUserLowAll(_0xb9b00f[_0x311cdb(394)], _0x1d0bc6[_0x311cdb(468)]);
    _0x27335c = _0x27335c.filter(_0x285a27 => _0x285a27 != _0x1d0bc6[_0x311cdb(613)]);
    if (_0x27335c[_0x311cdb(512)] > 0) {
      _0x296566(null, {
        code: code[_0x311cdb(563)]
      });
      return;
    }
    let _0x33dfb1 = await userDao[_0x311cdb(660)]({
      uid: _0x1d0bc6[_0x311cdb(613)],
      "unionInfo.unionID": _0x1d0bc6[_0x311cdb(468)]
    }, {
      "unionInfo.$.partner": _0x1d0bc6[_0x311cdb(623)],
      "unionInfo.$.ticketRate": 0,
      "unionInfo.$.rebateRate": 0
    });
    if (!!_0x33dfb1.frontendId) {
      userInfoServices[_0x311cdb(652)](_0x33dfb1[_0x311cdb(394)], _0x33dfb1[_0x311cdb(514)], {
        unionInfo: _0x33dfb1[_0x311cdb(622)]
      }).catch(_0x112369 => {
        const _0x4f0d1f = _0x311cdb;
        logger[_0x4f0d1f(595)](_0x112369[_0x4f0d1f(454)]);
      });
    }
    _0x296566(null, {
      code: code.OK
    });
    logger[_0x311cdb(525)](_0x311cdb(400));
  } catch (_0x57d6cc) {
    logger[_0x311cdb(595)](_0x311cdb(657) + _0x57d6cc.stack);
    _0x296566(null, {
      code: 500
    });
  }
};
Handler[a0_0x5d04f4(395)][a0_0x5d04f4(700)] = async function (_0x282d13, _0xc9c852, _0x3a99a3) {
  const _0x181e26 = a0_0x5d04f4;
  try {
    if (!_0xc9c852[_0x181e26(394)]) {
      _0x3a99a3(null, {
        code: code[_0x181e26(456)]
      });
      return;
    }
    if (!_0x282d13.unionID) {
      _0x3a99a3(null, {
        code: code[_0x181e26(610)]
      });
      return;
    }
    let _0x2e8fa0 = await userDao[_0x181e26(489)](_0xc9c852[_0x181e26(394)]);
    if (!_0x2e8fa0) {
      _0x3a99a3(null, {
        code: code[_0x181e26(456)]
      });
      return;
    }
    let _0x3557eb = await commonDao[_0x181e26(695)](_0x181e26(555), {
      unionID: _0x282d13[_0x181e26(468)]
    });
    if (!_0x3557eb) {
      _0x3a99a3(null, {
        code: code[_0x181e26(656)]
      });
      return;
    }
    let _0x5d7207 = _0x2e8fa0.unionInfo[_0x181e26(662)](function (_0x2332b2) {
      const _0x60c638 = _0x181e26;
      return _0x2332b2[_0x60c638(468)] === _0x282d13[_0x60c638(468)];
    });
    if (!_0x5d7207) {
      _0x3a99a3(null, {
        code: code[_0x181e26(610)]
      });
      return;
    }
    if (_0x3557eb[_0x181e26(558)] != _0xc9c852[_0x181e26(394)] && !_0x5d7207.partner && !_0x5d7207[_0x181e26(409)]) {
      _0x3a99a3(null, {
        code: code[_0x181e26(610)]
      });
      return;
    }
    let _0x5ddaf8 = _0xc9c852[_0x181e26(394)];
    _0x5d7207.manager && (_0x5ddaf8 = _0x3557eb[_0x181e26(558)]);
    parterQuery = {
      unionInfo: {
        $elemMatch: {
          unionID: _0x282d13[_0x181e26(468)],
          spreaderID: _0x5ddaf8,
          partner: true
        }
      }
    };
    let _0x182ecb = await commonDao[_0x181e26(465)]("userModel", _0x282d13[_0x181e26(684)] || 0, _0x282d13.count || 20, {
      "unionInfo.fixScoreRate": -1
    }, parterQuery);
    let _0x5e7a0f = _0x182ecb.totalCount;
    let _0x3e2b7c = [];
    for (let _0x3f309a = 0; _0x3f309a < _0x182ecb[_0x181e26(487)][_0x181e26(512)]; _0x3f309a++) {
      let _0x3b0974 = _0x182ecb[_0x181e26(487)][_0x3f309a];
      let _0x585427 = _0x3b0974[_0x181e26(622)][_0x181e26(662)](function (_0x251953) {
        const _0xd22823 = _0x181e26;
        return _0x251953.unionID === _0x282d13[_0xd22823(468)];
      });
      let _0x7ebcf = _0x585427[_0x181e26(678)] || false;
      let _0x5c06d9 = _0x585427[_0x181e26(556)] || 0;
      _0x3e2b7c[_0x181e26(687)]({
        uid: _0x3b0974[_0x181e26(394)],
        nickname: utils[_0x181e26(508)](_0x3b0974[_0x181e26(692)]),
        avatar: _0x3b0974[_0x181e26(484)],
        showFixScore: _0x7ebcf,
        fixScoreRate: _0x5c06d9
      });
    }
    let _0x84d945 = {
      recordCount: _0x5e7a0f,
      recordArr: _0x3e2b7c
    };
    _0x3a99a3(null, {
      code: code.OK,
      msg: _0x84d945
    });
  } catch (_0x4314fa) {
    logger.error("[getTeamFixScore]" + _0x4314fa[_0x181e26(454)]);
    _0x3a99a3(null, {
      code: 500
    });
  }
};
Handler[a0_0x5d04f4(395)][a0_0x5d04f4(458)] = async function (_0xd3d751, _0x270af2, _0x51845f) {
  const _0x356a33 = a0_0x5d04f4;
  try {
    if (!_0x270af2[_0x356a33(394)]) {
      _0x51845f(null, {
        code: code[_0x356a33(456)]
      });
      return;
    }
    if (!_0xd3d751[_0x356a33(468)] || !_0xd3d751[_0x356a33(613)]) {
      _0x51845f(null, {
        code: code[_0x356a33(434)]
      });
      return;
    }
    if (_0x270af2[_0x356a33(394)] == _0xd3d751[_0x356a33(613)]) {
      _0x51845f(null, {
        code: code[_0x356a33(610)]
      });
      return;
    }
    let _0x21d35c = await commonDao.findOneData(_0x356a33(555), {
      unionID: _0xd3d751[_0x356a33(468)]
    });
    if (!_0x21d35c) {
      _0x51845f(null, {
        code: code[_0x356a33(434)]
      });
      return;
    }
    let _0x4fac52 = await userDao[_0x356a33(489)](_0x270af2[_0x356a33(394)]);
    if (!_0x4fac52) {
      _0x51845f(null, {
        code: code[_0x356a33(434)]
      });
      return;
    }
    let _0x540f83 = _0x4fac52[_0x356a33(622)][_0x356a33(662)](function (_0x4ca9e8) {
      const _0x2e410e = _0x356a33;
      return _0x4ca9e8[_0x2e410e(468)] === _0xd3d751[_0x2e410e(468)];
    });
    if (!_0x540f83) {
      _0x51845f(null, {
        code: code[_0x356a33(434)]
      });
      return;
    }
    let _0x1e2dff = await userDao.getUserDataByUid(_0xd3d751[_0x356a33(613)]);
    if (!_0x1e2dff) {
      _0x51845f(null, {
        code: code.NOT_IN_UNION
      });
      return;
    }
    let _0x1e2f8e = _0x1e2dff[_0x356a33(622)][_0x356a33(662)](function (_0x37973b) {
      const _0x62552a = _0x356a33;
      return _0x37973b[_0x62552a(468)] === _0xd3d751[_0x62552a(468)];
    });
    if (_0x21d35c[_0x356a33(558)] !== _0x270af2[_0x356a33(394)] && !_0x1e2f8e[_0x356a33(409)]) {
      _0x51845f(null, {
        code: code.PERMISSION_NOT_ENOUGH
      });
      return;
    }
    let _0x297af9 = await userDao.updateUserData({
      uid: _0xd3d751[_0x356a33(613)],
      "unionInfo.unionID": _0xd3d751[_0x356a33(468)]
    }, {
      "unionInfo.$.targetScore": _0xd3d751[_0x356a33(694)],
      "unionInfo.$.floatScore": _0xd3d751[_0x356a33(686)]
    });
    if (!!_0x297af9[_0x356a33(514)]) {
      userInfoServices[_0x356a33(652)](_0x297af9[_0x356a33(394)], _0x297af9[_0x356a33(514)], {
        unionInfo: _0x297af9[_0x356a33(622)]
      })[_0x356a33(608)](_0x1d6d62 => {
        const _0x1615b2 = _0x356a33;
        logger.error(_0x1d6d62[_0x1615b2(454)]);
      });
    }
    _0x51845f(null, {
      code: code.OK
    });
  } catch (_0x160bbf) {
    logger[_0x356a33(595)](_0x356a33(621) + _0x160bbf[_0x356a33(454)]);
    _0x51845f(null, {
      code: 500
    });
  }
};
Handler[a0_0x5d04f4(395)].userPayDetailModel = async function (_0x2595f0, _0x1b06a5, _0x3a5632) {
  const _0xd4ffe1 = a0_0x5d04f4;
  try {
    if (!_0x1b06a5[_0xd4ffe1(394)]) {
      _0x3a5632(null, {
        code: code[_0xd4ffe1(456)]
      });
      return;
    }
    if (!_0x2595f0[_0xd4ffe1(468)]) {
      _0x3a5632(null, {
        code: code[_0xd4ffe1(434)]
      });
      return;
    }
    let _0x506de3 = {
      unionID: _0x2595f0[_0xd4ffe1(468)]
    };
    let _0xb5e82d = await commonDao[_0xd4ffe1(465)](_0xd4ffe1(463), _0x2595f0[_0xd4ffe1(684)] || 0, _0x2595f0[_0xd4ffe1(682)] || 20, {
      createTime: -1
    }, _0x506de3);
    _0x3a5632(null, {
      code: code.OK,
      msg: _0xb5e82d
    });
  } catch (_0x1cb0e1) {
    logger[_0xd4ffe1(595)](_0xd4ffe1(648) + _0x1cb0e1[_0xd4ffe1(454)]);
    _0x3a5632(null, {
      code: 500
    });
  }
};
Handler[a0_0x5d04f4(395)][a0_0x5d04f4(661)] = async function (_0x58ee7a, _0x3424db, _0x4b0089) {
  const _0x1253e0 = a0_0x5d04f4;
  try {
    if (!_0x3424db[_0x1253e0(394)]) {
      _0x4b0089(null, {
        code: code[_0x1253e0(456)]
      });
      return;
    }
    if (!_0x58ee7a[_0x1253e0(468)] || !_0x58ee7a[_0x1253e0(613)]) {
      _0x4b0089(null, {
        code: code[_0x1253e0(610)]
      });
      return;
    }
    let _0x1c8cf0 = await userDao[_0x1253e0(489)](_0x3424db.uid);
    if (!_0x1c8cf0) {
      _0x4b0089(null, {
        code: code[_0x1253e0(456)]
      });
      return;
    }
    let _0x1e0f18 = await commonDao[_0x1253e0(695)](_0x1253e0(555), {
      unionID: _0x58ee7a[_0x1253e0(468)]
    });
    if (!_0x1e0f18) {
      _0x4b0089(null, {
        code: code[_0x1253e0(434)]
      });
      return;
    }
    let _0xddbd95 = [];
    let _0x3d215a = _0x58ee7a[_0x1253e0(613)];
    let _0x79fc9d = await userDao.getUserDataByUid(_0x3d215a);
    if (!_0x79fc9d) {
      _0x4b0089(null, {
        code: code[_0x1253e0(456)]
      });
      return;
    }
    let _0xd6c045 = 0;
    do {
      _0xd6c045++;
      let _0x4c62f7 = await userDao[_0x1253e0(489)](_0x3d215a);
      if (!_0x4c62f7) {
        break;
      }
      let _0x563baf = _0x4c62f7[_0x1253e0(622)][_0x1253e0(662)](function (_0x108b15) {
        const _0x412de8 = _0x1253e0;
        return _0x108b15[_0x412de8(468)] === _0x58ee7a[_0x412de8(468)];
      });
      if (!_0x563baf) {
        _0x4b0089(null, {
          code: code[_0x1253e0(610)]
        });
        return;
      } else {
        _0xddbd95[_0x1253e0(687)]({
          nickname: _0x4c62f7[_0x1253e0(692)],
          avatar: _0x4c62f7[_0x1253e0(484)],
          score: _0x563baf[_0x1253e0(445)],
          partner: _0x563baf[_0x1253e0(526)],
          manager: _0x563baf[_0x1253e0(409)],
          spreaderID: _0x563baf[_0x1253e0(486)],
          ownerUid: _0x1e0f18.ownerUid,
          uid: _0x4c62f7.uid
        });
        _0x3d215a = _0x563baf[_0x1253e0(486)];
      }
    } while (_0xd6c045 < 2);
    let _0x468b2a = [];
    while (_0xddbd95[_0x1253e0(512)] > 0) {
      _0x468b2a[_0x1253e0(687)](_0xddbd95[_0x1253e0(529)]());
    }
    _0x4b0089(null, {
      code: code.OK,
      msg: {
        spreadsList: _0x468b2a
      }
    });
  } catch (_0x1a689f) {
    logger[_0x1253e0(595)]("[userDirectSeriesSuperior]" + _0x1a689f[_0x1253e0(454)]);
    _0x4b0089(null, {
      code: 500
    });
  }
};