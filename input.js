const a0_0x2765ef=a0_0x547a;(function(_0x4df025,_0x3b4a8a){const _0x4724e5=a0_0x547a,_0xfe7b89=_0x4df025();while(!![]){try{const _0x59bbfa=-parseInt(_0x4724e5(0x1cd))/0x1*(-parseInt(_0x4724e5(0x1df))/0x2)+-parseInt(_0x4724e5(0x1b4))/0x3+-parseInt(_0x4724e5(0x1dc))/0x4+parseInt(_0x4724e5(0x1b2))/0x5*(parseInt(_0x4724e5(0x1ac))/0x6)+-parseInt(_0x4724e5(0x1e3))/0x7*(parseInt(_0x4724e5(0x1d4))/0x8)+-parseInt(_0x4724e5(0x1d9))/0x9+parseInt(_0x4724e5(0x1e1))/0xa;if(_0x59bbfa===_0x3b4a8a)break;else _0xfe7b89['push'](_0xfe7b89['shift']());}catch(_0xcf669d){_0xfe7b89['push'](_0xfe7b89['shift']());}}}(a0_0x57c2,0x5fa10));function a0_0x1fb1(_0x4047aa,_0x4b80b4){const _0x45f4a2=a0_0x3c9d();return a0_0x1fb1=function(_0x42b288,_0x4d8065){_0x42b288=_0x42b288-0x157;let _0x53f547=_0x45f4a2[_0x42b288];return _0x53f547;},a0_0x1fb1(_0x4047aa,_0x4b80b4);}function a0_0x547a(_0x467604,_0x3451e5){const _0x57c292=a0_0x57c2();return a0_0x547a=function(_0x547a03,_0x30450c){_0x547a03=_0x547a03-0x1a8;let _0x14b9e6=_0x57c292[_0x547a03];return _0x14b9e6;},a0_0x547a(_0x467604,_0x3451e5);}const a0_0x47a28c=a0_0x1fb1;function a0_0x57c2(){const _0x16d7be=['\x20payUserList\x20=\x20[','error','updateUserDataNotify','push','payType','findOneAndUpdateEx','nickname','userPay','127481xAYbEt','AAZHIFU','gold','moment','perDiamond','../dao/commonDao','1923803VPzozO','2028304drIhdw','../constant/enumeration','YYYY-MM-DD','getLogger','bureau','238392SQQMCn','count','teamDataModel','2184564ijHrtF','\x20\x20success','stack','4rHqCdV','7835AcfdHJ','14831160IKYWHC','frontendId','7qqMABb','shift','9692309VCRgpq','checkGold',']\x20payDiamond\x20=\x20','format','length','\x20unionOwnerUid\x20=\x20[','unionRoomPay','gameType','updateUserData','6BgdePk','4910NIRcKU','570534wVtxiS','$inc','pomelo-logger','../services/userInfoServices','userPayDetailModel','catch','5TXEjjX','payDiamond','1845912tkrxCT','][pay]\x20union\x20room\x20pay\x20payType\x20=\x20','13128dvhlTZ','3348gRxufx','3532lPvbbB','roomPayType','\x20fail','roomPay','ceil','../constant/code','646626XWcqRs','info','WOZHIFU','../gameComponent/gameConfig','userPayModel','][pay]\x20user\x20pay\x20uid\x20=\x20[','\x20allCount\x20=\x20'];a0_0x57c2=function(){return _0x16d7be;};return a0_0x57c2();}(function(_0x33fcf7,_0x574599){const _0x2c9b34=a0_0x547a,_0x5222a1=a0_0x1fb1,_0x5470d6=_0x33fcf7();while(!![]){try{const _0x49e7f1=-parseInt(_0x5222a1(0x17f))/0x1*(-parseInt(_0x5222a1(0x15a))/0x2)+-parseInt(_0x5222a1(0x171))/0x3+parseInt(_0x5222a1(0x176))/0x4*(parseInt(_0x5222a1(0x182))/0x5)+-parseInt(_0x5222a1(0x158))/0x6*(-parseInt(_0x5222a1(0x192))/0x7)+-parseInt(_0x5222a1(0x16f))/0x8*(-parseInt(_0x5222a1(0x191))/0x9)+parseInt(_0x5222a1(0x17d))/0xa*(parseInt(_0x5222a1(0x162))/0xb)+-parseInt(_0x5222a1(0x18c))/0xc;if(_0x49e7f1===_0x574599)break;else _0x5470d6[_0x2c9b34(0x1c8)](_0x5470d6[_0x2c9b34(0x1e4)]());}catch(_0x23992f){_0x5470d6['push'](_0x5470d6['shift']());}}}(a0_0x3c9d,0xdb22f));let logger=require(a0_0x47a28c(0x194))[a0_0x2765ef(0x1d7)](a0_0x47a28c(0x161));const enumeration=require(a0_0x47a28c(0x189)),gameConfig=require(a0_0x2765ef(0x1c1)),userDao=require(a0_0x47a28c(0x188)),commonDao=require(a0_0x47a28c(0x185)),code=require(a0_0x47a28c(0x186)),userInfoServices=require(a0_0x47a28c(0x173)),moment=require(a0_0x2765ef(0x1d0));class gameServices{static async[a0_0x2765ef(0x1bb)](_0xe61193,_0x251907,_0x19b845,_0x344b57,_0x2d70ad,_0x682265){const _0x394175=a0_0x2765ef,_0x2a10ac=a0_0x47a28c;let _0x1520aa=gameConfig[_0x2a10ac(0x175)](_0x251907[_0x2a10ac(0x172)],_0x251907['gameType']);if(_0x251907[_0x2a10ac(0x160)]===enumeration[_0x2a10ac(0x180)][_0x394175(0x1ce)]){let _0x53928a=[],_0x3128ce=[];for(let _0x213fa7 in _0xe61193){let _0x17d91e=_0xe61193[_0x213fa7];if(_0x17d91e){if(_0x17d91e[_0x2a10ac(0x166)]>=_0x19b845)continue;else _0x3128ce[_0x2a10ac(0x17c)](_0x213fa7);}}if(_0x3128ce[_0x394175(0x1e9)]===0x0)return;let _0x2324f8=Math[_0x2a10ac(0x16b)](_0x1520aa/_0x3128ce[_0x2a10ac(0x169)])||0x1;for(let _0x20dc29=0x0;_0x20dc29<_0x3128ce['length'];_0x20dc29++){_0x53928a[_0x2a10ac(0x17c)]({'matchData':{'uid':_0x3128ce[_0x20dc29]},'saveData':{'$inc':{'gold':-_0x2324f8}}});}logger[_0x2a10ac(0x157)]('['+_0x344b57+_0x2a10ac(0x187)+_0x251907[_0x394175(0x1c9)]+_0x2a10ac(0x15c)+_0x3128ce+_0x2a10ac(0x18a)+_0x2324f8);let _0x5079cd=await userDao['updateUserDataArr'](_0x53928a);for(let _0xcd50de=0x0;_0xcd50de<_0x5079cd[_0x2a10ac(0x169)];++_0xcd50de){let _0x1d322a=_0x5079cd[_0xcd50de];if(!_0x1d322a)continue;!!_0x1d322a[_0x2a10ac(0x164)]&&userInfoServices[_0x2a10ac(0x178)](_0x1d322a[_0x2a10ac(0x183)],_0x1d322a[_0x394175(0x1e2)],{'gold':_0x1d322a[_0x2a10ac(0x193)]})[_0x394175(0x1b1)](_0x15e059=>{const _0x38984d=_0x2a10ac;logger[_0x38984d(0x159)](_0x15e059[_0x38984d(0x195)]);});}}else{if(_0x251907['payType']===enumeration[_0x2a10ac(0x180)][_0x394175(0x1c0)])return gameServices[_0x2a10ac(0x174)](_0x2d70ad,_0x1520aa,_0x344b57,-0x1,_0x682265);}}static async[a0_0x47a28c(0x15d)](_0x167716,_0x50233a,_0x447aaf,_0x272722,_0x1318db,_0x3263ea=![]){const _0x136398=a0_0x2765ef,_0x4dbf83=a0_0x47a28c;let _0x14521e=0x0;if(_0x3263ea){let _0x3fb6fa=parseInt(_0x50233a[_0x4dbf83(0x172)])||0x1,_0x29eab5=_0x50233a[_0x4dbf83(0x15b)]||_0x50233a[_0x136398(0x1b3)]||0x1;_0x29eab5=_0x29eab5*_0x3fb6fa;}else _0x14521e=gameConfig[_0x4dbf83(0x175)](_0x50233a[_0x4dbf83(0x172)],_0x50233a[_0x136398(0x1a8)]);let _0x5afc48={'$inc':{'diamondCount':_0x14521e}},_0x56648d=moment()[_0x4dbf83(0x16d)](_0x4dbf83(0x18e));await commonDao[_0x4dbf83(0x17a)](_0x4dbf83(0x16c),{'unionID':_0x272722,'dateTime':_0x56648d},_0x5afc48);let _0x11c7a9={'uid':_0x167716};_0x11c7a9[_0x136398(0x1cf)]={'$gte':_0x14521e};let _0x4e32e7=await userDao[_0x4dbf83(0x18d)](_0x11c7a9,{'$inc':{'gold':-_0x14521e}});if(!_0x4e32e7)return logger['info']('['+_0x447aaf+_0x4dbf83(0x181)+_0x50233a[_0x136398(0x1c9)]+'\x20unionOwnerUid\x20=\x20['+_0x167716+_0x4dbf83(0x18a)+_0x14521e+'\x20fail',!![]),code[_0x4dbf83(0x17e)];else{!!_0x4e32e7[_0x4dbf83(0x164)]&&userInfoServices[_0x4dbf83(0x178)](_0x4e32e7[_0x4dbf83(0x183)],_0x4e32e7[_0x4dbf83(0x164)],{'gold':_0x4e32e7[_0x4dbf83(0x193)]})['catch'](_0x59d77e=>{const _0x512021=_0x136398,_0x3d29fd=_0x4dbf83;logger[_0x512021(0x1c6)](_0x59d77e[_0x3d29fd(0x195)]);});let _0x2c5b6e=moment()[_0x4dbf83(0x16d)](_0x4dbf83(0x18e)),_0x26642e=_0x4e32e7[_0x4dbf83(0x179)],_0x1ffb06=_0x4e32e7[_0x136398(0x1cb)],_0xdb0160={'unionID':_0x272722,'day':_0x2c5b6e,'roomID':_0x447aaf,'gameType':_0x1318db,'avatar':_0x26642e,'nickname':_0x1ffb06,'uid':_0x167716,'count':_0x14521e,'createTime':Date[_0x4dbf83(0x18b)]()};return await commonDao['createData'](_0x4dbf83(0x17b),_0xdb0160),delete _0xdb0160[_0x4dbf83(0x168)],_0xdb0160[_0x4dbf83(0x165)]={'count':_0x14521e},await commonDao[_0x136398(0x1ca)](_0x4dbf83(0x16e),{'day':_0x2c5b6e,'unionID':_0x272722,'uid':_0x167716},_0xdb0160,{'upsert':!![],'new':!![]}),logger[_0x4dbf83(0x157)]('['+_0x447aaf+_0x136398(0x1b5)+_0x50233a[_0x4dbf83(0x160)]+_0x136398(0x1ea)+_0x167716+_0x4dbf83(0x18a)+_0x14521e+_0x4dbf83(0x163)+_0x4e32e7[_0x4dbf83(0x193)]+_0x4dbf83(0x15f)),code['OK'];}}static async[a0_0x47a28c(0x174)](_0x33f2ad,_0x1ddc0f,_0x13abb5,_0x543214,_0x511fcd){const _0x1ee485=a0_0x2765ef,_0x52b22e=a0_0x47a28c;let _0x4a6b2f={'uid':_0x33f2ad};_0x4a6b2f[_0x52b22e(0x193)]={'$gte':_0x1ddc0f};let _0xb93696=await userDao[_0x1ee485(0x1a9)](_0x4a6b2f,{'$inc':{'gold':-_0x1ddc0f}});if(!_0xb93696)return logger[_0x52b22e(0x157)]('['+_0x13abb5+_0x52b22e(0x15e)+_0x33f2ad+_0x52b22e(0x18a)+_0x1ddc0f+_0x52b22e(0x16a)),code[_0x52b22e(0x17e)];else{!!_0xb93696[_0x52b22e(0x164)]&&userInfoServices[_0x52b22e(0x178)](_0xb93696[_0x52b22e(0x183)],_0xb93696[_0x52b22e(0x164)],{'gold':_0xb93696[_0x52b22e(0x193)]})[_0x52b22e(0x177)](_0xa496eb=>{const _0x244229=_0x1ee485,_0x2dbd2d=_0x52b22e;logger[_0x2dbd2d(0x159)](_0xa496eb[_0x244229(0x1de)]);});let _0x101151=moment()[_0x52b22e(0x16d)](_0x52b22e(0x18e)),_0x11fc42=_0xb93696[_0x52b22e(0x179)],_0x2a36a3=_0xb93696[_0x52b22e(0x184)],_0x4de526={'unionID':_0x543214,'day':_0x101151,'roomID':_0x13abb5,'gameType':_0x511fcd,'avatar':_0x11fc42,'nickname':_0x2a36a3,'uid':_0x33f2ad,'count':_0x1ddc0f,'createTime':Date[_0x52b22e(0x18b)]()};return await commonDao['createData']('userPayDetailModel',_0x4de526),delete _0x4de526['count'],_0x4de526[_0x52b22e(0x165)]={'count':_0x1ddc0f},await commonDao[_0x52b22e(0x17a)](_0x52b22e(0x16e),{'day':_0x101151,'unionID':_0x543214,'uid':_0x33f2ad},_0x4de526,{'upsert':!![],'new':!![]}),logger[_0x52b22e(0x157)]('['+_0x13abb5+_0x52b22e(0x170)+_0x33f2ad+_0x1ee485(0x1e7)+_0x1ddc0f+_0x52b22e(0x163)+_0xb93696[_0x52b22e(0x193)]+'\x20success'),code['OK'];}}static async[a0_0x47a28c(0x190)](_0x2fc0a1,_0x4a00b3){const _0x405528=a0_0x2765ef,_0x4797dd=a0_0x47a28c;let _0x4cbbe0=0x0;if(_0x4a00b3[_0x4797dd(0x160)]===enumeration[_0x4797dd(0x180)][_0x4797dd(0x18f)]){let _0x227ce6=parseInt(_0x4a00b3[_0x405528(0x1d8)])||0x1,_0x33d728=_0x4a00b3[_0x4797dd(0x15b)]||_0x4a00b3[_0x4797dd(0x167)]||0x1;_0x33d728=_0x33d728*_0x227ce6;}else _0x4cbbe0=gameConfig[_0x4797dd(0x175)](_0x4a00b3[_0x4797dd(0x172)],_0x4a00b3[_0x405528(0x1a8)]);return _0x2fc0a1[_0x4797dd(0x193)]<_0x4cbbe0?!![]:![];}}function a0_0x3c9d(){const _0xfe8da7=a0_0x2765ef,_0x759bdf=[_0xfe8da7(0x1aa),_0xfe8da7(0x1c6),_0xfe8da7(0x1ab),_0xfe8da7(0x1d1),_0xfe8da7(0x1c5),_0xfe8da7(0x1eb),'][pay]\x20user\x20pay\x20\x20uid\x20=\x20[',_0xfe8da7(0x1dd),_0xfe8da7(0x1c9),'gameData',_0xfe8da7(0x1e5),_0xfe8da7(0x1c4),'frontendId',_0xfe8da7(0x1ad),'chairID',_0xfe8da7(0x1b3),_0xfe8da7(0x1da),_0xfe8da7(0x1e9),_0xfe8da7(0x1ba),_0xfe8da7(0x1bc),_0xfe8da7(0x1db),_0xfe8da7(0x1e8),_0xfe8da7(0x1c2),_0xfe8da7(0x1b6),_0xfe8da7(0x1c3),_0xfe8da7(0x1be),_0xfe8da7(0x1d8),_0xfe8da7(0x1af),_0xfe8da7(0x1cc),'oneUserDiamondCount',_0xfe8da7(0x1b8),_0xfe8da7(0x1b1),_0xfe8da7(0x1c7),'avatar',_0xfe8da7(0x1ca),_0xfe8da7(0x1b0),_0xfe8da7(0x1c8),'10KjerAJ','NOT_ENOUGH_GOLD','683JdpSMr',_0xfe8da7(0x1b9),_0xfe8da7(0x1b5),_0xfe8da7(0x1e0),'uid','nickname',_0xfe8da7(0x1d2),_0xfe8da7(0x1bd),'][pay]\x20hall\x20room\x20pay\x20payType\x20=\x20','../dao/userDao',_0xfe8da7(0x1d5),_0xfe8da7(0x1e7),'now','44564412tjMeYO',_0xfe8da7(0x1a9),_0xfe8da7(0x1d6),_0xfe8da7(0x1ce),_0xfe8da7(0x1e6),_0xfe8da7(0x1b7),_0xfe8da7(0x1d3),_0xfe8da7(0x1cf),_0xfe8da7(0x1ae),'stack',_0xfe8da7(0x1bf)];return a0_0x3c9d=function(){return _0x759bdf;},a0_0x3c9d();}module['exports']=gameServices;